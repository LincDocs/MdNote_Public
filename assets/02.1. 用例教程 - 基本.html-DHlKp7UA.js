import{_ as i,c as a,f as n,o as h}from"./app-DX7xGyNT.js";const l={};function e(k,s){return h(),a("div",null,s[0]||(s[0]=[n(`<h1 id="bcc" tabindex="-1"><a class="header-anchor" href="#bcc"><span>BCC</span></a></h1><h1 id="目录" tabindex="-1"><a class="header-anchor" href="#目录"><span>目录</span></a></h1><h1 id="用例教程-基本" tabindex="-1"><a class="header-anchor" href="#用例教程-基本"><span>用例教程 - 基本</span></a></h1><p>安装完再看这里</p><p>这些工具可能安装在您的系统上的 /usr/share/bcc/tools 下，或者您也可以从 /tools 下的 bcc github 存储库运行它们，其中它们具有 .py 扩展名。浏览 50 多种可用工具以获得更多分析选项。</p><h2 id="常规性能" tabindex="-1"><a class="header-anchor" href="#常规性能"><span>常规性能</span></a></h2><p>目录</p><ul><li>execsnoop, 为每个新进程打印一行输出</li><li>opensnoop, 打开监听</li><li>ext4slower, 跟踪 ext4 文件系统</li><li>biolatency, 跟踪磁盘 I/O 延迟</li><li>biosnoop, 为每个磁盘 I/O 打印一行输出，其中包含延迟（从设备发出到完成的时间）等详细信息</li><li>cachestat每秒（或每个自定义时间间隔）打印一行摘要，显示文件系统缓存的统计信息</li><li>tcpconnect, 为每个活动的 TCP 连接（例如，通过 connect()）打印一行输出，其中包括源地址和目标地址等详细信息</li><li>tcpaccept, 为每个被动 TCP 连接（例如，通过accept()）打印一行输出，其中包括源地址和目标地址等详细信息</li><li>tcpretrans, 为每个 TCP 重传数据包打印一行输出，其中包括源地址和目标地址以及 TCP 连接的内核状态等详细信息</li><li>runqlat, 计算线程在 CPU 运行队列上等待的时间，并将其打印为直方图</li><li>profile, 一个 CPU 分析器，它以一定的时间间隔采集堆栈跟踪样本，并打印唯一堆栈跟踪的摘要及其出现次数</li></ul><h3 id="execsnoop" tabindex="-1"><a class="header-anchor" href="#execsnoop"><span>execsnoop</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ./execsnoop</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PCOMM</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">            PID</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    RET</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ARGS</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">supervise</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        9660</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">     0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ./run</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">supervise</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        9661</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">     0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ./run</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mkdir</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">            9662</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">     0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /bin/mkdir</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ./main</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">run</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">              9663</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">     0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ./run</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[...]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>execsnoop 为每个新进程打印一行输出。检查短期进程。这些可能会消耗 CPU 资源，但不会出现在大多数定期拍摄正在运行的进程的快照的监控工具中。</p><p>它通过跟踪 exec() 而不是 fork() 来工作，因此它将捕获多种类型的新进程，但不是全部（例如，它不会看到应用程序启动工作进程，也不会执行 exec() 任何其他进程）。</p><p>More <a href="https://github.com/iovisor/bcc/blob/master/tools/execsnoop_example.txt" target="_blank" rel="noopener noreferrer">examples</a></p><h3 id="opensnoop" tabindex="-1"><a class="header-anchor" href="#opensnoop"><span>opensnoop</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ./opensnoop</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PID</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    COMM</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">               FD</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ERR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PATH</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1565</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   redis-server</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        5</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /proc/1565/stat</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1565</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   redis-server</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        5</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /proc/1565/stat</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1565</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   redis-server</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        5</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /proc/1565/stat</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1603</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   snmpd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">               9</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /proc/net/dev</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1603</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   snmpd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">              11</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /proc/net/if_inet6</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1603</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   snmpd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">              -1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /sys/class/net/eth0/device/vendor</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1603</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   snmpd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">              11</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /proc/sys/net/ipv4/neigh/eth0/retrans_time_ms</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1603</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   snmpd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">              11</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /proc/sys/net/ipv6/neigh/eth0/retrans_time_ms</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1603</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   snmpd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">              11</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /proc/sys/net/ipv6/conf/eth0/forwarding</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[...]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为每个 open() 系统调用打印一行输出，包括详细信息。</p><p>打开的文件可以告诉您很多有关应用程序如何工作的信息：识别它们的数据文件、配置文件和日志文件。有时，当应用程序不断尝试读取不存在的文件时，它们可能会行为不当且性能不佳。 opensnoop 让您快速浏览一下。</p><p>More <a href="https://github.com/iovisor/bcc/blob/master/tools/opensnoop_example.txt" target="_blank" rel="noopener noreferrer">examples</a>.</p><h3 id="ext4slower-or-btrfs-xfs-zfs" tabindex="-1"><a class="header-anchor" href="#ext4slower-or-btrfs-xfs-zfs"><span>ext4slower (or <code>btrfs*</code>, <code>xfs*</code>, <code>zfs*</code>)</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ./ext4slower</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Tracing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ext4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> operations</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> slower</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> than</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ms</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">TIME</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     COMM</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">           PID</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    T</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> BYTES</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   OFF_KB</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   LAT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ms</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">FILENAME</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">06:35:01</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cron</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">           16464</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  R</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1249</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">          16.05</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> common-auth</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">06:35:01</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cron</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">           16463</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  R</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1249</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">          16.04</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> common-auth</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">06:35:01</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cron</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">           16465</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  R</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1249</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">          16.03</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> common-auth</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">06:35:01</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cron</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">           16465</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  R</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 4096</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">          10.62</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> login.defs</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">06:35:01</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cron</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">           16464</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  R</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 4096</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">          10.61</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> login.defs</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ext4slower 跟踪 ext4 文件系统并对常见操作进行计时，然后仅打印超出阈值的操作。</p><p>这对于识别或消除一种类型的性能问题非常有用：通过文件系统显示单独的缓慢磁盘 I/O。磁盘异步处理 I/O，可能很难将该层的延迟与延迟应用程序体验相关联。在内核堆栈中向上跟踪，在 VFS -&gt; 文件系统接口处，将更接近地匹配应用程序所遭受的情况。使用此工具可以确定文件系统延迟是否超过给定阈值。</p><p>其他文件系统的 bcc 中也存在类似的工具：btrfsslower、xfsslower 和 zfsslower。还有 fileslower，它在 VFS 层工作并跟踪所有内容（尽管开销较高）</p><p>More <a href="https://github.com/iovisor/bcc/blob/master/tools/ext4slower_example.txt" target="_blank" rel="noopener noreferrer">examples</a>.</p><h3 id="biolatency" tabindex="-1"><a class="header-anchor" href="#biolatency"><span>biolatency</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ./biolatency</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Tracing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> block</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> device</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> I/O...</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Hit</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Ctrl-C</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> end.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">^C</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">     usecs</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">           :</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> count</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     distribution</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        |                                      |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        |                                      |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">7</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        |                                      |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">15</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        |                                      |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      16</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">31</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        |                                      |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      32</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">63</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        |                                      |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      64</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">127</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        |                                      |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">     128</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">255</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 12</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       |********                              |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">     256</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">511</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 15</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       |**********                            |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">     512</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1023</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 43</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       |*******************************       |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    1024</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2047</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 52</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       |**************************************|</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    2048</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4095</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 47</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       |**********************************    |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    4096</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8191</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 52</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       |**************************************|</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    8192</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">16383</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 36</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       |**************************            |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   16384</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">32767</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 15</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       |**********                            |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   32768</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">65535</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        |*                                     |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   65536</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">131071</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        |*                                     |</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>biolatency 跟踪磁盘 I/O 延迟（从设备发出到完成的时间），当工具结束时（Ctrl-C 或给定间隔），它会打印延迟的直方图摘要。</p><p>这对于了解超出 iostat 等工具给出的平均时间的磁盘 I/O 延迟非常有用。 I/O 延迟异常值在分发以及多模式分发结束时将可见。</p><p>More <a href="https://github.com/iovisor/bcc/blob/master/tools/biolatency_example.txt" target="_blank" rel="noopener noreferrer">examples</a></p><h3 id="biosnoop" tabindex="-1"><a class="header-anchor" href="#biosnoop"><span>biosnoop</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ./biosnoop</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">TIME(s</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)        COMM           PID    DISK    T  SECTOR    BYTES   LAT(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ms</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0.000004001</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    supervise</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      1950</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   xvda1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   W</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  13092560</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  4096</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       0.74</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0.000178002</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    supervise</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      1950</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   xvda1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   W</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  13092432</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  4096</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       0.61</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0.001469001</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    supervise</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      1956</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   xvda1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   W</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  13092440</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  4096</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       1.24</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0.001588002</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    supervise</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      1956</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   xvda1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   W</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  13115128</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  4096</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       1.09</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1.022346001</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    supervise</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      1950</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   xvda1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   W</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  13115272</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  4096</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       0.98</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1.022568002</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    supervise</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      1950</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   xvda1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   W</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  13188496</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  4096</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       0.93</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[...]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>biosnoop 为每个磁盘 I/O 打印一行输出，其中包含延迟（从设备发出到完成的时间）等详细信息。</p><p>这使您可以更详细地检查磁盘 I/O，并查找按时间排序的模式（例如，在写入后面排队的读取）。请注意，如果您的系统以高速率执行磁盘 I/O，则输出将会很详细。</p><p>More <a href="https://github.com/iovisor/bcc/blob/master/tools/biosnoop_example.txt" target="_blank" rel="noopener noreferrer">examples</a></p><h3 id="cachestat" tabindex="-1"><a class="header-anchor" href="#cachestat"><span>cachestat</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ./cachestat</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    HITS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   MISSES</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  DIRTIES</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  READ_HIT%</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> WRITE_HIT%</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   BUFFERS_MB</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  CACHED_MB</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    1074</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       44</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       13</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      94.9%</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       2.9%</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">            1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        223</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    2195</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      170</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      92.5%</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       6.8%</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">            1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        143</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">     182</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       53</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       56</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      53.6%</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       1.3%</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">            1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        143</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   62480</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    40960</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    20480</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      40.6%</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      19.8%</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">            1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        223</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       7</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        2</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        5</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      22.2%</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      22.2%</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">            1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        223</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">     348</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     100.0%</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       0.0%</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">            1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        223</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[...]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>cachestat 每秒（或每个自定义时间间隔）打印一行摘要，显示文件系统缓存的统计信息。</p><p>使用它来识别低缓存命中率和高未命中率：这为性能调整提供了线索。</p><p>More <a href="https://github.com/iovisor/bcc/blob/master/tools/cachestat_example.txt" target="_blank" rel="noopener noreferrer">examples</a></p><h3 id="tcpconnect" tabindex="-1"><a class="header-anchor" href="#tcpconnect"><span>tcpconnect</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ./tcpconnect</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PID</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    COMM</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         IP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SADDR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">            DADDR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">            DPORT</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1479</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   telnet</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       4</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  127.0.0.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        127.0.0.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        23</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1469</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   curl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">         4</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  10.201.219.236</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   54.245.105.25</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    80</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1469</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   curl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">         4</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  10.201.219.236</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   54.67.101.145</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    80</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1991</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   telnet</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       6</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  ::1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">              ::1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">              23</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2015</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   ssh</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">          6</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  fe80::2000:bff:fe82:3ac</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fe80::2000:bff:fe82:3ac</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 22</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[...]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>tcpconnect 为每个活动的 TCP 连接（例如，通过 connect()）打印一行输出，其中包括源地址和目标地址等详细信息。</p><p>查找可能导致应用程序配置效率低下或入侵者的意外连接。</p><p>More <a href="https://github.com/iovisor/bcc/blob/master/tools/tcpconnect_example.txt" target="_blank" rel="noopener noreferrer">examples</a>.</p><h3 id="tcpaccept" tabindex="-1"><a class="header-anchor" href="#tcpaccept"><span>tcpaccept</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ./tcpaccept</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PID</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    COMM</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         IP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RADDR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">            LADDR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">            LPORT</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">907</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    sshd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">         4</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  192.168.56.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">     192.168.56.102</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   22</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">907</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    sshd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">         4</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  127.0.0.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        127.0.0.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        22</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">5389</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   perl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">         6</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  1234:ab12:2040:5020:2299:0:5:0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 1234:ab12:2040:5020:2299:0:5:0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 7001</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[...]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>tcpaccept 为每个被动 TCP 连接（例如，通过accept()）打印一行输出，其中包括源地址和目标地址等详细信息。</p><p>查找可能导致应用程序配置效率低下或入侵者的意外连接。</p><p>More <a href="https://github.com/iovisor/bcc/blob/master/tools/tcpaccept_example.txt" target="_blank" rel="noopener noreferrer">examples</a>.</p><h3 id="tcpretrans" tabindex="-1"><a class="header-anchor" href="#tcpretrans"><span>tcpretrans</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ./tcpretrans</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">TIME</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     PID</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    IP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> LADDR:LPORT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">          T&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">RADDR:RPORT</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          STATE</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">01:55:05</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  10.153.223.157:22</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    R&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">69.53.245.40:34619</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   ESTABLISHED</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">01:55:05</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  10.153.223.157:22</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    R&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">69.53.245.40:34619</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   ESTABLISHED</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">01:55:17</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  10.153.223.157:22</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    R&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">69.53.245.40:22957</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   ESTABLISHED</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[...]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>tcprerans 为每个 TCP 重传数据包打印一行输出，其中包括源地址和目标地址以及 TCP 连接的内核状态等详细信息。</p><p>TCP 重传会导致延迟和吞吐量问题。对于 ESTABLISHED 重传，寻找网络模式。对于 SYN_SENT，这可能表明目标内核 CPU 饱和和内核数据包丢失。</p><p>More <a href="https://github.com/iovisor/bcc/blob/master/tools/tcpretrans_example.txt" target="_blank" rel="noopener noreferrer">examples</a>.</p><h3 id="runqlat" tabindex="-1"><a class="header-anchor" href="#runqlat"><span>runqlat</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ./runqlat</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Tracing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> queue</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> latency...</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Hit</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Ctrl-C</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> end.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">^C</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">     usecs</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">               :</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> count</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     distribution</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">         0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 233</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      |***********                             |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">         2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 742</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      |************************************    |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">         4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">7</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 203</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      |**********                              |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">         8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">15</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 173</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      |********                                |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        16</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">31</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 24</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       |*                                       |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        32</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">63</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        |                                        |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        64</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">127</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       |*                                       |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       128</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">255</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        |                                        |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       256</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">511</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        |                                        |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       512</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1023</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        |                                        |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      1024</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2047</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 27</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       |*                                       |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      2048</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4095</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       |*                                       |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      4096</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8191</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 20</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       |                                        |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      8192</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">16383</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 29</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       |*                                       |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">     16384</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">32767</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 809</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      |****************************************|</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">     32768</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">65535</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 64</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       |***                                     |</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>runqlat 计算线程在 CPU 运行队列上等待的时间，并将其打印为直方图。</p><p>这可以帮助量化在 CPU 饱和期间等待打开 CPU 所损失的时间。</p><p>More <a href="https://github.com/iovisor/bcc/blob/master/tools/runqlat_example.txt" target="_blank" rel="noopener noreferrer">examples</a>.</p><h3 id="profile" tabindex="-1"><a class="header-anchor" href="#profile"><span>profile</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ./profile</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Sampling</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> at</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 49</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Hertz</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> of</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> all</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> threads</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> by</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> user</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> +</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kernel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stack...</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Hit</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Ctrl-C</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> end.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">^C</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    00007f31d76c3251</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [unknown]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    47a2c1e752bf47f7</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [unknown]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    -</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                sign-file</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (8877)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ffffffff813d0af8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> __clear_user</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ffffffff813d5277</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> iov_iter_zero</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ffffffff814ec5f2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> read_iter_zero</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ffffffff8120be9d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> __vfs_read</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ffffffff8120c385</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> vfs_read</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ffffffff8120d786</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sys_read</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ffffffff817cc076</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> entry_SYSCALL_64_fastpath</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    00007fc5652ad9b0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> read</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    -</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                dd</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (25036)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        4</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    0000000000400542</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> func_a</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    0000000000400598</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> main</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    00007f12a133e830</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> __libc_start_main</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    083e258d4c544155</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [unknown]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    -</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                func_ab</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (13549)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        5</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[...]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ffffffff8105eb66</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> native_safe_halt</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ffffffff8103659e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> default_idle</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ffffffff81036d1f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> arch_cpu_idle</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ffffffff810bba5a</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> default_idle_call</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ffffffff810bbd07</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cpu_startup_entry</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ffffffff8104df55</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> start_secondary</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    -</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                swapper/1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (0)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        75</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>profile 是一个 CPU 分析器，它以一定的时间间隔采集堆栈跟踪样本，并打印唯一堆栈跟踪的摘要及其出现次数。</p><p>使用此工具可以了解消耗 CPU 资源的代码路径。</p><p>More <a href="https://github.com/iovisor/bcc/blob/master/tools/profile_example.txt" target="_blank" rel="noopener noreferrer">examples</a>.</p><h2 id="使用通用工具的可观察性" tabindex="-1"><a class="header-anchor" href="#使用通用工具的可观察性"><span>使用通用工具的可观察性</span></a></h2><p>除了上述用于性能调整的工具之外，下面是 bcc 通用工具的清单，首先作为列表，然后详细说明：</p><ol><li>trace</li><li>argdist</li><li>funccount</li></ol><p>这些通用工具可能有助于提供可视性来解决您的特定问题。</p><h3 id="trace" tabindex="-1"><a class="header-anchor" href="#trace"><span>trace</span></a></h3><h4 id="example1" tabindex="-1"><a class="header-anchor" href="#example1"><span>example1</span></a></h4><p>假设您要跟踪文件所有权更改。用户可以使用三个系统调用 <code>chown</code> 、 <code>fchown</code> 和 <code>lchown</code> 来更改文件所有权。对应的系统调用条目是 <code>SyS_[f|l]chown</code> 。以下命令可用于打印系统调用参数和调用进程用户 ID。您可以使用 <code>id</code> 命令查找特定用户的uid。</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> trace.py</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  &#39;p::SyS_chown &quot;file = %s, to_uid = %d, to_gid = %d, from_uid = %d&quot;, arg1, arg2, arg3, $uid&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  &#39;p::SyS_fchown &quot;fd = %d, to_uid = %d, to_gid = %d, from_uid = %d&quot;, arg1, arg2, arg3, $uid&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  &#39;p::SyS_lchown &quot;file = %s, to_uid = %d, to_gid = %d, from_uid = %d&quot;, arg1, arg2, arg3, $uid&#39;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PID</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    TID</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    COMM</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         FUNC</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">             -</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1269255</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1269255</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> python3.6</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    SyS_lchown</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       file</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /tmp/dotsync-usisgezu/tmp,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to_uid</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 128203,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to_gid</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 100,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from_uid</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 128203</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1269441</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1269441</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> zstd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         SyS_chown</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        file</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /tmp/dotsync-vic7ygj0/dotsync-package.zst,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to_uid</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 128203,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to_gid</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 100,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from_uid</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 128203</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1269255</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1269255</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> python3.6</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    SyS_lchown</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       file</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /tmp/dotsync-a40zd7ev/tmp,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to_uid</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 128203,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to_gid</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 100,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from_uid</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 128203</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1269442</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1269442</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> zstd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         SyS_chown</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        file</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /tmp/dotsync-gzp413o_/dotsync-package.zst,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to_uid</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 128203,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to_gid</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 100,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from_uid</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 128203</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1269255</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1269255</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> python3.6</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    SyS_lchown</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       file</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /tmp/dotsync-whx4fivm/tmp/.bash_profile,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to_uid</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 128203,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to_gid</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 100,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from_uid</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 128203</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="example2" tabindex="-1"><a class="header-anchor" href="#example2"><span>example2</span></a></h4><p>假设您想要在基于 bpf 的性能监控工具中对非自愿上下文切换 ( <code>nvcsw</code> ) 进行计数，并且您不知道什么是正确的方法。 <code>/proc/&lt;pid&gt;/status</code> 已经告诉您 pid 的编号 ( <code>nonvoluntary_ctxt_switches</code> )，您可以使用 <code>trace.py</code> 进行快速实验来验证您的方法。对于内核源代码， <code>nvcsw</code> 在文件 <code>linux/kernel/sched/core.c</code> 函数 <code>__schedule</code> 处进行计数，并在条件下</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">!(!</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">preempt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">prev-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">//</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> i.e.,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> preempt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> || !</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">prev-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">state</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><code>__schedule</code> 函数被标记为 <code>notrace</code> ，评估上述条件的最佳位置似乎是在函数 <code>__schedule</code> 内部调用并在 <code>linux/include/trace/events/sched.h</code> 中定义的 <code>sched/sched_switch</code> 跟踪点。 <code>trace.py</code> 已经将 <code>args</code> 作为指向跟踪点 <code>TP_STRUCT__entry</code> 的指针。上述条件在函数 <code>__schedule</code> 中可以表示为</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">args-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">prev_state</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ==</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> TASK_STATE_MAX</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> || </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">args-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">prev_state</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>下面的命令可用于计算非自愿上下文切换（每个进程或每个 pid），并与 <code>/proc/&lt;pid&gt;/status</code> 或 <code>/proc/&lt;pid&gt;/task/&lt;task_id&gt;/status</code> 进行比较以确保正确性，因为在典型情况下，非自愿上下文切换并不常见。</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> trace.py</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1134138</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;t:sched:sched_switch (args-&gt;prev_state == TASK_STATE_MAX || args-&gt;prev_state == 0)&#39;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PID</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    TID</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    COMM</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         FUNC</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1134138</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1134140</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> contention_test</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sched_switch</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1134138</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1134142</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> contention_test</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sched_switch</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">...</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> trace.py</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -L</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1134140</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;t:sched:sched_switch (args-&gt;prev_state == TASK_STATE_MAX || args-&gt;prev_state == 0)&#39;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PID</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    TID</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    COMM</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         FUNC</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1134138</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1134140</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> contention_test</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sched_switch</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1134138</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1134140</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> contention_test</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sched_switch</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="example3" tabindex="-1"><a class="header-anchor" href="#example3"><span>example3</span></a></h4><p>此示例与issue 1231 和 1516 相关，其中 uprobe 在某些情况下根本不起作用。首先，您可以执行以下操作 <code>strace</code></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> strace</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> trace.py</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;r:bash:readline &quot;%s&quot;, retval&#39;</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">...</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">perf_event_open(0x7ffd968212f0,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -1,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -1,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0x8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PERF_FLAG_???</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) = -1 EIO (</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Input/output</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> error</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>perf_event_open</code> 系统调用返回 <code>-EIO</code> 。深入 <code>/kernel/trace</code> 和 <code>/kernel/events</code> 目录下的内核uprobe相关代码进行搜索 <code>EIO</code> ，函数 <code>uprobe_register</code> 是最可疑的。让我们看看这个函数是否被调用，如果被调用，返回值是多少。在一个终端使用以下命令打印出uprobe_register的返回值，</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> trace.py</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;r::uprobe_register &quot;ret = %d&quot;, retval&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>在另一个终端中运行相同的 bash uretprobe 跟踪示例，您应该得到</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> trace.py</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;r::uprobe_register &quot;ret = %d&quot;, retval&#39;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PID</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    TID</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    COMM</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         FUNC</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">             -</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1041401</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1041401</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> python2.7</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    uprobe_register</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  ret</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -5</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>-5</code> 错误代码是 EIO。这证实了函数 <code>uprobe_register</code> 中的以下代码是最可疑的罪魁祸首。</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (!</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">inode-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">i_mapping-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">a_ops-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">readpage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &amp;&amp; !</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">shmem_mapping(inode-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">i_mapping</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -EIO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>shmem_mapping</code> 函数定义为</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">bool</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> shmem_mapping</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">struct</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> address_space</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">mapping</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mapping</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">a_ops</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ==</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &amp;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">shmem_aops</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为了证实这一理论，请使用以下命令查找 <code>inode-&gt;i_mapping-&gt;a_ops</code> 是什么</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> trace.py</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -I</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;linux/fs.h&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;p::uprobe_register(struct inode *inode) &quot;a_ops = %llx&quot;, inode-&gt;i_mapping-&gt;a_ops&#39;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PID</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    TID</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    COMM</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         FUNC</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">             -</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">814288</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 814288</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> python2.7</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    uprobe_register</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  a_ops</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ffffffff81a2adc0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">^C$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> grep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ffffffff81a2adc0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /proc/kallsyms</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ffffffff81a2adc0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> R</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> empty_aops</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>More <a href="https://github.com/iovisor/bcc/blob/master/tools/trace_example.txt" target="_blank" rel="noopener noreferrer">examples</a>.</p><h3 id="argdist" tabindex="-1"><a class="header-anchor" href="#argdist"><span>argdist</span></a></h3><p>More <a href="https://github.com/iovisor/bcc/blob/master/tools/argdist_example.txt" target="_blank" rel="noopener noreferrer">examples</a>.</p><h3 id="funccount" tabindex="-1"><a class="header-anchor" href="#funccount"><span>funccount</span></a></h3><p>More <a href="https://github.com/iovisor/bcc/blob/master/tools/funccount_example.txt" target="_blank" rel="noopener noreferrer">examples</a>.</p>`,97)]))}const p=i(l,[["render",e],["__file","02.1. 用例教程 - 基本.html.vue"]]),r=JSON.parse('{"path":"/01.%20DesignAndDevelop/Develop/02.%20Theory/Computer/03.%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%20-%20%E4%B8%93%E9%A2%98%E6%88%96%E5%AD%90%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AD%97%E5%85%B8%E7%89%88/%E4%B8%8B%E5%B1%82%E7%9B%B8%E5%85%B3/Network/%E7%BD%91%E7%BB%9C%E5%BA%93/%E6%97%A0%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%BA%93/BCC%20(eBPF)/02.1.%20%E7%94%A8%E4%BE%8B%E6%95%99%E7%A8%8B%20-%20%E5%9F%BA%E6%9C%AC.html","title":"BCC","lang":"zh-CN","frontmatter":{"description":"BCC 目录 用例教程 - 基本 安装完再看这里 这些工具可能安装在您的系统上的 /usr/share/bcc/tools 下，或者您也可以从 /tools 下的 bcc github 存储库运行它们，其中它们具有 .py 扩展名。浏览 50 多种可用工具以获得更多分析选项。 常规性能 目录 execsnoop, 为每个新进程打印一行输出 opensn...","head":[["meta",{"property":"og:url","content":"https://LincDocs.github.io/MdNote_Public/01.%20DesignAndDevelop/Develop/02.%20Theory/Computer/03.%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%20-%20%E4%B8%93%E9%A2%98%E6%88%96%E5%AD%90%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AD%97%E5%85%B8%E7%89%88/%E4%B8%8B%E5%B1%82%E7%9B%B8%E5%85%B3/Network/%E7%BD%91%E7%BB%9C%E5%BA%93/%E6%97%A0%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%BA%93/BCC%20(eBPF)/02.1.%20%E7%94%A8%E4%BE%8B%E6%95%99%E7%A8%8B%20-%20%E5%9F%BA%E6%9C%AC.html"}],["meta",{"property":"og:site_name","content":"MdNote_Public"}],["meta",{"property":"og:title","content":"BCC"}],["meta",{"property":"og:description","content":"BCC 目录 用例教程 - 基本 安装完再看这里 这些工具可能安装在您的系统上的 /usr/share/bcc/tools 下，或者您也可以从 /tools 下的 bcc github 存储库运行它们，其中它们具有 .py 扩展名。浏览 50 多种可用工具以获得更多分析选项。 常规性能 目录 execsnoop, 为每个新进程打印一行输出 opensn..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-02-09T07:57:06.000Z"}],["meta",{"property":"article:modified_time","content":"2025-02-09T07:57:06.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"BCC\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-02-09T07:57:06.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"LincDocs\\",\\"url\\":\\"https://github.com/LincDocs/MdNote_Public/\\"}]}"]]},"headers":[{"level":1,"title":"BCC","slug":"bcc","link":"#bcc","children":[]},{"level":1,"title":"目录","slug":"目录","link":"#目录","children":[]},{"level":1,"title":"用例教程 - 基本","slug":"用例教程-基本","link":"#用例教程-基本","children":[{"level":2,"title":"常规性能","slug":"常规性能","link":"#常规性能","children":[{"level":3,"title":"execsnoop","slug":"execsnoop","link":"#execsnoop","children":[]},{"level":3,"title":"opensnoop","slug":"opensnoop","link":"#opensnoop","children":[]},{"level":3,"title":"ext4slower (or btrfs*, xfs*, zfs*)","slug":"ext4slower-or-btrfs-xfs-zfs","link":"#ext4slower-or-btrfs-xfs-zfs","children":[]},{"level":3,"title":"biolatency","slug":"biolatency","link":"#biolatency","children":[]},{"level":3,"title":"biosnoop","slug":"biosnoop","link":"#biosnoop","children":[]},{"level":3,"title":"cachestat","slug":"cachestat","link":"#cachestat","children":[]},{"level":3,"title":"tcpconnect","slug":"tcpconnect","link":"#tcpconnect","children":[]},{"level":3,"title":"tcpaccept","slug":"tcpaccept","link":"#tcpaccept","children":[]},{"level":3,"title":"tcpretrans","slug":"tcpretrans","link":"#tcpretrans","children":[]},{"level":3,"title":"runqlat","slug":"runqlat","link":"#runqlat","children":[]},{"level":3,"title":"profile","slug":"profile","link":"#profile","children":[]}]},{"level":2,"title":"使用通用工具的可观察性","slug":"使用通用工具的可观察性","link":"#使用通用工具的可观察性","children":[{"level":3,"title":"trace","slug":"trace","link":"#trace","children":[{"level":4,"title":"example1","slug":"example1","link":"#example1","children":[]},{"level":4,"title":"example2","slug":"example2","link":"#example2","children":[]},{"level":4,"title":"example3","slug":"example3","link":"#example3","children":[]}]},{"level":3,"title":"argdist","slug":"argdist","link":"#argdist","children":[]},{"level":3,"title":"funccount","slug":"funccount","link":"#funccount","children":[]}]}]}],"git":{"createdTime":1739087826000,"updatedTime":1739087826000,"contributors":[{"name":"Linc","username":"Linc","email":"762699299@qq.com","commits":1,"url":"https://github.com/Linc"}]},"readingTime":{"minutes":9.85,"words":2954},"filePathRelative":"01. DesignAndDevelop/Develop/02. Theory/Computer/03. 计算机系统 - 专题或子系统的字典版/下层相关/Network/网络库/无协议栈库/BCC (eBPF)/02.1. 用例教程 - 基本.md","localizedDate":"2025年2月9日","excerpt":"\\n<h1>目录</h1>\\n<h1>用例教程 - 基本</h1>\\n<p>安装完再看这里</p>\\n<p>这些工具可能安装在您的系统上的 /usr/share/bcc/tools 下，或者您也可以从 /tools 下的 bcc github 存储库运行它们，其中它们具有 .py 扩展名。浏览 50 多种可用工具以获得更多分析选项。</p>\\n<h2>常规性能</h2>\\n<p>目录</p>\\n<ul>\\n<li>execsnoop,  为每个新进程打印一行输出</li>\\n<li>opensnoop,  打开监听</li>\\n<li>ext4slower,  跟踪 ext4 文件系统</li>\\n<li>biolatency,  跟踪磁盘 I/O 延迟</li>\\n<li>biosnoop,  为每个磁盘 I/O 打印一行输出，其中包含延迟（从设备发出到完成的时间）等详细信息</li>\\n<li>cachestat每秒（或每个自定义时间间隔）打印一行摘要，显示文件系统缓存的统计信息</li>\\n<li>tcpconnect,  为每个活动的 TCP 连接（例如，通过 connect()）打印一行输出，其中包括源地址和目标地址等详细信息</li>\\n<li>tcpaccept,  为每个被动 TCP 连接（例如，通过accept()）打印一行输出，其中包括源地址和目标地址等详细信息</li>\\n<li>tcpretrans,  为每个 TCP 重传数据包打印一行输出，其中包括源地址和目标地址以及 TCP 连接的内核状态等详细信息</li>\\n<li>runqlat,  计算线程在 CPU 运行队列上等待的时间，并将其打印为直方图</li>\\n<li>profile,  一个 CPU 分析器，它以一定的时间间隔采集堆栈跟踪样本，并打印唯一堆栈跟踪的摘要及其出现次数</li>\\n</ul>","autoDesc":true,"bioChainData":{"outlink":[],"backlink":[],"localMap":{"nodes":[{"id":"01. DesignAndDevelop/Develop/02. Theory/Computer/03. 计算机系统 - 专题或子系统的字典版/下层相关/Network/网络库/无协议栈库/BCC (eBPF)/02.1. 用例教程 - 基本.md","value":{"title":"02.1. 用例教程 - 基本","path":"01. DesignAndDevelop/Develop/02. Theory/Computer/03. 计算机系统 - 专题或子系统的字典版/下层相关/Network/网络库/无协议栈库/BCC (eBPF)/02.1. 用例教程 - 基本.md","outlink":[],"backlink":[]}}],"links":[]}}}');export{p as comp,r as data};
