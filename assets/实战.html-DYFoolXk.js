import{_ as e,c as n,e as s,o as t}from"./app-Z3IVicAk.js";const i={};function o(p,a){return t(),n("div",null,a[0]||(a[0]=[s(`<h1 id="hyperv实战" tabindex="-1"><a class="header-anchor" href="#hyperv实战"><span>HyperV实战</span></a></h1><h2 id="vagrant-ubuntu20-04" tabindex="-1"><a class="header-anchor" href="#vagrant-ubuntu20-04"><span>Vagrant Ubuntu20.04</span></a></h2><p>最新版的还得去翻Vagrant笔记</p><ol><li>然后把里面的 <code>config.vm.provider</code> 修改一下 可能有其他要改的配置，见：https://developer.hashicorp.com/vagrant/docs/providers/hyperv/configuration</li><li>注意box镜像，<code>ubuntu/jammy64</code> 是仅virtualBox的，不是给HyperV用的，要换成其他的 <code>generic/ubuntu2004</code>、<code>selva/ubuntu-hyperv</code> 参考：https://gist.github.com/ghusta/6256e47f65b9588fc6b7ce91496f18e7 （但问题是这里没有提供镜像，就不用镜像了）</li></ol><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token comment"># -*- mode: ruby -*-</span>
<span class="token comment"># vi: set ft=ruby :</span>

Vagrant<span class="token punctuation">.</span>configure<span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span> do <span class="token operator">|</span>config<span class="token operator">|</span>
  <span class="token comment"># 镜像设置。这里使用了镜像。若链接失效则到该链接更新:</span>
  <span class="token comment"># https://mirrors.tuna.tsinghua.edu.cn/ubuntu-cloud-images/jammy/</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>box <span class="token operator">=</span> <span class="token string">&quot;generic/ubuntu2004&quot;</span>
  <span class="token comment"># config.vm.box_url = &quot;&quot;</span>

  <span class="token comment"># 设置内存和CPU数量等</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>network <span class="token string">&quot;private_network&quot;</span><span class="token punctuation">,</span> ip<span class="token punctuation">:</span> <span class="token string">&quot;192.168.56.3&quot;</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>provider <span class="token string">&quot;hyperv&quot;</span> do <span class="token operator">|</span>hv<span class="token operator">|</span>
    hv<span class="token punctuation">.</span>memory <span class="token operator">=</span> <span class="token string">&quot;2048&quot;</span>
    hv<span class="token punctuation">.</span>cpus <span class="token operator">=</span> <span class="token number">2</span>
  end

  。。。
  。。。
end
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动也换一下：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>vagrant up <span class="token parameter variable">--provider</span><span class="token operator">=</span>hyperv
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>没镜像非常慢，两个多小时</p><p>最后安装成功了，但还没研究怎么弄显卡直通（不确定跨系统还能不能直通） （非跨系统那个成功了，但流程也是非常复杂。感觉跨系统弄不了……）</p><h2 id="非vagrant、直接部署windows" tabindex="-1"><a class="header-anchor" href="#非vagrant、直接部署windows"><span>非Vagrant、直接部署Windows</span></a></h2><p>参考：见： https://www.bilibili.com/video/BV1Fu41177Xj</p><h3 id="系统安装" tabindex="-1"><a class="header-anchor" href="#系统安装"><span>系统安装</span></a></h3><p>这里我用的镜像： <code>Win11_23H2_Chinese_Simplified_x64.iso</code>、后来换成了 <code>Win10_22H2_Chinese_Simplified_x64v1.iso</code></p><p>Windows 就手动安装了，不用Vagrant了。</p><p>一开始我装不上，后来发现需要额外注意下那个安全选项好像好开一下，并且连接启动时需要疯狂按空格/F2/Delete（这个设计好奇怪）。</p><p>许可：<code>TW9DD-83NPF-XDWHW-TWQD2-V8RB3</code></p><h3 id="显卡直通" tabindex="-1"><a class="header-anchor" href="#显卡直通"><span>显卡直通</span></a></h3><p>检查</p><blockquote><p>桌面电脑图标右键 &gt; 管理 &gt; 计算机管理面板 &gt; 设备管理器 &gt; 显示适配器 &gt; 可以看到有两个选项：</p><ul><li>Microsoft Hyper-V视频</li><li>Microsoft Remote Display Adapter</li></ul><p>可以看到没有识别到显卡，我们可以拿主机的来对比下，有两个选项：</p><ul><li>Inter(R) UHD Graphics 770</li><li>NVIDIA GeForce RTX 3070</li></ul></blockquote><p>然后我们来进行设置：</p><ol><li><p>关闭虚拟机，设置中将检查点复选框取消勾选，然后管理员身份打开PowerShell</p></li><li><p>根据帖子： freedidi.com/9857.html 的内容来输入一些命令 (5条)：</p></li></ol><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token variable">$vm</span> <span class="token operator">=</span> <span class="token string">&quot;虚拟机的名字&quot;</span>

Add-VMGpuPartitionAdapter <span class="token parameter variable">-VMName</span> <span class="token variable">$vm</span>

Set-VMGpuPartitionAdapter <span class="token parameter variable">-VMName</span> <span class="token variable">$vm</span> <span class="token parameter variable">-MinPartitionVRAM</span> <span class="token number">80000000</span> <span class="token parameter variable">-MaxPartitionVRAM</span> <span class="token number">100000000</span> <span class="token parameter variable">-OptimalPartitionVRAM</span> <span class="token number">100000000</span> <span class="token parameter variable">-MinPartitionEncode</span> <span class="token number">80000000</span> <span class="token parameter variable">-MaxPartitionEncode</span> <span class="token number">100000000</span> <span class="token parameter variable">-OptimalPartitionEncode</span> <span class="token number">100000000</span> <span class="token parameter variable">-MinPartitionDecode</span> <span class="token number">80000000</span> <span class="token parameter variable">-MaxPartitionDecode</span> <span class="token number">100000000</span> <span class="token parameter variable">-OptimalPartitionDecode</span> <span class="token number">100000000</span> <span class="token parameter variable">-MinPartitionCompute</span> <span class="token number">80000000</span> <span class="token parameter variable">-MaxPartitionCompute</span> <span class="token number">100000000</span> <span class="token parameter variable">-OptimalPartitionCompute</span> <span class="token number">100000000</span>

Set-VM <span class="token parameter variable">-GuestControlledCacheTypes</span> <span class="token variable">$true</span> <span class="token parameter variable">-VMName</span> <span class="token variable">$vm</span>

Set-VM <span class="token parameter variable">-LowMemoryMappedIoSpace</span> 1Gb <span class="token parameter variable">-VMName</span> <span class="token variable">$vm</span>

Set-VM <span class="token parameter variable">-HighMemoryMappedIoSpace</span> 32GB <span class="token parameter variable">-VMName</span> <span class="token variable">$vm</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>驱动拷贝目录</li></ol><p>拷贝不成功的话，倒数第二个图标切换到 “增强会话”</p><p>①</p><p>宿主机驱动路径：<code>C:\\Windows\\System32\\DriverStore\\FileRepository\\路径A</code> 虚拟机拷贝路径：<code>C:\\Windows\\System32\\HostDriverStore\\FileRepository\\</code></p><p><code>路径A</code> 的位置在 计算机管理&gt;设备管理器&gt;显卡适配器&gt;(对应的GPU显卡)&gt;双击&gt;驱动程序&gt;驱动程序详细信息&gt;然后在里面找到大量 <code>nv</code> 开头的，会发现都是在同一个路径下，就是那个文件夹。我的是 <code>nvmdi.inf_amd64_33559cc6c2fd215a</code></p><p>②其他</p><ul><li>N卡操作 宿主机文件路径：<code>C:\\Windows\\System32\\nvapi64.dll</code> 虚拟机拷贝路径：<code>C:\\Windows\\System32\\nvapi64.dll</code></li><li>A卡操作 所有宿主机，驱动管理器，显卡驱动信息里的文件都必须全部拷贝到虚拟机里（路径和宿主机相同）</li></ul><ol start="4"><li>检查</li></ol><p>都弄完了，就重启虚拟机，再去设备管理器检查下是否弄成功了</p><p>也可以用 DXdiag诊断工具 来看一下是不是真的正常</p><p>弄完这步后，虚拟机的缩放也可以弄大点了（显卡直通前不建议）</p><p>实战检验：Youtube看4K视频、打个Game</p>`,34)]))}const l=e(i,[["render",o],["__file","实战.html.vue"]]),c=JSON.parse('{"path":"/01.%20DesignAndDevelop/Virtual/%E8%99%9A%E6%8B%9F%E6%9C%BA/HyperV/%E5%AE%9E%E6%88%98.html","title":"HyperV实战","lang":"zh-CN","frontmatter":{"description":"HyperV实战 Vagrant Ubuntu20.04 最新版的还得去翻Vagrant笔记 然后把里面的 config.vm.provider 修改一下 可能有其他要改的配置，见：https://developer.hashicorp.com/vagrant/docs/providers/hyperv/configuration 注意box镜像，ub...","head":[["meta",{"property":"og:url","content":"https://LincDocs.github.io/MdNote_Public/01.%20DesignAndDevelop/Virtual/%E8%99%9A%E6%8B%9F%E6%9C%BA/HyperV/%E5%AE%9E%E6%88%98.html"}],["meta",{"property":"og:site_name","content":"MdNote_Public"}],["meta",{"property":"og:title","content":"HyperV实战"}],["meta",{"property":"og:description","content":"HyperV实战 Vagrant Ubuntu20.04 最新版的还得去翻Vagrant笔记 然后把里面的 config.vm.provider 修改一下 可能有其他要改的配置，见：https://developer.hashicorp.com/vagrant/docs/providers/hyperv/configuration 注意box镜像，ub..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-01-23T15:48:39.000Z"}],["meta",{"property":"article:author","content":"LincDocs"}],["meta",{"property":"article:modified_time","content":"2025-01-23T15:48:39.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"HyperV实战\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-01-23T15:48:39.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"LincDocs\\",\\"url\\":\\"https://github.com/LincDocs/MdNote_Public/\\"}]}"]]},"headers":[{"level":1,"title":"HyperV实战","slug":"hyperv实战","link":"#hyperv实战","children":[{"level":2,"title":"Vagrant Ubuntu20.04","slug":"vagrant-ubuntu20-04","link":"#vagrant-ubuntu20-04","children":[]},{"level":2,"title":"非Vagrant、直接部署Windows","slug":"非vagrant、直接部署windows","link":"#非vagrant、直接部署windows","children":[{"level":3,"title":"系统安装","slug":"系统安装","link":"#系统安装","children":[]},{"level":3,"title":"显卡直通","slug":"显卡直通","link":"#显卡直通","children":[]}]}]}],"git":{"createdTime":1737647319000,"updatedTime":1737647319000,"contributors":[{"name":"Linc","email":"762699299@qq.com","commits":1}]},"readingTime":{"minutes":2.76,"words":827},"filePathRelative":"01. DesignAndDevelop/Virtual/虚拟机/HyperV/实战.md","localizedDate":"2025年1月23日","excerpt":"\\n<h2>Vagrant Ubuntu20.04</h2>\\n<p>最新版的还得去翻Vagrant笔记</p>\\n<ol>\\n<li>然后把里面的 <code>config.vm.provider</code> 修改一下\\n可能有其他要改的配置，见：https://developer.hashicorp.com/vagrant/docs/providers/hyperv/configuration</li>\\n<li>注意box镜像，<code>ubuntu/jammy64</code> 是仅virtualBox的，不是给HyperV用的，要换成其他的\\n<code>generic/ubuntu2004</code>、<code>selva/ubuntu-hyperv</code>\\n参考：https://gist.github.com/ghusta/6256e47f65b9588fc6b7ce91496f18e7\\n（但问题是这里没有提供镜像，就不用镜像了）</li>\\n</ol>","autoDesc":true,"bioChainData":{"outlink":[],"backlink":[],"localMap":{"nodes":[{"id":"01. DesignAndDevelop/Virtual/虚拟机/HyperV/实战.md","value":{"title":"实战","path":"01. DesignAndDevelop/Virtual/虚拟机/HyperV/实战.md","outlink":[],"backlink":[]}}],"links":[]}}}');export{l as comp,c as data};
