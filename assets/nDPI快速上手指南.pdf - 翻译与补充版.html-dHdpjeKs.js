import{_ as s,c as a,f as n,o as l}from"./app-Cy4VlaP7.js";const h={};function t(e,i){return l(),a("div",null,i[0]||(i[0]=[n(`<h1 id="ndpi" tabindex="-1"><a class="header-anchor" href="#ndpi"><span>nDPI</span></a></h1><h1 id="目录" tabindex="-1"><a class="header-anchor" href="#目录"><span>目录</span></a></h1><h1 id="ndpi快速上手指南" tabindex="-1"><a class="header-anchor" href="#ndpi快速上手指南"><span>nDPI快速上手指南</span></a></h1><p>参考：</p><ul><li><a href="https://blog.csdn.net/banruoju/article/details/78806533" target="_blank" rel="noopener noreferrer">nDPI快速上手指南</a> 或 <a href="https://blog.csdn.net/A_lber_t/article/details/89552332" target="_blank" rel="noopener noreferrer">nDPI – 快速入门指南(翻译自官方文档)</a>，这两篇其实都是对官方文档的一个润色翻译，我综合着来看 <ul><li>nDPI官方文档 <a href="https://github.com/ntop/nDPI/blob/dev/doc/guide/nDPI_QuickStartGuide.pdf" target="_blank" rel="noopener noreferrer">nDPI- Quick Start Guide</a></li></ul></li></ul><p>这是一篇针对nDPI官方文档 <a href="https://github.com/ntop/nDPI/blob/dev/doc/guide/nDPI_QuickStartGuide.pdf" target="_blank" rel="noopener noreferrer">nDPI- Quick Start Guide</a> 的翻译，由于文档太老了(13年)，所以部分接口已经发生了变化，本人将基于Version2.0对这些过时的接口进行更新。由于水平有限，翻译的、修补的内容不保证一定准确，各位最好上手之后对照源码细读一遍吧。</p><h2 id="介绍" tabindex="-1"><a class="header-anchor" href="#介绍"><span>介绍</span></a></h2><p>nDPI是一个从OpenDPI发展而来的DPI库，现在由ntop组织负责维护。</p><p>为了给你提供一个跨平台DPI的体验，nDPI除了支持Unix平台，还支持Windows(和Mac)。为了使nDPI更加适合应用于流量监控，我们将会持续进行优化，比如一旦发现存在对网络流量监控非必须的、却拖慢了DPI引擎的功能时，可以执行关闭。</p><p>不管使用了哪个端口，nDPI都可以探测到实际的应用层协议。这意味着既可以探测运行在非标准端口上的协议(e.g探测运行在非80端口上的http流量)，又可以探测运行在一个标准端口上的其他协议(e.g探测运行在80端口上的Skype流量)。这是因为现在端口跟协议关联的概念已经被打破。</p><p>在过去的几个月里，我们已经为nDPI增加了以下多个功能：</p><ul><li>一个名为ndpiReader的增强型demo</li><li>可以被编译进kernel成为一个模块，使其更加高效</li><li>从各方面提升了识别速度，目前nDPI在这方面已经远远超过了前代的OpenDPI</li><li>新增了大量的协议支持(目前为止已经支持超过180种协议)，覆盖范围从商业类协议(如SAP和Citrix)到桌面协议(如Dropbox和Spotify)</li><li>可以定义基于端口(端口范围)的协议探测，丰富了传统的仅仅基于端口的探测手段</li><li>为了使nDPI支持探测加密连接，我们增加一个用于SSL的解码器(同时支持客户端和服务端)，用以找出那些使用了加密证书的协议。这使我们可以识别那些以前无法探测到的协议，比如Citrix和AppleiCloud等</li><li>通过基于额外的一些字符串匹配方式，我们可以支持识别一些常见的应用子协议</li></ul><h2 id="ndpi库编译与运行" tabindex="-1"><a class="header-anchor" href="#ndpi库编译与运行"><span>nDPI库编译与运行</span></a></h2><p>在你搭建ntop和nProbe的过程中nDPI就会自动被下载。也可以作为一个独立的DPI库来使用，源代码可以通过gitclone https://github.com/ntop/nDPI.git下载</p><p>nDPI库</p><h3 id="编译-ndpi-源代码" tabindex="-1"><a class="header-anchor" href="#编译-ndpi-源代码"><span>编译 nDPI 源代码</span></a></h3><p>使用nDPI库很简单。编译这个库时需要依赖以下这些工具和组件：</p><ul><li>GNUautotools/libtool</li><li>gawk</li><li>gcc</li><li>libpcap 或 PF_RING (虽然是可选的，但非常建议装上)</li></ul><p>安装方式跟平台以及发行版相关，这里列举了一些：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Ubuntu/Debian</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> apt-get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> build-essential</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> apt-get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> autoconf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> automake</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> autogen</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> libpcap-dev</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> libtool</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Fedora/CentOS</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> groupinstall</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;Development tools&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> autoconf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> automake</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> autogen</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> libpcap-devel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> libtool</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># MacOSX(using http://brew.sh)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> brew</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> autoconf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> automake</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> libtool</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> git</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># FreeBSD</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pkg</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> autoconf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> automake</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> libtool</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> gmake</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> git</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在装完了依赖的工具之后，你就可以通过以下这组命令来编译nDPI了：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ./autogen.sh</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> make</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="编译示例程序-——-ndpireader" tabindex="-1"><a class="header-anchor" href="#编译示例程序-——-ndpireader"><span>编译示例程序 —— ndpiReader</span></a></h3><p>Version2.0版本在工程目录下执行make时，默认就编译了example目录下的ndpiReader</p><h4 id="ndpireader-的命令行选项" tabindex="-1"><a class="header-anchor" href="#ndpireader-的命令行选项"><span>ndpiReader 的命令行选项</span></a></h4><p>以下列出了该demo程序的有效选项以及对应的简单解释</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ./ndpiReader</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ndpiReader-i</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">file</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">device</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; [-f &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">filte</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">r&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">][-s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ][-m</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">duratio</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">n&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[-p</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">protos</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">][-l  [-q][-d][-h][-t][-v ]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[-n</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">threads</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] [-w </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">file</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] [-j </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">file</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Usage:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-i</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">file.pcap|device</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                   |指定一个需要被识别的pcap文件/文件列表，或者需要被嗅探的</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                   |设备接口/接口列表(文件列表或接口列表使用</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;,&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">作为分隔符)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-f&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">BPF filter</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                            |指定一条BPF规则的过滤字串</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-s&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">duration</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                             |最大的嗅探时间(显然只在嗅探接口时生效)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-m</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">duration</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                            | pcap文件分段解析超时时间(显然只在解析pcap文件时生效)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-p&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">file</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.protos                          |指定一个自定义的协议识别配置文件(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">eg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">protos</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">txt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-l</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">num loops</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                           |指定循环执行嗅探的次数(仅用于测试)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-n&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">num threads</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                       |指定线程数量，缺省跟设备接口数量对应</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                   |如果传入的是pcap文件时固定使用单线程</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-j</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">file.json</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                               |指定一个输出包内容的json文件</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-g&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">id:id...</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                |指定线程-CPU亲和关系映射表</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-d</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                              |禁止协议猜测功能</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-q                                              |安静模式，意味着不打印信息</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-t</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                               |解析GTP隧道协议</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-r</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                               |打印 nDPI版本和git版本</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-w&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">path</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                  |指定测试信息的输出文件</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-h</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                              | help信息</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-v</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">1|2|3</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                  |按级别进一步打印包的详细信息，分为1、2、3级</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="协议文件" tabindex="-1"><a class="header-anchor" href="#协议文件"><span>协议文件</span></a></h3><p><strong>通过基于字符串的匹配方式</strong>，nDPI可以支持识别应用层的子协议。这是因为存在很多像 AppleiCloud/iMessage, WhatsApp 等新出现的子协议，以及其他使用http(s)的协议，这些协议可以通过解码主机SSL证书或http头中的&quot;Host&quot;字段而被识别。</p><p>因此我们决定将一个基于流行的Aho-Corasick 算法的高效字符匹配库嵌入到nDPI中，用于数十万子字符的高效匹配（即在普通硬件上能足够快地支持10Gb的流量）。</p><p>通过使用一个协议文件，你可以在运行时设置自定义的子协议，格式如下：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Subprotocols</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Format:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># host:&quot;&lt;value&gt;&quot;,host:&quot;&lt;value&gt;&quot;,.....@&lt;subproto&gt;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">host:</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;googlesyndication.com&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">@Google</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">host:</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;venere.com&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">@Venere</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">host:</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;kataweb.it&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,host:</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;repubblica.it&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">@Repubblica</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">host:</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;ntop&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">@ntop</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>你还可以配置基于IP的子协议，格式如下：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># IP based Subprotocols</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Format:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ip:&lt;value&gt;,ip:&lt;value&gt;,.....@&lt;subproto&gt;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ip:213.75.170.11@CustomProtocol</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>你还可以配置基于端口的子协议，格式如下：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Format:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># &lt;tcp|udp&gt;:&lt;port&gt;,&lt;tcp|udp&gt;:&lt;port&gt;,.....@&lt;proto&gt;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tcp:81,tcp:8181@HTTP</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">udp:5061-5062@SIP</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tcp:860,udp:860,tcp:3260,udp:3260@iSCSI</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tcp:3000@ntop</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>只需要在运行 ndpiReader 时加上使用 “-p” 选项，就可以测试你自定义的配置协议了。当然你也可以通过在你的程序中调用nDPI的API <code>ndpi_load_protocols_file()</code> 来测试你的配置。</p><h2 id="示例-——-ndpireader程序" tabindex="-1"><a class="header-anchor" href="#示例-——-ndpireader程序"><span>示例 —— ndpiReader程序</span></a></h2><p>这节中我们将展示一些demo程序 ndpiReader 的使用范例。</p><h3 id="现场捕获模式" tabindex="-1"><a class="header-anchor" href="#现场捕获模式"><span>现场捕获模式</span></a></h3><p>下面这个例子展示了ndpiReader的现场捕获模式，其中“-i”选项用来指定需要进行嗅探的设备接口，“-s” 选项指定了嗅探的时间。</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$sudo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ./ndpiReader -i eth0 -s 20</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-----------------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">*NOTE: This is demo app to show *some* nDPI features.</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">*In this demo we have implemented only some basic features</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">*just to show you what you can </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">do</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> with</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> library.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Feel</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">*free to extend it and send us the patches </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> inclusion</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">------------------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">UsingnDPI</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (2.0.0-838-6607c33) [</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> thread(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">s</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Capturinglive</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> traffic</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> device</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eth0...</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Capturingtraffic</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> up</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 5</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> seconds</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Runningthread</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nDPIMemory</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> statistics:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nDPIMemory</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (once): 93.13 KB</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">FlowMemory</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (per </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">flow</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">): 1.25 KB</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ActualMemory:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1.49</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> MB</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PeakMemory:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1.49</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> MB</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Trafficstatistics:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Ethernetbytes:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 80367</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (includes </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ethernet</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> CRC/IFC/trailer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Discardedbytes:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1200</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">IPpackets:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 236</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> of</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 256</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> packets</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> total</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">IPbytes:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 74703</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (avg </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">pkt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> size</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 291</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bytes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Uniqueflows:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 165</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">TCPPackets:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">UDPPackets:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 230</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">VLANPackets:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 4</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">MPLSPackets:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PPPoEPackets:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">FragmentedPackets:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">MaxPacket</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> size:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 328</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PacketLen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">64:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 28</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PacketLen</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 64-128:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 9</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PacketLen</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 128-256:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PacketLen</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 256-1024:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 193</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PacketLen</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 1024-1500:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PacketLen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">1500:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nDPIthroughput:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 47.22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pps</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 125.62</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Kb/sec</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Analysisbegin:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 01/Jan/1970</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 08:00:00</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Analysisend:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 01/Jan/1970</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 08:00:00</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Trafficthroughput:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 47.22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pps</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 125.62</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Kb/sec</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Trafficduration:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 4.998</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sec</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Guessedflow</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> protos:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Detectedprotocols:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Unknown</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> packets:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 194</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bytes:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 69976</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> flows:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 143</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">NetBIOS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> packets:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 19</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bytes:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2116</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> flows:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 8</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">SSDP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> packets:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bytes:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 416</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> flows:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">IGMP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> packets:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bytes:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 120</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> flows:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ICMPV6</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> packets:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bytes:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 344</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> flows:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">DHCPV6</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> packets:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bytes:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 455</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> flows:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">LLMNR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> packets:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bytes:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 760</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> flows:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 5</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Cloudflare</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> packets:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bytes:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 516</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> flows:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Protocolstatistics:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Acceptable</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 4727</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bytes</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Unrated</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 69976</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bytes</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="文件捕获模式" tabindex="-1"><a class="header-anchor" href="#文件捕获模式"><span>文件捕获模式</span></a></h3><p>最简单的创建一个pcap文件的方法是使用tcpdump命令，就像下面这个例子一项：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$sudo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> tcpdump -i eth0 -w /var/tmp/capture.pcap -v</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tcpdump:listening</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> on</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eth0,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> link-type</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> EN10MB</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (Ethernet), capture size 262144bytes</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">^C248packets</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> captured</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">252packets</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> received</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> by</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> filter</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0packets</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dropped</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> by</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kernel</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>一旦pcap文件被创建，你就可以像下面这样运行ndpiReader：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$sudo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ./ndpiReader -i /var/tmp/capture.pcap</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-----------------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">*NOTE: This is demo app to show *some* nDPI features.</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">*In this demo we have implemented only some basic features</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">*just to show you what you can </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">do</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> with</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> library.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Feel</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">*free to extend it and send us the patches </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> inclusion</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">------------------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">UsingnDPI</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (2.0.0-838-6607c33) [</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> thread(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">s</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Capturinglive</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> traffic</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> device</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eth0...</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Capturingtraffic</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> up</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 5</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> seconds</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Runningthread</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0...</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nDPIMemory</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> statistics:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nDPIMemory</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (once): 93.13 KB</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">FlowMemory</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (per </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">flow</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">): 1.25 KB</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ActualMemory:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1.49</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> MB</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PeakMemory:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1.49</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> MB</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Trafficstatistics:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Ethernetbytes:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 80650</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (includes </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ethernet</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> CRC/IFC/trailer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Discardedbytes:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1020</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">IPpackets:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 231</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> of</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 248</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> packets</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> total</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">IPbytes:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 75106</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (avg </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">pkt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> size</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 302</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bytes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Uniqueflows:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 164</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">TCPPackets:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">UDPPackets:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 227</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">VLANPackets:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">MPLSPackets:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PPPoEPackets:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">FragmentedPackets:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">MaxPacket</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> size:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 328</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PacketLen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">64:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 19</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PacketLen</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 64-128:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PacketLen</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 128-256:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 13</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PacketLen</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 256-1024:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 193</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PacketLen</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 1024-1500:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PacketLen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">1500:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nDPIthroughput:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 155.03</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> K</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pps</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 412.96</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Mb/sec</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Analysisbegin:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 14/Dec/2017</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 15:37:39</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Analysisend:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 14/Dec/2017</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 15:37:44</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Trafficthroughput:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 49.59</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pps</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 135.25</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Kb/sec</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Trafficduration:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 4.659</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sec</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Guessedflow</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> protos:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Detectedprotocols:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Unknown</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> packets:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 200</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bytes:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 71136</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> flows:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 146</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">MDNS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> packets:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bytes:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1197</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> flows:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">NetBIOS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> packets:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bytes:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 552</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> flows:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">SSDP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> packets:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bytes:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 624</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> flows:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ICMPV6</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> packets:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bytes:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 86</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> flows:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">DHCPV6</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> packets:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 5</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bytes:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 761</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> flows:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 5</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">LLMNR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> packets:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bytes:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 750</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> flows:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 4</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Protocolstatistics:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Acceptable</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3970</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bytes</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Unrated</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 71136</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bytes</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="协议文件-1" tabindex="-1"><a class="header-anchor" href="#协议文件-1"><span>协议文件</span></a></h3><p>为了阐述清楚协议文件的作用，我们现在就来讲解如何识别ntop.org的流量。</p><p>可以像下面这样编辑protos.txt.</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;host:&quot;ntop.org&quot;@nTop&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; protos.txt</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>修改完协议文件之后，你就可以像下面这样运行ndpiReader：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$sudo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ./ndpiReader -i eth0 -s 30 -p ./protos.txt</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="api-ndpi" tabindex="-1"><a class="header-anchor" href="#api-ndpi"><span>API nDPI</span></a></h2><p>这节中高亮的就是nDPI的API。</p><p>这节中将ndpiReader作为一个基本范例来展示如何初始化nDPI库。首先需要一个编译完成的库以及一个合适的Makefile (i.e就像ndpiReader的Makefile那样)</p><p>为了在你的程序中使用nDPI的API，你除了要include自己的头文件外，还需要添加类似下面这一行：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#include&lt;ndpi/ndpi_main.h&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>库可以按照下面的顺序执行初始化：</p><h3 id="_1-创建并初始化一个ndpi核心库探测模块" tabindex="-1"><a class="header-anchor" href="#_1-创建并初始化一个ndpi核心库探测模块"><span>(1) 创建并初始化一个nDPI核心库探测模块</span></a></h3><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">structndpi_detection_module_struct </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> module </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ndpi_init_detection_module</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>备注：本API格式在Version2.0版本中较之前版本差异很大。</p><p>这个探测模块中维护了所有支持的协议。</p><p>本API只是注册了所有支持的协议，但并未使能其中任何一个协议</p><h3 id="_2-ndpireader接下来通过一些宏使能了探测模块中的所有协议-显然你可以根据自己的需求来决定使能哪些协议" tabindex="-1"><a class="header-anchor" href="#_2-ndpireader接下来通过一些宏使能了探测模块中的所有协议-显然你可以根据自己的需求来决定使能哪些协议"><span>(2) ndpiReader接下来通过一些宏使能了探测模块中的所有协议(显然你可以根据自己的需求来决定使能哪些协议)</span></a></h3><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/**</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * </span><span style="--shiki-light:#A626A4;--shiki-light-font-style:italic;--shiki-dark:#C678DD;--shiki-dark-font-style:italic;">@param</span><span style="--shiki-light:#383A42;--shiki-light-font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> ndpi_struct</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> 指向当前操作的探测模块</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * </span><span style="--shiki-light:#A626A4;--shiki-light-font-style:italic;--shiki-dark:#C678DD;--shiki-dark-font-style:italic;">@param</span><span style="--shiki-light:#383A42;--shiki-light-font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> dbm</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> 调用者实际通过该集合来控制实际需要应用的协议，只有该字段中被置1的对应协议，其协议分析器才真正允许被加载</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> */</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">NDPI_BITMASK_SET_ALL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">all</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ndpi_set_protocol_detection_bitmask2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    structndpi_detection_module_struct </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">ndpi_struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    constNDPI_PROTOCOL_BITMASK </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> dbm</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>备注：本API的作用就是使能一个已经初始化的nDPI核心库探测模块中的协议</p><h3 id="_3-为了导入已经存在的协议文件-你还必须调用下面的api" tabindex="-1"><a class="header-anchor" href="#_3-为了导入已经存在的协议文件-你还必须调用下面的api"><span>(3) 为了导入已经存在的协议文件，你还必须调用下面的API</span></a></h3><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/*</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * @param ndpi_mod 指向当前操作的探测模块</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * @param path 协议文件的路径</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> */</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ndpi_load_protocols_file</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">structndpi_detection_module_struct </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">ndpi_mod</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> char*</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-一旦从你的pcap文件或设备接口上捕获到了数据流-就可以调用下面的api来进行分析" tabindex="-1"><a class="header-anchor" href="#_4-一旦从你的pcap文件或设备接口上捕获到了数据流-就可以调用下面的api来进行分析"><span>(4) 一旦从你的pcap文件或设备接口上捕获到了数据流，就可以调用下面的API来进行分析</span></a></h3><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/**</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * </span><span style="--shiki-light:#A626A4;--shiki-light-font-style:italic;--shiki-dark:#C678DD;--shiki-dark-font-style:italic;">@param</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> *     ndpi_struct 指向传入包所属的探测模块</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> *     ndpi_flow 指向传入包所属的数据流</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> *     packet 指向传入包的IP头</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> *     packetlen IP包的长度</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> *     current_tick_l 收到该IP包的时间(ms)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> *     src 指向源用户状态机</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> *     dst 指向目的用户状态机</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> */</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ndpi_protocolndpi_detection_process_packet</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    structndpi_detection_module_struct </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">ndpi_struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    structndpi_flow_struct </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">flow</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    constunsigned </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">char</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">packet</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    constunsigned </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">short</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> packetlen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    constu_int64_t</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> current_tick_l</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    structndpi_id_struct </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">src</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    structndpi_id_struct </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">dst</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>备注：本API是ndpi核心库处理收到包的入口，通过分析传入的IP包，完成数据流的识别，最后返回是别结果</p><p>如果想了解更深入的信息，我们建议你阅读下面这些文件：</p><ul><li>nDPI/example/pcapReader.c</li><li>nDPI/src/include/ndpi_structs.h</li><li>nDPI/src/include/ndpi_public_functions.h</li><li>nDPI/src/ndpi_main.c</li></ul><p>具体的协议解析器文件都被放在 nDPI/src/protocols 文件夹中。</p><h2 id="开发ndpi自定义协议" tabindex="-1"><a class="header-anchor" href="#开发ndpi自定义协议"><span>开发nDPI自定义协议</span></a></h2><p>在这一节中，我们将展示将你的协议包含在nDPI中的方法。</p><h3 id="介绍-1" tabindex="-1"><a class="header-anchor" href="#介绍-1"><span>介绍</span></a></h3><p>每个nDPI协议都会作为一个入口函数被实现，在运行时通过nDPI被使用。nDPI有几个协议可以被用来当作这个方面的例子。下面，我们列出了一些主要的概念，如果你打算开发一个nDPI协议，这些是你必须知道的。</p><h3 id="创建新的协议" tabindex="-1"><a class="header-anchor" href="#创建新的协议"><span>创建新的协议</span></a></h3><p>每一个协议都必须在下面的头文件中有一个对应的#define：</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">nDPI source code directory</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&gt;/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">src</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">include</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">ndpi_protocols_osdpi.h</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>例如：</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> NDPI_PROTOCOL_MY_PROTOCOL</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">     171</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// NDPI_PROTOCOL_MY_PROTOCOL是这个协议的名字，171是这个协议的ID，且必须是独一无二的。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>协议被定义好了之后，你必须创建一个协议源文件，就像：</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">nDPI source code direcotry</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&gt;/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">src</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">lib</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">protocols</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">my_protocol.c</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>包括以下内容</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;ndpi_utils.h&quot;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#ifdef</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> NDPI_PROTOCOL_MY_PROTOCOLS</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">……</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#endif</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在里面，需要定义一个入口函数，如：</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ndpi_search_my_protocol</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	struct</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> ndpi_detection_module_struct </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">ndpi_struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    struct</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> ndpi_flow_struct </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">flow</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ndpi_packet_struct </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">packet </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> &amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">flow</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">packet</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    NDPI_LOG</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(NDPI_PROTOCOL_MY_PROTOCOL, ndpi_struct, NDPI_LOG_DEBUG, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;my protocol detection...</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // skip marked packets by checking if the detection protocol stack</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">packet</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">detected_protocol_stack</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] ！</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> NDPI_PROTOCOL_MY_PROTOCOL){</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        ndpi_check_my_protocol</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(ndpi_struct, flow);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>和一个检测核心函数，用来处理一个流的数据包，包括以下内容：</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ndpi check my </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">protocol</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	struct</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> ndpi detection module </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">struct</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">ndpi </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	struct</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> ndpi flow </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">struct</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">flow</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ndpi packet </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">struct</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">packet </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> &amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">flow</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">packet</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	u int32 t payload len </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> packet</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">payload</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> packet len;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	.....</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	.....</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Found Protocol&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">		NDPI </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">LOG</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(NDPI PROTOCOL MY PROTOCOL, ndpi </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, NDPI LOG DEBUG，</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Found my protocol.</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">		ndpi </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> my_protocol add </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">connection</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(ndpi </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">，flow);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	/*Exclude Protocol*/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	NDPI </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">LOG</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(NDPI PROTOCOL MY PROTOCOL, ndpi </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">，NDPI LOG DEBUG, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;exclude my protocol.</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	NDPI ADD PROTOCOL TO </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">BITMASK</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">		flow</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">excluded</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> protocol bitmask,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">		NDPI PROTOCOL MY PROTOCOL</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    );</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>和一个特定的函数用来报告关于协议正确的识别信息，如：</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ndpi </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> my protocol add </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">connection</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	struct</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> ndpi detection module </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">struct</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">ndpi </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	struct</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> ndpi flow </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">struct</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">flow</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">	u_int8_t</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> due to correlation</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	ndpi </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> add </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">connection</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(ndpi </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, flow, NDPI PROTOCOL MY PROTOCOL, </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		/*Choose the type of your protocol*/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">		NDPI_CORRELATED_PROTOCOL or NDPI_REAL_PROTOCOL</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="添加你的协议到ndpi" tabindex="-1"><a class="header-anchor" href="#添加你的协议到ndpi"><span>添加你的协议到nDPI</span></a></h3><p>协议被创建之后，你必须在下面的头文件中声明你的入口函数：</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">nDPI source code directory</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&gt;/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">src</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">include</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">ndpi_protocols.h</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>包括如下内容：</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/* my protocol entry */</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ndpi search my </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">protocol</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	struct</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> ndpi detection module </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">struct</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">ndpi </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	struct</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> ndpi flow </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">struct</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">flow</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>每个协议必须与一个NDPI_SELECTION_BITMASK相关联。NDPI_SELECTION_BITMASK的完整列表被包含在文件：</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">nDPI source code directory</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&gt;/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">src</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">include</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">ndpi_define.h</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>在为你的协议选择了一个确定的位掩码之后，你必须通知nDPI新协议的存在，通过编辑文件：</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">nDPI source code directory</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&gt;/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">src</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">lib</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">ndpi_main.h</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>你需要将你的协议添加到如下函数中：</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ndpi set protocol detection </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">bitmask2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	struct</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> ndpi detection module </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">struct</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">ndpi </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	const</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> NDPI PROTOCOL BITMASK </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> dbm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">......</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">......</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">......</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#ifdef</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> NDPI</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> PROTOCOL</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> MY</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> PROTOCOL</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	ndpi set bitmask protocol </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">detection</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">ndpi </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> detection </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">bitmask</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> a</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">                                    	NDPI PROTOCOL MY </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">PROTOCOL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">                                    	ndpi search my </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">protoco1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">                                    	NDPI SELECTION BITMASK MY </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">PROTOCOL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">                                    	SAVE DETECTION BITMASK AS </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">UNKNOW</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">                                    	ADD TO DETECTION </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">BITMASK</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	/* 更新回调缓冲区索引 */</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	a</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">++</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#endif</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">ndpi </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">struct-&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">callback buffer size </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> a;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">NDPI </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">LOG</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">NDPI PROTOCOL UNKNOWN，ndpi </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">struct</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">，NDPI LOG </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">DEBUG</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         &quot;callback buffer size is u</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> ndpi </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">struct-&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">callback buffer </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">size</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,105)]))}const p=s(h,[["render",t],["__file","nDPI快速上手指南.pdf - 翻译与补充版.html.vue"]]),d=JSON.parse('{"path":"/01.%20DesignAndDevelop/Develop/02.%20Theory/Computer/03.%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%20-%20%E4%B8%93%E9%A2%98%E6%88%96%E5%AD%90%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AD%97%E5%85%B8%E7%89%88/%E4%B8%8B%E5%B1%82%E7%9B%B8%E5%85%B3/Network/%E7%BD%91%E7%BB%9C%E5%BA%93/%E6%97%A0%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%BA%93/nDPI/%E5%AE%98%E7%BD%91/nDPI%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97.pdf%20-%20%E7%BF%BB%E8%AF%91%E4%B8%8E%E8%A1%A5%E5%85%85%E7%89%88.html","title":"nDPI","lang":"zh-CN","frontmatter":{"description":"nDPI 目录 nDPI快速上手指南 参考： nDPI快速上手指南 或 nDPI – 快速入门指南(翻译自官方文档)，这两篇其实都是对官方文档的一个润色翻译，我综合着来看 nDPI官方文档 nDPI- Quick Start Guide 这是一篇针对nDPI官方文档 nDPI- Quick Start Guide 的翻译，由于文档太老了(13年)，所以...","head":[["meta",{"property":"og:url","content":"https://LincDocs.github.io/MdNote_Public/01.%20DesignAndDevelop/Develop/02.%20Theory/Computer/03.%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%20-%20%E4%B8%93%E9%A2%98%E6%88%96%E5%AD%90%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AD%97%E5%85%B8%E7%89%88/%E4%B8%8B%E5%B1%82%E7%9B%B8%E5%85%B3/Network/%E7%BD%91%E7%BB%9C%E5%BA%93/%E6%97%A0%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%BA%93/nDPI/%E5%AE%98%E7%BD%91/nDPI%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%8C%87%E5%8D%97.pdf%20-%20%E7%BF%BB%E8%AF%91%E4%B8%8E%E8%A1%A5%E5%85%85%E7%89%88.html"}],["meta",{"property":"og:site_name","content":"MdNote_Public"}],["meta",{"property":"og:title","content":"nDPI"}],["meta",{"property":"og:description","content":"nDPI 目录 nDPI快速上手指南 参考： nDPI快速上手指南 或 nDPI – 快速入门指南(翻译自官方文档)，这两篇其实都是对官方文档的一个润色翻译，我综合着来看 nDPI官方文档 nDPI- Quick Start Guide 这是一篇针对nDPI官方文档 nDPI- Quick Start Guide 的翻译，由于文档太老了(13年)，所以..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-02-03T08:19:47.000Z"}],["meta",{"property":"article:modified_time","content":"2025-02-03T08:19:47.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"nDPI\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-02-03T08:19:47.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"LincDocs\\",\\"url\\":\\"https://github.com/LincDocs/MdNote_Public/\\"}]}"]]},"headers":[{"level":1,"title":"nDPI","slug":"ndpi","link":"#ndpi","children":[]},{"level":1,"title":"目录","slug":"目录","link":"#目录","children":[]},{"level":1,"title":"nDPI快速上手指南","slug":"ndpi快速上手指南","link":"#ndpi快速上手指南","children":[{"level":2,"title":"介绍","slug":"介绍","link":"#介绍","children":[]},{"level":2,"title":"nDPI库编译与运行","slug":"ndpi库编译与运行","link":"#ndpi库编译与运行","children":[{"level":3,"title":"编译 nDPI 源代码","slug":"编译-ndpi-源代码","link":"#编译-ndpi-源代码","children":[]},{"level":3,"title":"编译示例程序 —— ndpiReader","slug":"编译示例程序-——-ndpireader","link":"#编译示例程序-——-ndpireader","children":[{"level":4,"title":"ndpiReader 的命令行选项","slug":"ndpireader-的命令行选项","link":"#ndpireader-的命令行选项","children":[]}]},{"level":3,"title":"协议文件","slug":"协议文件","link":"#协议文件","children":[]}]},{"level":2,"title":"示例 —— ndpiReader程序","slug":"示例-——-ndpireader程序","link":"#示例-——-ndpireader程序","children":[{"level":3,"title":"现场捕获模式","slug":"现场捕获模式","link":"#现场捕获模式","children":[]},{"level":3,"title":"文件捕获模式","slug":"文件捕获模式","link":"#文件捕获模式","children":[]},{"level":3,"title":"协议文件","slug":"协议文件-1","link":"#协议文件-1","children":[]}]},{"level":2,"title":"API nDPI","slug":"api-ndpi","link":"#api-ndpi","children":[{"level":3,"title":"(1) 创建并初始化一个nDPI核心库探测模块","slug":"_1-创建并初始化一个ndpi核心库探测模块","link":"#_1-创建并初始化一个ndpi核心库探测模块","children":[]},{"level":3,"title":"(2) ndpiReader接下来通过一些宏使能了探测模块中的所有协议(显然你可以根据自己的需求来决定使能哪些协议)","slug":"_2-ndpireader接下来通过一些宏使能了探测模块中的所有协议-显然你可以根据自己的需求来决定使能哪些协议","link":"#_2-ndpireader接下来通过一些宏使能了探测模块中的所有协议-显然你可以根据自己的需求来决定使能哪些协议","children":[]},{"level":3,"title":"(3) 为了导入已经存在的协议文件，你还必须调用下面的API","slug":"_3-为了导入已经存在的协议文件-你还必须调用下面的api","link":"#_3-为了导入已经存在的协议文件-你还必须调用下面的api","children":[]},{"level":3,"title":"(4) 一旦从你的pcap文件或设备接口上捕获到了数据流，就可以调用下面的API来进行分析","slug":"_4-一旦从你的pcap文件或设备接口上捕获到了数据流-就可以调用下面的api来进行分析","link":"#_4-一旦从你的pcap文件或设备接口上捕获到了数据流-就可以调用下面的api来进行分析","children":[]}]},{"level":2,"title":"开发nDPI自定义协议","slug":"开发ndpi自定义协议","link":"#开发ndpi自定义协议","children":[{"level":3,"title":"介绍","slug":"介绍-1","link":"#介绍-1","children":[]},{"level":3,"title":"创建新的协议","slug":"创建新的协议","link":"#创建新的协议","children":[]},{"level":3,"title":"添加你的协议到nDPI","slug":"添加你的协议到ndpi","link":"#添加你的协议到ndpi","children":[]}]}]}],"git":{"createdTime":1738570787000,"updatedTime":1738570787000,"contributors":[{"name":"Linc","username":"Linc","email":"762699299@qq.com","commits":1,"url":"https://github.com/Linc"}]},"readingTime":{"minutes":12.24,"words":3671},"filePathRelative":"01. DesignAndDevelop/Develop/02. Theory/Computer/03. 计算机系统 - 专题或子系统的字典版/下层相关/Network/网络库/无协议栈库/nDPI/官网/nDPI快速上手指南.pdf - 翻译与补充版.md","localizedDate":"2025年2月3日","excerpt":"\\n<h1>目录</h1>\\n<h1>nDPI快速上手指南</h1>\\n<p>参考：</p>\\n<ul>\\n<li><a href=\\"https://blog.csdn.net/banruoju/article/details/78806533\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">nDPI快速上手指南</a> 或 <a href=\\"https://blog.csdn.net/A_lber_t/article/details/89552332\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">nDPI – 快速入门指南(翻译自官方文档)</a>，这两篇其实都是对官方文档的一个润色翻译，我综合着来看\\n<ul>\\n<li>nDPI官方文档 <a href=\\"https://github.com/ntop/nDPI/blob/dev/doc/guide/nDPI_QuickStartGuide.pdf\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">nDPI- Quick Start Guide</a></li>\\n</ul>\\n</li>\\n</ul>","autoDesc":true,"bioChainData":{"outlink":[],"backlink":[],"localMap":{"nodes":[{"id":"01. DesignAndDevelop/Develop/02. Theory/Computer/03. 计算机系统 - 专题或子系统的字典版/下层相关/Network/网络库/无协议栈库/nDPI/官网/nDPI快速上手指南.pdf - 翻译与补充版.md","value":{"title":"nDPI快速上手指南.pdf - 翻译与补充版","path":"01. DesignAndDevelop/Develop/02. Theory/Computer/03. 计算机系统 - 专题或子系统的字典版/下层相关/Network/网络库/无协议栈库/nDPI/官网/nDPI快速上手指南.pdf - 翻译与补充版.md","outlink":[],"backlink":[]}}],"links":[]}}}');export{p as comp,d as data};
