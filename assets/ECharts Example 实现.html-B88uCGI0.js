import{_ as t,c as o,b as a,o as d}from"./app-C4kEW0EF.js";const r="/MdNote_Public/assets/c7656dda300f7b292192e48768807b75-B9JVshEn.png",n={};function c(s,e){return d(),o("div",null,[...e[0]||(e[0]=[a('<h1 id="echarts-example-实现-——-sandbox" tabindex="-1">ECharts Example 实现 —— sandbox</h1><h2 id="echarts-example-实现-——-sandbox-1" tabindex="-1">ECharts Example 实现 —— sandbox</h2><p><a href="https://github.com/apache/echarts-examples/blob/5442d0d963ea072e8e1395f1f4da0ebe86abe5fd/src/editor/sandbox/openwith/helper.js#L50" target="_blank" rel="noopener noreferrer">https://github.com/apache/echarts-examples/blob/5442d0d963ea072e8e1395f1f4da0ebe86abe5fd/src/editor/sandbox/openwith/helper.js#L50</a></p><p>研究了一下ECharts官网的Examples页的做法，那边是沙箱不是AsyncFunction，更安全，也更耗性能，好像也不太好参考。放这里备忘一下</p><p>(1) 先从js模板开始。myChart也是在模板内定义的。 ![](file:///C:\\Users\\76269\\AppData\\Local\\Temp\\1914cda3-f5df-4253-a084-64a9a8fe20f5.png)</p><p>(2) 该模板通过 <code>helper.js::getTemplates</code> 返回给 editor/sandbox/openwith/codesandbox.js<br> 包括js模板 (作为沙箱中的 index.js 主入口)、html模板 (通过 <code>&lt;script&gt;</code> 提供 echarts 环境)</p><p><img src="'+r+'" alt="" loading="lazy"></p><h2 id="比较-sandbox-和-asyncfunction" tabindex="-1">比较 sandbox 和 AsyncFunction</h2><p>(gemini 2.5 pro)</p><h3 id="核心定义" tabindex="-1">核心定义</h3><ul><li>沙箱 (Sandbox) <ul><li>是什么：一个隔离的、受限制的程序执行环境。它的核心目的是安全地运行不被信任的代码，防止这些代码访问或破坏主应用程序、操作系统或宿主环境。</li><li>如何实现：沙箱的实现方式多种多样，从简单的上下文隔离到复杂的虚拟机技术。在 Node.js 中，常见的实现包括： <ul><li>使用 <code>vm</code> 模块创建一个隔离的 V8 上下文。</li><li>使用独立的子进程 (<code>child_process</code>) 或工作线程 (<code>worker_threads</code>)。</li><li>使用第三方库，如 <code>vm2</code> (尽管 <code>vm2</code> 曾被发现有多个严重漏洞，但其设计思想是值得参考的)。</li><li>使用更重量级的容器技术（如 Docker）或微型虚拟机（如 Firecracker）。</li></ul></li><li>目标：<strong>安全第一</strong>。限制代码的权限，比如禁止文件系统访问、网络请求、访问全局变量等。</li></ul></li><li>AsyncFunction <ul><li>是什么：一个 JavaScript 的内置构造函数，与 <code>Function</code> 和 <code>eval</code> 类似。它允许你将一个字符串动态地编译成一个异步函数并执行。</li><li>如何工作：<code>const myAsyncFunc = new AsyncFunction(&#39;a&#39;, &#39;b&#39;, &#39;return await someAsyncTask(a, b);&#39;);</code></li><li>执行上下文：与 <code>eval</code> 在局部作用域执行不同，<code>AsyncFunction</code> 创建的函数总是在全局作用域中执行。这意味着在 Node.js 环境中，它可以访问所有的全局对象，比如 <code>process</code>, <code>require</code>, <code>global</code>；在浏览器中，它可以访问 <code>window</code>, <code>document</code> 等。</li><li>目标：<strong>动态执行代码</strong>。主要用于需要从字符串动态生成和运行异步逻辑的场景。</li></ul></li></ul><h3 id="全方位比较" tabindex="-1">全方位比较</h3><table><thead><tr><th>特性</th><th>沙箱 (Sandbox)</th><th><code>AsyncFunction</code></th><th>结论</th></tr></thead><tbody><tr><td>核心目标</td><td><strong>安全性</strong>：隔离并限制不可信代码。</td><td><strong>灵活性</strong>：从字符串动态创建异步函数。</td><td>目标完全不同。</td></tr><tr><td>隔离级别</td><td><strong>高</strong>。可以精细控制代码能访问的一切，包括全局变量、API、网络、文件系统。</td><td><strong>极低 (几乎为零)</strong>。创建的函数在全局作用域运行，可以访问几乎所有全局对象和 API。</td><td>沙箱提供了真正的隔离，<code>AsyncFunction</code> 没有。</td></tr><tr><td>安全性</td><td><strong>高</strong> (如果正确实现)。其存在就是为了防止恶意行为。</td><td><strong>极低 (非常不安全)</strong>。类似于 <code>eval</code>，执行任何来自用户或外部的字符串都存在巨大的安全风险。</td><td><strong>永远不要用 <code>AsyncFunction</code> 执行不可信的代码。</strong></td></tr><tr><td>使用场景</td><td>1. 在线代码编辑器/判题系统。<br>2. 插件系统，安全地执行第三方插件。<br>3. 服务器端模板引擎，隔离模板渲染逻辑。<br>4. 数据分析平台，允许用户提交自定义脚本。</td><td>1. 动态代码生成器或解释器。<br>2. 某些需要高度动态性的配置或规则引擎（且代码来源完全可信）。</td><td>沙箱用于“保护自己”，<code>AsyncFunction</code> 用于“动态执行”。</td></tr><tr><td>资源控制</td><td><strong>可以实现</strong>。一个好的沙箱可以限制代码的 CPU 执行时间、内存使用量。</td><td><strong>无法实现</strong>。<code>AsyncFunction</code> 本身不提供任何资源控制机制。无限循环或内存泄漏会直接影响主进程。</td><td>沙箱在稳定性和防滥用方面远超 <code>AsyncFunction</code>。</td></tr><tr><td>实现复杂度</td><td><strong>高</strong>。构建一个真正安全的沙箱非常困难，需要处理许多边界情况和逃逸漏洞。</td><td><strong>低</strong>。只是一个简单的 API 调用。</td><td>沙箱是系统工程，<code>AsyncFunction</code> 是工具函数。</td></tr><tr><td>性能开销</td><td><strong>有</strong>。根据实现方式，开销可能从较小（<code>vm</code> 模块）到较大（子进程/容器）。上下文切换和权限检查都需要成本。</td><td><strong>较低</strong>。与直接编写的异步函数相比，有一次性的编译开销，但通常不大。</td><td><code>AsyncFunction</code> 更快，但这是以牺牲所有安全性为代价的。</td></tr></tbody></table>',13)])])}const l=t(n,[["render",c]]),p=JSON.parse('{"path":"/01.%20DesignAndDevelop/Develop/04.%20Project/Platform/Web/01.%20%E5%89%8D%E7%AB%AF%E4%B8%89%E4%BB%B6%E5%A5%97/DomType/ECharts/%E4%B8%AA%E4%BA%BA%E7%AC%94%E8%AE%B0/ECharts%20Example%20%E5%AE%9E%E7%8E%B0.html","title":"ECharts Example 实现 —— sandbox","lang":"zh-CN","frontmatter":{"create_date":"2025-11-23T00:00:00.000Z","last_date":"2025-11-23T00:00:00.000Z","author":"LincZero","tags":["源码"],"description":"ECharts Example 实现 —— sandbox ECharts Example 实现 —— sandbox https://github.com/apache/echarts-examples/blob/5442d0d963ea072e8e1395f1f4da0ebe86abe5fd/src/editor/sandbox/openwith/...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"ECharts Example 实现 —— sandbox\\",\\"image\\":[\\"file:///C:\\\\\\\\Users\\\\\\\\76269\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Temp\\\\\\\\1914cda3-f5df-4253-a084-64a9a8fe20f5.png\\"],\\"dateModified\\":\\"2025-12-17T15:21:13.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"LincZero\\"}]}"],["meta",{"property":"og:url","content":"https://LincDocs.github.io/MdNote_Public/01.%20DesignAndDevelop/Develop/04.%20Project/Platform/Web/01.%20%E5%89%8D%E7%AB%AF%E4%B8%89%E4%BB%B6%E5%A5%97/DomType/ECharts/%E4%B8%AA%E4%BA%BA%E7%AC%94%E8%AE%B0/ECharts%20Example%20%E5%AE%9E%E7%8E%B0.html"}],["meta",{"property":"og:site_name","content":"MdNote_Public"}],["meta",{"property":"og:title","content":"ECharts Example 实现 —— sandbox"}],["meta",{"property":"og:description","content":"ECharts Example 实现 —— sandbox ECharts Example 实现 —— sandbox https://github.com/apache/echarts-examples/blob/5442d0d963ea072e8e1395f1f4da0ebe86abe5fd/src/editor/sandbox/openwith/..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"file:///C:\\\\Users\\\\76269\\\\AppData\\\\Local\\\\Temp\\\\1914cda3-f5df-4253-a084-64a9a8fe20f5.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-12-17T15:21:13.000Z"}],["meta",{"property":"article:author","content":"LincZero"}],["meta",{"property":"article:tag","content":"源码"}],["meta",{"property":"article:modified_time","content":"2025-12-17T15:21:13.000Z"}]],"tag":["源码"]},"git":{"createdTime":1765984873000,"updatedTime":1765984873000,"contributors":[{"name":"Linc","username":"Linc","email":"762699299@qq.com","commits":1,"url":"https://github.com/Linc"}]},"readingTime":{"minutes":3.68,"words":1105},"filePathRelative":"01. DesignAndDevelop/Develop/04. Project/Platform/Web/01. 前端三件套/DomType/ECharts/个人笔记/ECharts Example 实现.md","excerpt":"\\n<h2>ECharts Example 实现 —— sandbox</h2>\\n<p><a href=\\"https://github.com/apache/echarts-examples/blob/5442d0d963ea072e8e1395f1f4da0ebe86abe5fd/src/editor/sandbox/openwith/helper.js#L50\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://github.com/apache/echarts-examples/blob/5442d0d963ea072e8e1395f1f4da0ebe86abe5fd/src/editor/sandbox/openwith/helper.js#L50</a></p>","autoDesc":true,"bioChainData":{"outlink":[],"backlink":[],"localMap":{"nodes":[{"id":"01. DesignAndDevelop/Develop/04. Project/Platform/Web/01. 前端三件套/DomType/ECharts/个人笔记/ECharts Example 实现.md","value":{"title":"ECharts Example 实现","path":"01. DesignAndDevelop/Develop/04. Project/Platform/Web/01. 前端三件套/DomType/ECharts/个人笔记/ECharts Example 实现.md","outlink":[],"backlink":[]}}],"links":[]}}}');export{l as comp,p as data};
