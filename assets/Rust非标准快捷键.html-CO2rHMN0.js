import{_ as n,c as l,a as s,b as e,d as a,e as h,w as k,r as p,o as r}from"./app-BHiujUQC.js";const d={};function g(A,i){const t=p("RouteLink");return r(),l("div",null,[i[7]||(i[7]=s("h1",{id:"rust非标准全局快捷键",tabindex:"-1"},"Rust非标准全局快捷键",-1)),i[8]||(i[8]=s("h2",{id:"做法",tabindex:"-1"},"做法",-1)),i[9]||(i[9]=s("h3",{id:"标准的系统级快捷键及局限性",tabindex:"-1"},"标准的系统级快捷键及局限性",-1)),s("p",null,[i[1]||(i[1]=a("如果只需要监听标准的系统级快捷键，则参考文档 (",-1)),i[2]||(i[2]=s("a",{href:"https://github.com/tauri-apps/tauri-plugin-global-shortcut",target:"_blank",rel:"noopener noreferrer"},"源码",-1)),i[3]||(i[3]=a()),i[4]||(i[4]=s("a",{href:"https://v2.tauri.app/plugin/global-shortcut/",target:"_blank",rel:"noopener noreferrer"},"文档",-1)),i[5]||(i[5]=a(") 或我笔记 (",-1)),h(t,{to:"/01.%20DesignAndDevelop/Develop/04.%20Project/Platform/Multi/Tauri/%E4%B8%AD%E6%96%87%E6%95%99%E7%A8%8B/07-%E6%8F%92%E4%BB%B6/%E5%85%A8%E5%B1%80%E5%BF%AB%E6%8D%B7%E6%96%B9%E5%BC%8F.html"},{default:k(()=>[...i[0]||(i[0]=[a("全局快捷方式",-1)])]),_:1}),i[6]||(i[6]=a(") 中的 Shortcut Plugin 就行",-1))]),i[10]||(i[10]=e(`<p>这里关注的是像 AutoHotKey 或 Kanata 那种非标准快捷键，像 <code>Caps+F</code> <code>&#39;+D</code> 等</p><h3 id="底层键盘钩子" tabindex="-1">底层键盘钩子</h3><p>如果你真的需要像 Kanata 那样支持“非标准”修饰键（如 Caps、特殊自定义键），你需要用原生代码实现键盘钩子，然后和 Tauri 通信。</p><p>如 rdev 或 gilrs 库等</p><h4 id="步骤" tabindex="-1">步骤</h4><ol><li>用 Rust crate 监听键盘事件<br> 推荐用 <a href="https://crates.io/crates/device_query" target="_blank" rel="noopener noreferrer"><code>device_query</code></a> 或 <a href="https://crates.io/crates/rdev" target="_blank" rel="noopener noreferrer"><code>rdev</code></a> 实现全局键盘监听。</li><li>判断组合键状态<br> 在事件回调里判断“Caps+F”等自定义组合。</li><li>通过 Tauri Emit 或命令通信给前端<br> 用 Tauri 的 <code>emit</code> 或自定义命令把事件传到前端 JS。</li></ol><h4 id="例子-用-rdev-监听-caps-f" tabindex="-1">例子（用 <code>rdev</code> 监听 Caps+F）</h4><div class="language-rust line-numbers-mode" data-highlighter="shiki" data-ext="rust" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-rust"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">use</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> rdev</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::{listen, </span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;">Event</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;">EventType</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;">Key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">fn</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    let</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> mut</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> caps_active</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    listen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">move</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> |</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">event</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;">Event</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">|</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        match</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> event</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.event_type {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">            EventType</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">KeyPress</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">Key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;">CapsLock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) =&gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">caps_active</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">            EventType</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">KeyRelease</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">Key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;">CapsLock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) =&gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">caps_active</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">            EventType</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">KeyPress</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">Key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;">KeyF</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> caps_active</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =&gt; {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                println!</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Caps+F detected!&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                // 这里可以用 tauri::api::process::Command 或 tauri::window.emit 通知前端</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">            _</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =&gt; {}</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">unwrap</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意: 该例子无法组止 CapsLock 的原行为</p><h3 id="阻止-caps-原行为及模拟-需要-unstable-grab-功能" tabindex="-1">阻止 Caps 原行为及模拟 (需要 <code>unstable_grab</code> 功能)</h3><p>rdev 官方文档其实已经说明了这个例子: <a href="https://docs.rs/rdev/0.5.3/rdev/" target="_blank" rel="noopener noreferrer">https://docs.rs/rdev/0.5.3/rdev/</a></p><p>原文:</p><blockquote><p>（需要启用 <code>unstable_grab</code> (不稳定抓取) 功能）</p><p>如果使用 <code>unstable_grab</code> 功能来安装此库，将会添加 <code>grab</code> 函数，该函数会连接到全局输入设备事件流中。</p><p>通过为该函数提供一个回调函数，<strong>您可以拦截所有键盘和鼠标事件，使其在传递给应用程序/窗口管理器之前被拦截。在回调函数中，返回 None 表示忽略该事件，而返回该事件则允许其继续传递。目前这里尚无法对事件进行修改</strong>。</p><p>注意：此处所用的 <code>unstable</code> (不稳定) 一词特指抓取 API 存在不稳定性和易变性这一事实。</p></blockquote><p>原代码:</p><div class="language-rust line-numbers-mode" data-highlighter="shiki" data-ext="rust" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-rust"><span class="line"><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">#[cfg(feature </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;unstable_grab&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">)]</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">use</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> rdev</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::{grab, </span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;">Event</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;">EventType</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;">Key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">#[cfg(feature </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;unstable_grab&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">)]</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> callback</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> |</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">event</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;">Event</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">|</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -&gt; </span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;">Option</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;">Event</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> let</span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;"> EventType</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">KeyPress</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">Key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;">CapsLock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> event</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.event_type {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        println!</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Consuming and cancelling CapsLock&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        None</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // CapsLock is now effectively disabled</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    else</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Some</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">event</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// This will block.</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">#[cfg(feature </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;unstable_grab&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">)]</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> let</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Err</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> grab</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">callback</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    println!</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Error: {:?}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="参考-kanata-的做法" tabindex="-1">参考 Kanata 的做法</h3><p><a href="https://github.com/kinetiknz/kanata" target="_blank" rel="noopener noreferrer">Kanata</a> 是用 Rust 写的键盘 remapper，它直接用系统钩子监听键盘事件，并进行自定义映射。</p><p>你可以：</p><ul><li>复用 Kanata 的底层监听逻辑，或参考其源码，集成到 Tauri 的 Rust 后端。</li><li>或者先用 Kanata remap 键盘，然后 Tauri 只监听更简单的快捷键。</li></ul><h2 id="我的实践" tabindex="-1">我的实践</h2><h3 id="项目" tabindex="-1">项目</h3><p>参见: <a href="https://github.com/any-menu/any-menu/blob/main/src/Tauri/src-tauri/src/ad_shortcut.rs" target="_blank" rel="noopener noreferrer">https://github.com/any-menu/any-menu/blob/main/src/Tauri/src-tauri/src/ad_shortcut.rs</a></p><p>与前面纸上谈兵的一些不同的:</p><h3 id="修饰键问题" tabindex="-1">修饰键问题</h3><p>监听依然用了 rdev，但是发送不用 rdev，存在问题，而改用了 enigo。原因是 rdev 无法很好地配合修饰键使用:</p><div class="language-rust line-numbers-mode" data-highlighter="shiki" data-ext="rust" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-rust"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/** 高级快捷键</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * 常规的系统级快捷键使用 Tauri 的快捷键插件即可，但非系统级快捷键要自己处理</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * ## 一些bug问题 - Shift+LeftArrow为例:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * \`\`\`rust</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * # rdev::simulate 的版本存在问题</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * # simulate() 发出按键后，在按键按下前会自动松开Shift键，松开对应键后再自动按回Shift键。导致Shift键环境丢失</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * # 感觉 rdev 没有设计成能很好地支持快捷键</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * let _ = simulate(&amp;EventType::KeyPress(Key::ShiftLeft));</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * let _ = simulate(&amp;EventType::KeyPress(Key::LeftArrow));</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * let _ = simulate(&amp;EventType::KeyRelease(Key::LeftArrow));</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * let _ = simulate(&amp;EventType::KeyRelease(Key::ShiftLeft));</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * \`\`\`</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> *</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * \`\`\`rust</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * #enigo.key 的版本正常，不区分左右Ctrl/Shift</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * let mut enigo = Enigo::new(&amp;Settings::default()).unwrap();</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * let _ = enigo.key(enigo::Key::Shift, Press);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * let _ = enigo.key(enigo::Key::LeftArrow, Click);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * let _ = enigo.key(enigo::Key::Shift, Release);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * \`\`\`</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> */</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="caps模拟、虚拟键、不使用层等问题" tabindex="-1">Caps模拟、虚拟键、不使用层等问题</h3><p>我用了几个变量来处理:</p><div class="language-rust line-numbers-mode" data-highlighter="shiki" data-ext="rust" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-rust"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> caps_active</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;"> Cell</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">new</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);         </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 是否激活 Caps 层</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> caps_active_used</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;"> Cell</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">new</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);    </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 是否使用过激活后的 Caps 层</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> virtual_event_flag</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;"> Cell</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">new</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 跳过虚拟行为，避免递归</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="聚焦于应用自身时无法监听" tabindex="-1">聚焦于应用自身时无法监听</h3><p>暂无解决，解决中......</p><p>问题描述为:</p><blockquote><p>我聚焦到这个应用本身的应用窗口上时，无法监听到任何事件 (聚焦在其他任何窗口上，都能正常监听)<br> 使用的 rdev 的 listen 和 grab 均是这种情况</p><p>为什么该软件的应用窗口先于全局监听，而全局监听又先于其他软件的应用窗口？我在想能不能加一个进程来解决，全局监听进程与显示窗口的不在同一进程，这样能否通过全局监听方式监听应用自身？</p></blockquote><p>目前有两个思路，一是分开创始全局快捷键与软件内快捷键，二是把全局快捷键监听独立为一个进程而非线程</p>`,34))])}const c=n(d,[["render",g]]),y=JSON.parse(`{"path":"/01.%20DesignAndDevelop/Develop/04.%20Project/Platform/Multi/Tauri/%E6%88%91%E7%9A%84%E7%AC%94%E8%AE%B0/Rust%E9%9D%9E%E6%A0%87%E5%87%86%E5%BF%AB%E6%8D%B7%E9%94%AE.html","title":"Rust非标准全局快捷键","lang":"zh-CN","frontmatter":{"create_date":"2025-09-20T00:00:00.000Z","last_date":"2025-09-20T00:00:00.000Z","author":"LincZero","description":"Rust非标准全局快捷键 做法 标准的系统级快捷键及局限性 如果只需要监听标准的系统级快捷键，则参考文档 (源码 文档) 或我笔记 () 中的 Shortcut Plugin 就行 这里关注的是像 AutoHotKey 或 Kanata 那种非标准快捷键，像 Caps+F '+D 等 底层键盘钩子 如果你真的需要像 Kanata 那样支持“非标准”修饰...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Rust非标准全局快捷键\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-11-24T19:40:57.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"LincZero\\"}]}"],["meta",{"property":"og:url","content":"https://LincDocs.github.io/MdNote_Public/01.%20DesignAndDevelop/Develop/04.%20Project/Platform/Multi/Tauri/%E6%88%91%E7%9A%84%E7%AC%94%E8%AE%B0/Rust%E9%9D%9E%E6%A0%87%E5%87%86%E5%BF%AB%E6%8D%B7%E9%94%AE.html"}],["meta",{"property":"og:site_name","content":"MdNote_Public"}],["meta",{"property":"og:title","content":"Rust非标准全局快捷键"}],["meta",{"property":"og:description","content":"Rust非标准全局快捷键 做法 标准的系统级快捷键及局限性 如果只需要监听标准的系统级快捷键，则参考文档 (源码 文档) 或我笔记 () 中的 Shortcut Plugin 就行 这里关注的是像 AutoHotKey 或 Kanata 那种非标准快捷键，像 Caps+F '+D 等 底层键盘钩子 如果你真的需要像 Kanata 那样支持“非标准”修饰..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-11-24T19:40:57.000Z"}],["meta",{"property":"article:author","content":"LincZero"}],["meta",{"property":"article:modified_time","content":"2025-11-24T19:40:57.000Z"}]]},"git":{"createdTime":1764013257000,"updatedTime":1764013257000,"contributors":[{"name":"Linc","username":"Linc","email":"762699299@qq.com","commits":1,"url":"https://github.com/Linc"}]},"readingTime":{"minutes":4.13,"words":1240},"filePathRelative":"01. DesignAndDevelop/Develop/04. Project/Platform/Multi/Tauri/我的笔记/Rust非标准快捷键.md","excerpt":"\\n<h2>做法</h2>\\n<h3>标准的系统级快捷键及局限性</h3>\\n<p>如果只需要监听标准的系统级快捷键，则参考文档 (<a href=\\"https://github.com/tauri-apps/tauri-plugin-global-shortcut\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">源码</a> <a href=\\"https://v2.tauri.app/plugin/global-shortcut/\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">文档</a>) 或我笔记 (<a href=\\"/MdNote_Public/01.%20DesignAndDevelop/Develop/04.%20Project/Platform/Multi/Tauri/%E4%B8%AD%E6%96%87%E6%95%99%E7%A8%8B/07-%E6%8F%92%E4%BB%B6/%E5%85%A8%E5%B1%80%E5%BF%AB%E6%8D%B7%E6%96%B9%E5%BC%8F.html\\" target=\\"_blank\\">全局快捷方式</a>) 中的 Shortcut Plugin 就行</p>","autoDesc":true,"bioChainData":{"outlink":[{"title":"全局快捷方式","link":"01. DesignAndDevelop/Develop/04. Project/Platform/Multi/Tauri/中文教程/07-插件/全局快捷方式.html"}],"backlink":[],"localMap":{"nodes":[{"id":"01. DesignAndDevelop/Develop/04. Project/Platform/Multi/Tauri/我的笔记/Rust非标准快捷键.md","value":{"title":"Rust非标准快捷键","path":"01. DesignAndDevelop/Develop/04. Project/Platform/Multi/Tauri/我的笔记/Rust非标准快捷键.md","outlink":["01. DesignAndDevelop/Develop/04. Project/Platform/Multi/Tauri/中文教程/07-插件/全局快捷方式.md"],"backlink":[]}},{"id":"01. DesignAndDevelop/Develop/04. Project/Platform/Multi/Tauri/中文教程/07-插件/全局快捷方式.md","value":{"title":"全局快捷方式","path":"01. DesignAndDevelop/Develop/04. Project/Platform/Multi/Tauri/中文教程/07-插件/全局快捷方式.md","outlink":[],"backlink":[]}}],"links":[{"source":"01. DesignAndDevelop/Develop/04. Project/Platform/Multi/Tauri/我的笔记/Rust非标准快捷键.md","target":"01. DesignAndDevelop/Develop/04. Project/Platform/Multi/Tauri/中文教程/07-插件/全局快捷方式.md"}]}}}`);export{c as comp,y as data};
