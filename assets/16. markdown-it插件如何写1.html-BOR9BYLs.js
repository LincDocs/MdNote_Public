import{_ as o,c as i,e as p,a,b as s,d as e,o as l,r as c}from"./app-Dt9PEj-q.js";const r="/MdNote_Public/assets/1CA8004E-45BF-4a5d-A380-8A0B6EAFE1E3-P13M58hm.png",u="/MdNote_Public/assets/CE60BC07-AC76-49c2-BB30-53EC62697C78_-rGOLVem1.png",k="/MdNote_Public/assets/7f8c8858617486d2023168c787666df6-C-Yz5m8Z.png",d={},m={href:"https://link.juejin.cn?target=https%3A%2F%2Fmarkdown-it.github.io%2Fmarkdown-it%2F%23MarkdownIt.prototype.renderer",target:"_blank",rel:"noopener noreferrer"},v={href:"https://link.juejin.cn?target=https%3A%2F%2Fmarkdown-it.github.io%2Fmarkdown-it%2F%23Renderer",target:"_blank",rel:"noopener noreferrer"},b={href:"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmarkdown-it%2Fmarkdown-it%2Fblob%2Fmaster%2Flib%2Frenderer.js",target:"_blank",rel:"noopener noreferrer"},g={href:"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvuejs%2Fvuepress%2Fblob%2Fmaster%2Fpackages%2F%40vuepress%2Fmarkdown%2Flib%2FpreWrapper.js",target:"_blank",rel:"noopener noreferrer"},f={href:"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmqyqingfeng%2FBlog%2Fissues%2F251",target:"_blank",rel:"noopener noreferrer"},w={href:"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmarkdown-it%2Fmarkdown-it%2Fblob%2Fmaster%2Fdocs%2Farchitecture.md",target:"_blank",rel:"noopener noreferrer"},y={href:"https://link.juejin.cn?target=https%3A%2F%2Fmarkdown-it.github.io%2Fmarkdown-it%2F%23Token",target:"_blank",rel:"noopener noreferrer"},h={href:"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmarkdown-it%2Fmarkdown-it%2Fblob%2Fmaster%2Flib%2Ftoken.js",target:"_blank",rel:"noopener noreferrer"},x={href:"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmarkdown-it%2Fmarkdown-it%2Fblob%2Fmaster%2Fdocs%2Farchitecture.md",target:"_blank",rel:"noopener noreferrer"},F={href:"https://link.juejin.cn?target=https%3A%2F%2Fmarkdown-it.github.io%2F",target:"_blank",rel:"noopener noreferrer"};function j(q,n){const t=c("ExternalLinkIcon");return l(),i("div",null,[n[45]||(n[45]=p('<h1 id="markdown-it-插件如何写-一" tabindex="-1"><a class="header-anchor" href="#markdown-it-插件如何写-一"><span>markdown-it 插件如何写（一）</span></a></h1><p>这一篇给的示例都是：如何去修改渲染规则</p><h2 id="renderer" tabindex="-1"><a class="header-anchor" href="#renderer"><span>renderer</span></a></h2><p><code>markdown-it</code> 的渲染过程分为两部分</p><ul><li><p><code>Parse</code></p></li><li><p><code>Render</code></p><p>如果我们要更改渲染的效果，就比如在外层包裹一层 <code>div</code>，或者修改 HTML 元素的属性、添加 <code>class</code> 等，就可以从 <code>Render</code> 过程入手。</p></li></ul>',5)),a("p",null,[n[1]||(n[1]=s("在 ")),a("a",m,[n[0]||(n[0]=s("markdown-it 的官方文档")),e(t)]),n[2]||(n[2]=s(" 里就可以找到自定义 ")),n[3]||(n[3]=a("code",null,"Render",-1)),n[4]||(n[4]=s(" 渲染规则的方式："))]),a("blockquote",null,[a("p",null,[n[6]||(n[6]=s("Instance of ")),a("a",v,[n[5]||(n[5]=s("Renderer")),e(t)]),n[7]||(n[7]=s(". Use it to modify output look. Or to add rendering rules for new token types, generated by plugins."))]),n[8]||(n[8]=a("p",null,"译：Renderer的实例。使用它来修改输出外观。或者为插件生成的新令牌类型添加呈现规则。",-1))]),n[46]||(n[46]=p(`<div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">var</span> md <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;markdown-it&#39;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">myToken</span><span class="token punctuation">(</span><span class="token parameter">tokens<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> options<span class="token punctuation">,</span> env<span class="token punctuation">,</span> self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

md<span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>rules<span class="token punctuation">[</span><span class="token string">&#39;my_token&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> myToken
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1)),a("p",null,[n[10]||(n[10]=a("code",null,"markdown-it",-1)),n[11]||(n[11]=s(" 内置了一些默认的 ")),n[12]||(n[12]=a("code",null,"rules",-1)),n[13]||(n[13]=s("，你可以直接修改它们，具体有哪些以及渲染方式可以查看 ")),a("a",b,[n[9]||(n[9]=s("renderer.js 的源码")),e(t)]),n[14]||(n[14]=s("，这里直接列出来："))]),n[47]||(n[47]=p('<ul><li>code_inline</li><li>code_block</li><li>fence</li><li>image</li><li>hardbreak</li><li>softbreak</li><li>text</li><li>html_block</li><li>html_inline</li></ul><h2 id="demo1-在代码块外包一层div" tabindex="-1"><a class="header-anchor" href="#demo1-在代码块外包一层div"><span>demo1，在代码块外包一层div</span></a></h2><p>例子来源：VuePress</p><p>如果我们查看 VuePress 中代码块的渲染结果，我们会发现每一个代码块外层都包了一层带 <code>extra-class</code> 类名的 <code>div</code>:</p><p><img src="'+r+'" alt="1CA8004E-45BF-4a5d-A380-8A0B6EAFE1E3" loading="lazy"></p>',5)),a("p",null,[n[16]||(n[16]=s("其实，这就是 VuePress 修改了渲染规则产生的，查看 ")),a("a",g,[n[15]||(n[15]=s("VuePress 源码")),e(t)]),n[17]||(n[17]=s("："))]),n[48]||(n[48]=p(`<div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">md</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> fence <span class="token operator">=</span> md<span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>rules<span class="token punctuation">.</span>fence
  md<span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>rules<span class="token punctuation">.</span><span class="token function-variable function">fence</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>	<span class="token comment">// 修改 \`围栏代码块\` 的渲染规则</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>tokens<span class="token punctuation">,</span> idx<span class="token punctuation">]</span> <span class="token operator">=</span> args
    <span class="token keyword">const</span> token <span class="token operator">=</span> tokens<span class="token punctuation">[</span>idx<span class="token punctuation">]</span>
    <span class="token keyword">const</span> rawCode <span class="token operator">=</span> <span class="token function">fence</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>		<span class="token comment">// rawCode是原内容，下面在原内容的外面包一一个div</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">&lt;!--beforebegin--&gt;&lt;div class=&quot;language-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>token<span class="token punctuation">.</span>info<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> extra-class&quot;&gt;</span><span class="token template-punctuation string">\`</span></span> <span class="token operator">+</span>
    <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">&lt;!--afterbegin--&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>rawCode<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;!--beforeend--&gt;&lt;/div&gt;&lt;!--afterend--&gt;</span><span class="token template-punctuation string">\`</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们可以看到这里非常巧妙的<em>避开了处理 token，直接使用渲染后的结果，在外层包了一层 div</em>。</p><h2 id="demo2-将span标签替换成a标签" tabindex="-1"><a class="header-anchor" href="#demo2-将span标签替换成a标签"><span>demo2，将span标签替换成a标签</span></a></h2><p>例子来源：VuePress作者博客的例子</p>`,4)),a("p",null,[n[19]||(n[19]=s("类似于 VuePress 的这种方式，我们也可以在获取默认渲染内容后，再使用 replace 替换掉一些内容，比如在 ")),a("a",f,[n[18]||(n[18]=s("《VuePress 博客优化之拓展 Markdown 语法》")),e(t)]),n[20]||(n[20]=s(" 这篇中，我们自定义了一个代码块语法，就是在 ")),n[21]||(n[21]=a("code",null,"rules.fence",-1)),n[22]||(n[22]=s("中修改了渲染的内容："))]),n[49]||(n[49]=p(`<div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>md<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">md</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> fence <span class="token operator">=</span> md<span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>rules<span class="token punctuation">.</span>fence
  md<span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>rules<span class="token punctuation">.</span><span class="token function-variable function">fence</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> rawCode <span class="token operator">=</span> <span class="token function">fence</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// rawCode是原内容，下面将原内容的span标签替换成a标签</span>
    rawCode <span class="token operator">=</span> rawCode<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;span class=&quot;token comment&quot;&gt;\\/\\/ try-link https:\\/\\/(.*)&lt;\\/span&gt;\\n</span><span class="token regex-delimiter">/</span><span class="token regex-flags">ig</span></span><span class="token punctuation">,</span> <span class="token string">&#39;&lt;a href=&quot;$1&quot; class=&quot;try-button&quot; target=&quot;_blank&quot;&gt;Try&lt;/a&gt;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>rawCode<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="demo3-将视频图片替换成iframe" tabindex="-1"><a class="header-anchor" href="#demo3-将视频图片替换成iframe"><span>demo3，将视频图片替换成iframe</span></a></h2><p>例子来源：mdit官方例子</p><h3 id="插件代码" tabindex="-1"><a class="header-anchor" href="#插件代码"><span>插件代码</span></a></h3>`,4)),a("p",null,[n[24]||(n[24]=s("但不可能总是可以这么取巧，有的时候就是需要处理 token，这里我们参考 markdown-it ")),a("a",w,[n[23]||(n[23]=s("官方提供的设计准则")),e(t)]),n[25]||(n[25]=s(" 中的例子，当渲染一个图片的时候，如果链接匹配 ")),n[26]||(n[26]=a("code",null,"/^https?:\\/\\/(www\\.)?vimeo.com\\/(\\d+)($|\\/)/",-1)),n[27]||(n[27]=s("，我们就将其渲染为一个 ")),n[28]||(n[28]=a("code",null,"iframe",-1)),n[29]||(n[29]=s(" ，其他的则保持默认渲染方式："))]),n[50]||(n[50]=p(`<div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">var</span> md <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;markdown-it&#39;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> defaultRender <span class="token operator">=</span> md<span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>rules<span class="token punctuation">.</span>image<span class="token punctuation">,</span>
    vimeoRE       <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^https?:\\/\\/(www\\.)?vimeo.com\\/(\\d+)($|\\/)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>

md<span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>rules<span class="token punctuation">.</span><span class="token function-variable function">image</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">tokens<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> options<span class="token punctuation">,</span> env<span class="token punctuation">,</span> self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> token <span class="token operator">=</span> tokens<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">;</span>				<span class="token comment">// 获取图片对应的那个token (tokens+idx的方式，意味着能更灵活地查看前后token的内容)</span>
  <span class="token keyword">var</span> aIndex <span class="token operator">=</span> token<span class="token punctuation">.</span><span class="token function">attrIndex</span><span class="token punctuation">(</span><span class="token string">&#39;src&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 获取图片的src属性</span>

  <span class="token comment">// if mismatching, pass token to default renderer.</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>vimeoRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>token<span class="token punctuation">.</span>attrs<span class="token punctuation">[</span>aIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">defaultRender</span><span class="token punctuation">(</span>tokens<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> options<span class="token punctuation">,</span> env<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 替换渲染内容</span>
  <span class="token keyword">var</span> id <span class="token operator">=</span> token<span class="token punctuation">.</span>attrs<span class="token punctuation">[</span>aIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>vimeoRE<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token string">&#39;&lt;div class=&quot;embed-responsive embed-responsive-16by9&quot;&gt;\\n&#39;</span> <span class="token operator">+</span>
         <span class="token string">&#39;  &lt;iframe class=&quot;embed-responsive-item&quot; src=&quot;//player.vimeo.com/video/&#39;</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">&#39;&quot;&gt;&lt;/iframe&gt;\\n&#39;</span> <span class="token operator">+</span>
         <span class="token string">&#39;&lt;/div&gt;\\n&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="源码及代码分析" tabindex="-1"><a class="header-anchor" href="#源码及代码分析"><span>源码及代码分析</span></a></h3><h4 id="render方法" tabindex="-1"><a class="header-anchor" href="#render方法"><span>render方法</span></a></h4><p><code>rules.image</code> 传入的函数参数可以查看 <code>renderer.js</code> 的源码：</p><p>#源码</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token class-name">Renderer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">tokens<span class="token punctuation">,</span> options<span class="token punctuation">,</span> env</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> i<span class="token punctuation">,</span> len<span class="token punctuation">,</span> type<span class="token punctuation">,</span>
      result <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
      rules <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rules<span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> tokens<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    type <span class="token operator">=</span> tokens<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>type<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">&#39;inline&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">renderInline</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">,</span> options<span class="token punctuation">,</span> env<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> rules<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result <span class="token operator">+=</span> rules<span class="token punctuation">[</span>tokens<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">(</span>tokens<span class="token punctuation">,</span> i<span class="token punctuation">,</span> options<span class="token punctuation">,</span> env<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      result <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">renderToken</span><span class="token punctuation">(</span>tokens<span class="token punctuation">,</span> i<span class="token punctuation">,</span> options<span class="token punctuation">,</span> env<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="token内容及操作" tabindex="-1"><a class="header-anchor" href="#token内容及操作"><span>token内容及操作</span></a></h4><p>我们可以看到 rules 传入的参数，其中 tokens 就是指 tokens 列表，idx 则是指要渲染的 token 索引，所以在代码里才可以通过 <code>tokens[index]</code>获取目标 token。</p>`,8)),a("p",null,[n[32]||(n[32]=s("然后我们又使用了 ")),n[33]||(n[33]=a("code",null,"tokens.attrIndex",-1)),n[34]||(n[34]=s("，tokens 提供了哪些方法可以查看")),a("a",y,[n[30]||(n[30]=s("官方 API")),e(t)]),n[35]||(n[35]=s("，或者直接查看 ")),a("a",h,[n[31]||(n[31]=s("Token 源码")),e(t)]),n[36]||(n[36]=s("。"))]),n[51]||(n[51]=p(`<p>我们解释一下这个示例里用到的一些方法，先从 token 开始说起，我们举个例子，看下 <code>![video link]([https://www.vimeo.com/123)](https://www.vimeo.com/123))</code> 这句 markdown 语法产生的 token（这里进行了简化）：</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;img&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;attrs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span>
            <span class="token string">&quot;src&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;https://www.vimeo.com/123&quot;</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>
            <span class="token string">&quot;alt&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;&quot;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;children&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;attrs&quot;</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;children&quot;</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token string">&quot;video link&quot;</span><span class="token punctuation">,</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token string">&quot;video link&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到 token 是有一个 <code>attr</code> 属性的，表明了要渲染的 img 标签的属性有哪些，<code>token.attrIndex</code> 就是通过名字获取属性索引，然后再通过 <code>token.attrs[aIndex][1]</code>获取具体的属性值。</p><h2 id="demo4-给所有的链接添加target" tabindex="-1"><a class="header-anchor" href="#demo4-给所有的链接添加target"><span>demo4，给所有的链接添加target</span></a></h2><p>例子来源：mdit官方例子</p><h3 id="插件代码-1" tabindex="-1"><a class="header-anchor" href="#插件代码-1"><span>插件代码</span></a></h3>`,6)),a("p",null,[n[38]||(n[38]=s("同样是来自 markdown-it ")),a("a",x,[n[37]||(n[37]=s("官方提供的设计准则")),e(t)]),n[39]||(n[39]=s(" 中的例子，给所有的链接添加 ")),n[40]||(n[40]=a("code",null,'target="_blank"',-1)),n[41]||(n[41]=s("："))]),n[52]||(n[52]=p(`<div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// 记住旧的渲染器，如果被覆盖，或者代理默认渲染器</span>
<span class="token comment">// Remember old renderer, if overridden, or proxy to default renderer</span>
<span class="token keyword">var</span> defaultRender <span class="token operator">=</span> md<span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>rules<span class="token punctuation">.</span>link_open <span class="token operator">||</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">tokens<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> options<span class="token punctuation">,</span> env<span class="token punctuation">,</span> self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> self<span class="token punctuation">.</span><span class="token function">renderToken</span><span class="token punctuation">(</span>tokens<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 修改链接的渲染规则</span>
md<span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>rules<span class="token punctuation">.</span><span class="token function-variable function">link_open</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">tokens<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> options<span class="token punctuation">,</span> env<span class="token punctuation">,</span> self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 如果你确定其他插件不能添加 “target”，请在下面勾选</span>
  <span class="token comment">// If you are sure other plugins can&#39;t add \`target\` - drop check below</span>
  <span class="token keyword">var</span> aIndex <span class="token operator">=</span> tokens<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">attrIndex</span><span class="token punctuation">(</span><span class="token string">&#39;target&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>aIndex <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    tokens<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">attrPush</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;target&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;_blank&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加新属性，add new attribute</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    tokens<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span>attrs<span class="token punctuation">[</span>aIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&#39;_blank&#39;</span><span class="token punctuation">;</span>    <span class="token comment">// 替换旧属性，replace value of existing attr</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 然后再让旧渲染器处理token</span>
  <span class="token comment">// pass token to default renderer.</span>
  <span class="token keyword">return</span> <span class="token function">defaultRender</span><span class="token punctuation">(</span>tokens<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> options<span class="token punctuation">,</span> env<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="疑问-出现了非默认的token类型" tabindex="-1"><a class="header-anchor" href="#疑问-出现了非默认的token类型"><span>疑问：出现了非默认的token类型</span></a></h3><p>也许你会奇怪，为什么会有 <code>rules.link_open</code>？这个并不在默认规则里呀，可以直接使用吗？</p><p>还真是可以的，其实这里的 <code>link_open</code> 和之前的 <code>image</code>、<code>fence</code> 等都是 token 的 type，所以只要是 token 的 type 就可以，那 token 有哪些 type 呢？有具体的说明文档吗？</p><p>关于这个问题， <code>markdown-it </code> 也有 issues 里提出：</p><p><img src="`+u+'" alt="img" loading="lazy"></p><p>作者的意思就是，没有，如果你想写插件，你就去看源码……</p>',7)),a("p",null,[n[43]||(n[43]=s("那成吧，其实在我们的实际开发中，如果你想要知道某一个 token type，其实完全可以打印出 token 看一下，官方的 ")),a("a",F,[n[42]||(n[42]=s("Live Demo")),e(t)]),n[44]||(n[44]=s(" 提供了 debug 模式用于查看 token："))]),n[53]||(n[53]=p('<p><img src="'+k+`" alt="img" loading="lazy"></p><h3 id="扩展-一个简化技巧" tabindex="-1"><a class="header-anchor" href="#扩展-一个简化技巧"><span>扩展 - 一个简化技巧</span></a></h3><p>当然就这个例子里的需求，作者还提供了 <code>markdown-it-for-inline</code> 插件用于简化代码书写：</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">var</span> iterator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;markdown-it-for-inline&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> md <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;markdown-it&#39;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>iterator<span class="token punctuation">,</span> <span class="token string">&#39;url_new_win&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;link_open&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">tokens<span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">var</span> aIndex <span class="token operator">=</span> tokens<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">attrIndex</span><span class="token punctuation">(</span><span class="token string">&#39;target&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

              <span class="token keyword">if</span> <span class="token punctuation">(</span>aIndex <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                tokens<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">attrPush</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;target&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;_blank&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                tokens<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span>attrs<span class="token punctuation">[</span>aIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&#39;_blank&#39;</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>关于 <code>markdown-it-for-inline</code>就在以后的文章里介绍了。</p>`,5))])}const E=o(d,[["render",j],["__file","16. markdown-it插件如何写1.html.vue"]]),D=JSON.parse('{"path":"/01.%20DesignAndDevelop/Develop/04.%20Project/Type/Doc/MarkdwonAbout/02.%20Parse%20and%20Render/Markdown-it/%E3%80%8A%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E3%80%8B%E5%86%B4%E7%BE%BD/16.%20markdown-it%E6%8F%92%E4%BB%B6%E5%A6%82%E4%BD%95%E5%86%991.html","title":"markdown-it 插件如何写（一）","lang":"zh-CN","frontmatter":{"description":"markdown-it 插件如何写（一） 这一篇给的示例都是：如何去修改渲染规则 renderer markdown-it 的渲染过程分为两部分 Parse Render 如果我们要更改渲染的效果，就比如在外层包裹一层 div，或者修改 HTML 元素的属性、添加 class 等，就可以从 Render 过程入手。 在 markdown-it 的官方文...","head":[["meta",{"property":"og:url","content":"https://LincDocs.github.io/MdNote_Public/01.%20DesignAndDevelop/Develop/04.%20Project/Type/Doc/MarkdwonAbout/02.%20Parse%20and%20Render/Markdown-it/%E3%80%8A%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E3%80%8B%E5%86%B4%E7%BE%BD/16.%20markdown-it%E6%8F%92%E4%BB%B6%E5%A6%82%E4%BD%95%E5%86%991.html"}],["meta",{"property":"og:site_name","content":"MdNote_Public"}],["meta",{"property":"og:title","content":"markdown-it 插件如何写（一）"}],["meta",{"property":"og:description","content":"markdown-it 插件如何写（一） 这一篇给的示例都是：如何去修改渲染规则 renderer markdown-it 的渲染过程分为两部分 Parse Render 如果我们要更改渲染的效果，就比如在外层包裹一层 div，或者修改 HTML 元素的属性、添加 class 等，就可以从 Render 过程入手。 在 markdown-it 的官方文..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-01-19T07:08:37.000Z"}],["meta",{"property":"article:author","content":"LincDocs"}],["meta",{"property":"article:modified_time","content":"2025-01-19T07:08:37.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"markdown-it 插件如何写（一）\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-01-19T07:08:37.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"LincDocs\\",\\"url\\":\\"https://github.com/LincDocs/MdNote_Public/\\"}]}"]]},"headers":[{"level":1,"title":"markdown-it 插件如何写（一）","slug":"markdown-it-插件如何写-一","link":"#markdown-it-插件如何写-一","children":[{"level":2,"title":"renderer","slug":"renderer","link":"#renderer","children":[]},{"level":2,"title":"demo1，在代码块外包一层div","slug":"demo1-在代码块外包一层div","link":"#demo1-在代码块外包一层div","children":[]},{"level":2,"title":"demo2，将span标签替换成a标签","slug":"demo2-将span标签替换成a标签","link":"#demo2-将span标签替换成a标签","children":[]},{"level":2,"title":"demo3，将视频图片替换成iframe","slug":"demo3-将视频图片替换成iframe","link":"#demo3-将视频图片替换成iframe","children":[{"level":3,"title":"插件代码","slug":"插件代码","link":"#插件代码","children":[]},{"level":3,"title":"源码及代码分析","slug":"源码及代码分析","link":"#源码及代码分析","children":[{"level":4,"title":"render方法","slug":"render方法","link":"#render方法","children":[]},{"level":4,"title":"token内容及操作","slug":"token内容及操作","link":"#token内容及操作","children":[]}]}]},{"level":2,"title":"demo4，给所有的链接添加target","slug":"demo4-给所有的链接添加target","link":"#demo4-给所有的链接添加target","children":[{"level":3,"title":"插件代码","slug":"插件代码-1","link":"#插件代码-1","children":[]},{"level":3,"title":"疑问：出现了非默认的token类型","slug":"疑问-出现了非默认的token类型","link":"#疑问-出现了非默认的token类型","children":[]},{"level":3,"title":"扩展 - 一个简化技巧","slug":"扩展-一个简化技巧","link":"#扩展-一个简化技巧","children":[]}]}]}],"git":{"createdTime":1737270517000,"updatedTime":1737270517000,"contributors":[{"name":"Linc","email":"762699299@qq.com","commits":1}]},"readingTime":{"minutes":6.09,"words":1828},"filePathRelative":"01. DesignAndDevelop/Develop/04. Project/Type/Doc/MarkdwonAbout/02. Parse and Render/Markdown-it/《博客搭建》冴羽/16. markdown-it插件如何写1.md","localizedDate":"2025年1月19日","excerpt":"\\n<p>这一篇给的示例都是：如何去修改渲染规则</p>\\n<h2>renderer</h2>\\n<p><code>markdown-it</code> 的渲染过程分为两部分</p>\\n<ul>\\n<li>\\n<p><code>Parse</code></p>\\n</li>\\n<li>\\n<p><code>Render</code></p>\\n<p>如果我们要更改渲染的效果，就比如在外层包裹一层 <code>div</code>，或者修改 HTML 元素的属性、添加 <code>class</code> 等，就可以从 <code>Render</code> 过程入手。</p>\\n</li>\\n</ul>\\n<p>在 <a href=\\"https://link.juejin.cn?target=https%3A%2F%2Fmarkdown-it.github.io%2Fmarkdown-it%2F%23MarkdownIt.prototype.renderer\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">markdown-it 的官方文档</a> 里就可以找到自定义 <code>Render</code> 渲染规则的方式：</p>","autoDesc":true,"bioChainData":{"outlink":[],"backlink":[],"localMap":{"nodes":[{"id":"01. DesignAndDevelop/Develop/04. Project/Type/Doc/MarkdwonAbout/02. Parse and Render/Markdown-it/《博客搭建》冴羽/16. markdown-it插件如何写1.md","value":{"title":"16. markdown-it插件如何写1","path":"01. DesignAndDevelop/Develop/04. Project/Type/Doc/MarkdwonAbout/02. Parse and Render/Markdown-it/《博客搭建》冴羽/16. markdown-it插件如何写1.md","outlink":[],"backlink":[]}}],"links":[]}}}');export{E as comp,D as data};
