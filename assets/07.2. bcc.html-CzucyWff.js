import{_ as i,c as a,f as n,o as l}from"./app-CfmvdVmg.js";const h={};function t(e,s){return l(),a("div",null,s[0]||(s[0]=[n(`<h1 id="bcc-bpf-compiler-collection" tabindex="-1"><a class="header-anchor" href="#bcc-bpf-compiler-collection"><span>BCC (BPF Compiler Collection)</span></a></h1><p><code>BPF Compiler Collection</code> (<code>BCC</code>)是基于<code>eBPF</code>的<code>Linux</code>内核分析、跟踪、网络监控工具。其源码存放于<a href="https://github.com/iovisor/bcc" target="_blank" rel="noopener noreferrer">iovisor/bcc</a>。</p><h2 id="bcc包括的一些工具" tabindex="-1"><a class="header-anchor" href="#bcc包括的一些工具"><span>BCC包括的一些工具</span></a></h2><p>![Linux bcc/BPF Tracing Tools](07.2. bcc.assets/bcc_tracing_tools_2016.png)</p><h2 id="安装bcc" tabindex="-1"><a class="header-anchor" href="#安装bcc"><span>安装BCC</span></a></h2><p><code>Ubuntu</code>：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;deb [trusted=yes] https://repo.iovisor.org/apt/xenial xenial-nightly main&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tee</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/apt/sources.list.d/iovisor.list</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> apt-get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> update</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> apt-get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bcc-tools</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> libbcc-examples</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> python-bcc</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>CentOS</code>：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;[iovisor]\\nbaseurl=https://repo.iovisor.org/yum/nightly/f23/$basearch\\nenabled=1\\ngpgcheck=0&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tee</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/yum.repos.d/iovisor.repo</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">yum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bcc-tools</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>安装完成后，<code>bcc</code>工具会放到<code>/usr/share/bcc/tools</code>目录中</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ls</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/share/bcc/tools</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">argdist</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       cachestat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  ext4dist</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        hardirqs</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        offwaketime</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  softirqs</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    tcpconnect</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  vfscount</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">bashreadline</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  cachetop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   ext4slower</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      killsnoop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       old</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          solisten</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    tcpconnlat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  vfsstat</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">biolatency</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    capable</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    filelife</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        llcstat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         oomkill</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      sslsniff</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    tcplife</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     wakeuptime</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">biosnoop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      cpudist</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    fileslower</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      mdflush</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         opensnoop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    stackcount</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  tcpretrans</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  xfsdist</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">biotop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        dcsnoop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    filetop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         memleak</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         pidpersec</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    stacksnoop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  tcptop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      xfsslower</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">bitesize</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      dcstat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     funccount</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       mountsnoop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      profile</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      statsnoop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   tplist</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      zfsdist</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">btrfsdist</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     doc</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        funclatency</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     mysqld_qslower</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  runqlat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      syncsnoop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   trace</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       zfsslower</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">btrfsslower</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   execsnoop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  gethostlatency</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  offcputime</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      slabratetop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  tcpaccept</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   ttysnoop</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="常用工具示例" tabindex="-1"><a class="header-anchor" href="#常用工具示例"><span>常用工具示例</span></a></h2><h3 id="capable" tabindex="-1"><a class="header-anchor" href="#capable"><span>capable</span></a></h3><p><code>capable</code>检查<code>Linux</code>进程的<code>security capabilities</code>：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> capable</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">TIME</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      UID</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    PID</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    COMM</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">             CAP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  NAME</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                 AUDIT</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">22:11:23</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  114</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    2676</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   snmpd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">            12</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   CAP_NET_ADMIN</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">22:11:23</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      6990</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   run</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">              24</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   CAP_SYS_RESOURCE</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">     1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">22:11:23</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      7003</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   chmod</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">            3</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    CAP_FOWNER</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">           1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">22:11:23</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      7003</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   chmod</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">            4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    CAP_FSETID</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">           1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">22:11:23</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      7005</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   chmod</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">            4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    CAP_FSETID</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">           1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">22:11:23</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      7005</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   chmod</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">            4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    CAP_FSETID</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">           1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">22:11:23</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      7006</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   chown</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">            4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    CAP_FSETID</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">           1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">22:11:23</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      7006</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   chown</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">            4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    CAP_FSETID</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">           1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">22:11:23</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      6990</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   setuidgid</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        6</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    CAP_SETGID</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">           1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">22:11:23</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      6990</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   setuidgid</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        6</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    CAP_SETGID</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">           1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">22:11:23</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      6990</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   setuidgid</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        7</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    CAP_SETUID</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">           1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">22:11:24</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      7013</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   run</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">              24</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   CAP_SYS_RESOURCE</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">     1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">22:11:24</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      7026</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   chmod</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">            3</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    CAP_FOWNER</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">           1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[...]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="tcpconnect" tabindex="-1"><a class="header-anchor" href="#tcpconnect"><span>tcpconnect</span></a></h3><p><code>tcpconnect</code>检查活跃的<code>TCP</code>连接，并输出源和目的地址：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ./tcpconnect</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> PID</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    COMM</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         IP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SADDR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">            DADDR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">            DPORT</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> 2462</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   curl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">         4</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  192.168.1.99</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       74.125.23.138</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    80</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="tcptop" tabindex="-1"><a class="header-anchor" href="#tcptop"><span>tcptop</span></a></h3><p><code>tcptop</code>统计TCP发送和接受流量：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ./tcptop</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -C</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Tracing...</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Output</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> every</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> secs.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Hit</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Ctrl-C</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">08:06:45</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> loadavg:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0.04</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0.01</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0.00</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 2/174</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3099</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PID</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    COMM</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         LADDR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                 RADDR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                  RX_KB</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  TX_KB</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1740</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   sshd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         192.168.1.99:22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         192.168.0.29:60315</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">         0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">08:06:46</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> loadavg:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0.04</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0.01</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0.00</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 2/174</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3099</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PID</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    COMM</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         LADDR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                 RADDR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                  RX_KB</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  TX_KB</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1740</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   sshd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         192.168.1.99:22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         192.168.0.29:60315</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">         0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">08:06:47</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> loadavg:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0.04</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0.01</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0.00</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 2/174</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3099</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PID</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    COMM</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         LADDR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                 RADDR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                  RX_KB</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  TX_KB</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1740</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   sshd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         192.168.1.99:22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         192.168.0.29:60315</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">         0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="扩展工具" tabindex="-1"><a class="header-anchor" href="#扩展工具"><span>扩展工具</span></a></h2><p>基于<code>eBPF</code>和<code>bcc</code>，可以很方便的扩展功能。<code>bcc</code>目前支持以下事件</p><ul><li><code>kprobe__kernel_function_name</code> (<code>BPF.attach_kprobe()</code>)</li><li><code>kretprobe__kernel_function_name</code> (<code>BPF.attach_kretprobe()</code>)</li><li><code>TRACEPOINT_PROBE(category, event)</code>，支持的<code>event</code>列表参见<code>/sys/kernel/debug/tracing/events/category/event/format</code></li><li><code>BPF.attach_uprobe()</code>和<code>BPF.attach_uretprobe()</code></li><li>用户自定义探针(USDT) <code>USDT.enable_probe()</code></li></ul><h3 id="简单示例" tabindex="-1"><a class="header-anchor" href="#简单示例"><span>简单示例</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#!/usr/bin/env python</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> __future__</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> print_function</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> bcc </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#D19A66;"> BPF</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">text</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;int kprobe__sys_sync(void *ctx) { bpf_trace_printk(&quot;Hello, World!</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">n&quot;); return 0; }&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">prog</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">int hello(void *ctx) {</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        bpf_trace_printk(&quot;Hello, World!</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">n&quot;);</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        return 0;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">}</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">b </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> BPF</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">text</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">prog)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">b.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">attach_kprobe</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">event</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;sys_clone&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">fn_name</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;hello&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">%-18s</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> %-16s</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> %-6s</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> %s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> %</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;TIME(s)&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;COMM&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;PID&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;MESSAGE&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">while</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> True</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        try</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                (task, pid, cpu, flags, ts, msg) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> b.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">trace_fields</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        except</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;"> ValueError</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                continue</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">%-18.9f</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> %-16s</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> %-6d</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> %s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> %</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (ts, task, pid, msg))</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="使用bpf-perf-output" tabindex="-1"><a class="header-anchor" href="#使用bpf-perf-output"><span>使用<code>BPF_PERF_OUTPUT</code></span></a></h3><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> __future__</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> print_function</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> bcc </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#D19A66;"> BPF</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ctypes </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ct</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># load BPF program</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">b </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> BPF</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">text</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">struct data_t {</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    u64 ts;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">BPF_PERF_OUTPUT(events);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">void kprobe__sys_sync(void *ctx) {</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    struct data_t data = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">{}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    data.ts = bpf_ktime_get_ns() / 1000;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    events.perf_submit(ctx, &amp;data, sizeof(data));</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">};</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&quot;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Data</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ct</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Structure</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    _fields_ </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        (</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ts&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, ct.c_ulonglong)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># header</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">%-18s</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> %s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> %</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;TIME(s)&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;CALL&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># process event</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">def</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> print_event</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">cpu</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> size</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    event </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ct.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">cast</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(data, ct.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">POINTER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(Data)).contents</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">%-18.9f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sync()&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> %</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">float</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(event.ts) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1000000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># loop with callback to print_event</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">b[</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;events&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">].</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">open_perf_buffer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(print_event)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">while</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> True</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    b.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">kprobe_poll</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>更多的示例参考<a href="https://github.com/iovisor/bcc/blob/master/docs/tutorial_bcc_python_developer.md" target="_blank" rel="noopener noreferrer">bbc/docs/tutorial_bcc_python_developer.md</a>。</p><h3 id="用户自定义探针示例" tabindex="-1"><a class="header-anchor" href="#用户自定义探针示例"><span>用户自定义探针示例</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> __future__</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> print_function</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> bcc </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#D19A66;"> BPF</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> time </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> strftime</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ctypes </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ct</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># load BPF program</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">bpf_text </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">#include &lt;uapi/linux/ptrace.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">struct str_t {</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    u64 pid;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    char str[80];</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">BPF_PERF_OUTPUT(events);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">int printret(struct pt_regs *ctx) {</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    struct str_t data  = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">{}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    u32 pid;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    if (!PT_REGS_RC(ctx))</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        return 0;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    pid = bpf_get_current_pid_tgid();</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    data.pid = pid;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    bpf_probe_read(&amp;data.str, sizeof(data.str), (void *)PT_REGS_RC(ctx));</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    events.perf_submit(ctx,&amp;data,sizeof(data));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    return 0;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">};</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#D19A66;">STR_DATA</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 80</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Data</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ct</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Structure</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    _fields_ </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        (</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;pid&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, ct.c_ulonglong),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        (</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;str&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, ct.c_char </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#383A42;--shiki-dark:#D19A66;"> STR_DATA</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">b </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> BPF</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">text</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">bpf_text)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">b.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">attach_uretprobe</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/bin/bash&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">sym</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;readline&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">fn_name</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;printret&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># header</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">%-9s</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> %-6s</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> %s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> %</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;TIME&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;PID&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;COMMAND&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">def</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> print_event</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">cpu</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> size</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    event </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ct.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">cast</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(data, ct.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">POINTER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(Data)).contents</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">%-9s</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> %-6d</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> %s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> %</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">strftime</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;%H:%M:%S&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">), event.pid, event.str))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">b[</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;events&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">].</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">open_perf_buffer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(print_event)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">while</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    b.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">kprobe_poll</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ./bashreadline</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#D19A66;">TIME</span><span style="--shiki-light:#383A42;--shiki-dark:#D19A66;">      PID</span><span style="--shiki-light:#383A42;--shiki-dark:#D19A66;">    COMMAND</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">22</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">44</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  2070</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   ls </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">/</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">22</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">56</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  2070</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   ping </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">c3 google.com</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ./gethostlatency</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#D19A66;">TIME</span><span style="--shiki-light:#383A42;--shiki-dark:#D19A66;">      PID</span><span style="--shiki-light:#383A42;--shiki-dark:#D19A66;">    COMM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                  LATms </span><span style="--shiki-light:#383A42;--shiki-dark:#D19A66;">HOST</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">23</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">26</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  3370</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   ping                   </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2.00</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> google.com</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">23</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">37</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  3372</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   ping                  </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">56.00</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> baidu.com</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考"><span>参考</span></a></h2><ul><li><a href="https://www.iovisor.org/" target="_blank" rel="noopener noreferrer">iovisor.org</a></li><li><a href="https://www.iovisor.org/technology/ebpf" target="_blank" rel="noopener noreferrer">iovisor.org - ebpf</a></li><li><a href="https://www.iovisor.org/technology/xdp" target="_blank" rel="noopener noreferrer">iovisor.org - xdp</a></li><li><a href="https://github.com/iovisor/bpf-docs" target="_blank" rel="noopener noreferrer">iovisor/bpf-docs</a></li><li><a href="https://www.kernel.org/doc/Documentation/networking/filter.txt" target="_blank" rel="noopener noreferrer">kernel.org - fitler</a></li><li><a href="https://events.linuxfoundation.org/sites/events/files/slides/iovisor-lc-bof-2016.pdf" target="_blank" rel="noopener noreferrer">iovisor-lc-bof-2016</a></li><li><a href="https://suchakra.wordpress.com/2015/08/12/bpf-internals-ii/" target="_blank" rel="noopener noreferrer">BPF Internals – II</a></li><li><a href="https://qmonnet.github.io/whirl-offload/2016/09/01/dive-into-bpf/" target="_blank" rel="noopener noreferrer">Dive into BPF: a list of reading material</a></li><li><a href="https://github.com/cilium/cilium" target="_blank" rel="noopener noreferrer">cilium/cilium</a></li></ul>`,33)]))}const p=i(h,[["render",t],["__file","07.2. bcc.html.vue"]]),r=JSON.parse('{"path":"/01.%20DesignAndDevelop/Develop/02.%20Theory/Computer/03.%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%20-%20%E4%B8%93%E9%A2%98%E6%88%96%E5%AD%90%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AD%97%E5%85%B8%E7%89%88/%E4%B8%8B%E5%B1%82%E7%9B%B8%E5%85%B3/Network/%E3%80%8Asdn-handbook%E3%80%8Btonydeng/03.%20Linux%E7%BD%91%E7%BB%9C/07.2.%20bcc.html","title":"BCC (BPF Compiler Collection)","lang":"zh-CN","frontmatter":{"tags":["源码"],"description":"BCC (BPF Compiler Collection) BPF Compiler Collection (BCC)是基于eBPF的Linux内核分析、跟踪、网络监控工具。其源码存放于iovisor/bcc。 BCC包括的一些工具 ![Linux bcc/BPF Tracing Tools](07.2. bcc.assets/bcc_tracing_...","head":[["meta",{"property":"og:url","content":"https://LincDocs.github.io/MdNote_Public/01.%20DesignAndDevelop/Develop/02.%20Theory/Computer/03.%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%20-%20%E4%B8%93%E9%A2%98%E6%88%96%E5%AD%90%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AD%97%E5%85%B8%E7%89%88/%E4%B8%8B%E5%B1%82%E7%9B%B8%E5%85%B3/Network/%E3%80%8Asdn-handbook%E3%80%8Btonydeng/03.%20Linux%E7%BD%91%E7%BB%9C/07.2.%20bcc.html"}],["meta",{"property":"og:site_name","content":"MdNote_Public"}],["meta",{"property":"og:title","content":"BCC (BPF Compiler Collection)"}],["meta",{"property":"og:description","content":"BCC (BPF Compiler Collection) BPF Compiler Collection (BCC)是基于eBPF的Linux内核分析、跟踪、网络监控工具。其源码存放于iovisor/bcc。 BCC包括的一些工具 ![Linux bcc/BPF Tracing Tools](07.2. bcc.assets/bcc_tracing_..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-02-05T05:13:59.000Z"}],["meta",{"property":"article:tag","content":"源码"}],["meta",{"property":"article:modified_time","content":"2025-02-05T05:13:59.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"BCC (BPF Compiler Collection)\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-02-05T05:13:59.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"LincDocs\\",\\"url\\":\\"https://github.com/LincDocs/MdNote_Public/\\"}]}"]]},"headers":[{"level":1,"title":"BCC (BPF Compiler Collection)","slug":"bcc-bpf-compiler-collection","link":"#bcc-bpf-compiler-collection","children":[{"level":2,"title":"BCC包括的一些工具","slug":"bcc包括的一些工具","link":"#bcc包括的一些工具","children":[]},{"level":2,"title":"安装BCC","slug":"安装bcc","link":"#安装bcc","children":[]},{"level":2,"title":"常用工具示例","slug":"常用工具示例","link":"#常用工具示例","children":[{"level":3,"title":"capable","slug":"capable","link":"#capable","children":[]},{"level":3,"title":"tcpconnect","slug":"tcpconnect","link":"#tcpconnect","children":[]},{"level":3,"title":"tcptop","slug":"tcptop","link":"#tcptop","children":[]}]},{"level":2,"title":"扩展工具","slug":"扩展工具","link":"#扩展工具","children":[{"level":3,"title":"简单示例","slug":"简单示例","link":"#简单示例","children":[]},{"level":3,"title":"使用BPF_PERF_OUTPUT","slug":"使用bpf-perf-output","link":"#使用bpf-perf-output","children":[]},{"level":3,"title":"用户自定义探针示例","slug":"用户自定义探针示例","link":"#用户自定义探针示例","children":[]}]},{"level":2,"title":"参考","slug":"参考","link":"#参考","children":[]}]}],"git":{"createdTime":1738732439000,"updatedTime":1738732439000,"contributors":[{"name":"Linc","username":"Linc","email":"762699299@qq.com","commits":1,"url":"https://github.com/Linc"}]},"readingTime":{"minutes":3.05,"words":914},"filePathRelative":"01. DesignAndDevelop/Develop/02. Theory/Computer/03. 计算机系统 - 专题或子系统的字典版/下层相关/Network/《sdn-handbook》tonydeng/03. Linux网络/07.2. bcc.md","localizedDate":"2025年2月5日","excerpt":"\\n<p><code>BPF Compiler Collection</code> (<code>BCC</code>)是基于<code>eBPF</code>的<code>Linux</code>内核分析、跟踪、网络监控工具。其源码存放于<a href=\\"https://github.com/iovisor/bcc\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">iovisor/bcc</a>。</p>\\n<h2>BCC包括的一些工具</h2>\\n<p>![Linux bcc/BPF Tracing Tools](07.2. bcc.assets/bcc_tracing_tools_2016.png)</p>","autoDesc":true,"bioChainData":{"outlink":[],"backlink":[],"localMap":{"nodes":[{"id":"01. DesignAndDevelop/Develop/02. Theory/Computer/03. 计算机系统 - 专题或子系统的字典版/下层相关/Network/《sdn-handbook》tonydeng/03. Linux网络/07.2. bcc.md","value":{"title":"07.2. bcc","path":"01. DesignAndDevelop/Develop/02. Theory/Computer/03. 计算机系统 - 专题或子系统的字典版/下层相关/Network/《sdn-handbook》tonydeng/03. Linux网络/07.2. bcc.md","outlink":[],"backlink":[]}}],"links":[]}}}');export{p as comp,r as data};
