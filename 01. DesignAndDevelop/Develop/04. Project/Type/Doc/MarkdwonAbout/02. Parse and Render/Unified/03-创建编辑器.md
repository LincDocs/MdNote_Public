---
create_date: 2025-12-14
last_date: 2025-12-14
source: https://unifiedjs.com/learn/guide/create-an-editor/
---
# 03-åˆ›å»ºç¼–è¾‘å™¨

## åˆ›å»ºç¼–è¾‘å™¨

æœ¬æŒ‡å—å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Unified åˆ›å»ºä¸€ä¸ª*äº¤äº’å¼åœ¨çº¿ç¼–è¾‘å™¨*ï¼Œæœ‰æ—¶ä¹Ÿè¢«ç§°ä¸º *â€œplayground æ¸¸ä¹åœºâ€* æˆ– *â€œdingus å°å·¥å…·â€* ã€‚åœ¨è¿™ä¸ªç¼–è¾‘å™¨ä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡â€œè¯­æ³•é«˜äº®â€æ¥å¯è§†åŒ–æ–‡æœ¬çš„è¯­æ³•å±æ€§ã€‚å®ƒä½¿ç”¨ [React](https://react.dev/) æ„å»ºï¼Œå¹¶åœ¨æµè§ˆå™¨ä¸­è¿è¡Œã€‚

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå¯è§†åŒ–å¥å­é•¿åº¦çš„åº”ç”¨ç¨‹åºã€‚è¯¥åº”ç”¨ç¨‹åºåŸºäº [Gary Provost](https://en.wikipedia.org/wiki/Gary_Provost) æä¾›çš„æŠ€å·§ï¼Œå…¶å¯è§†åŒ–æ•ˆæœåˆ™æºè‡ª [ä¸€æ¡æ¨æ–‡ by `@gregoryciotti`](https://www.helpscout.com/blog/damn-hard-writing/)ã€‚

æ‚¨ä¹Ÿå¯ä»¥åœ¨çº¿[æŸ¥çœ‹æ­¤é¡¹ç›®çš„](https://wooorm.com/write-music/)æ›´å¤šåŠŸèƒ½ã€‚

> é‡åˆ°éš¾é¢˜ï¼Ÿæœ‰å…¶ä»–æŒ‡å—çš„æƒ³æ³•ï¼Ÿè¯·å‚é˜…[`support.md`](https://github.com/unifiedjs/.github/blob/main/support.md)ã€‚

## å†…å®¹

- [æ¡ˆä»¶](https://unifiedjs.com/learn/guide/create-an-editor/#case)
- [é¡¹ç›®ç»“æ„](https://unifiedjs.com/learn/guide/create-an-editor/#project-structure)
- [è®¾ç½® JavaScript](https://unifiedjs.com/learn/guide/create-an-editor/#setting-up-javascript)
- [è‡ªç„¶è¯­è¨€å¥æ³•æ ‘](https://unifiedjs.com/learn/guide/create-an-editor/#natural-language-syntax-tree)
- [è™šæ‹ŸDOM](https://unifiedjs.com/learn/guide/create-an-editor/#virtual-dom)
- [å¼ºè°ƒ](https://unifiedjs.com/learn/guide/create-an-editor/#highlight)
- [æ›´å¤šç»ƒä¹ ](https://unifiedjs.com/learn/guide/create-an-editor/#further-exercises)

## å®ä¾‹ (Case)

åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥æ¦‚è¿°ä¸€ä¸‹æˆ‘ä»¬æƒ³è¦å®ç°çš„åŠŸèƒ½ã€‚æˆ‘ä»¬å¸Œæœ›æ ¹æ®æ–‡æœ¬çš„å­—æ•°é«˜äº®æ˜¾ç¤ºå¥å­ã€‚ç”¨æˆ·åº”è¯¥èƒ½å¤Ÿä¿®æ”¹æ–‡æœ¬ï¼Œå¹¶ä¸”é«˜äº®æ˜¾ç¤ºåŠŸèƒ½åº”è¯¥èƒ½å¤Ÿå®æ—¶ç”Ÿæ•ˆã€‚

æˆ‘ä»¬å°†ä½¿ç”¨ [esbuild](https://esbuild.github.io/) ä½œä¸ºæ‰“åŒ…å·¥å…·ï¼Œå°† JavaScript ä»£ç ç¼–è¯‘æˆå¯åœ¨ç”Ÿäº§ç¯å¢ƒæµè§ˆå™¨ä¸­è¿è¡Œçš„ä»£ç ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ [xo](https://github.com/xojs/xo) å’Œ [prettier](https://prettier.io/) æ¥æ£€æŸ¥å’Œæ ¼å¼åŒ–ä»£ç ã€‚æ‚¨ä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„å–œå¥½æ›¿æ¢è¿™äº›å·¥å…·ã€‚

## é¡¹ç›®ç»“æ„

æˆ‘ä»¬å…ˆæ¥æ¦‚è¿°ä¸€ä¸‹é¡¹ç›®ç»“æ„ï¼š

```txt
demo/
â”œâ”€ bundle.mjs
â”œâ”€ index.css
â”œâ”€ index.html
â”œâ”€ index.jsx
â””â”€ package.json
```

...å…¶ä¸­ `demo/` æ˜¯æˆ‘ä»¬çš„æ–‡ä»¶å¤¹ï¼Œ`bundle.mjs` æ˜¯ç¼–è¯‘ `index.jsx` ç”Ÿæˆçš„ JavaScript

ç°åœ¨å°† `index.jsx`ã€`index.html` ä¿ç•™ä¸ºç©ºï¼Œç„¶åä½¿ç”¨ä»¥ä¸‹å†…å®¹å¡«å…¥ `package.json` :

```json
{
  "devDependencies": {
    "esbuild": "^0.23.0",
    "prettier": "^3.0.0",
    "xo": "^0.59.0"
  },
  "name": "demo",
  "prettier": {
    "bracketSpacing": false,
    "semi": false,
    "singleQuote": true,
    "tabWidth": 2,
    "trailingComma": "none",
    "useTabs": false
  },
  "private": true,
  "scripts": {
    "build": "esbuild index.jsx --bundle --format=esm --jsx=automatic --minify --outfile=bundle.mjs --target=es2020",
    "format": "prettier . --log-level warn --write && xo --fix",
    "test": "npm run build && npm run format"
  },
  "type": "module",
  "xo": {
    "envs": [
      "browser"
    ],
    "ignore": [
      "bundle.mjs"
    ],
    "prettier": true
  }
}
```

> `private: true` æ„å‘³ç€ä½ ä¸ä¼šæ„å¤–åœ°å°†ä½ çš„åŒ…å‘å¸ƒåˆ° npmã€‚

ä¸Šè¿°è½¯ä»¶åŒ…ä¼šå®‰è£… [xo](https://github.com/xojs/xo)ã€[prettier](https://prettier.io/) å’Œ [esbuild](https://esbuild.github.io/)ã€‚è¿è¡Œ `npm install` å’Œ `npm test` åï¼Œæ‚¨ä¹Ÿä¼šçœ‹åˆ°`bundle.mjs` å‡ºç°ã€‚

å¦å¤–ï¼Œæ·»åŠ  `.prettierignore` æ–‡ä»¶ä»¥é¿å…æ ¼å¼åŒ–æˆ‘ä»¬çš„æ„å»ºï¼š

```ignore
bundle.mjs
```

è¯·å¡«å†™`index.html`ä»¥ä¸‹å†…å®¹ï¼š

```html
<!doctype html>
<meta charset="utf8" />
<title>demo</title>
<link rel="stylesheet" href="index.css" />
<div id="root"></div>
<script type="module" src="bundle.mjs"></script>
```

è¿™é“¾æ¥äº† `index.css` å’Œ `bundle.mjs`ï¼Œå¹¶æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼ˆ`#root`ï¼‰ï¼Œæˆ‘ä»¬ç¨åä¼šå°†ç¼–è¾‘å™¨æ·»åŠ åˆ°è¯¥å…ƒç´ ä¸­ã€‚

æ‚¨çŸ¥é“Â `<html>`ã€`<head>`ã€`<body>` éƒ½æ˜¯å¯é€‰çš„å—ï¼Ÿåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†ä¿æŒHTML ä»£ç çš„ç®€æ´æ€§ï¼Œä½†å¦‚æœæ‚¨éœ€è¦ï¼Œå¯ä»¥éšæ„æ·»åŠ å®ƒä»¬ã€‚

## è®¾ç½® JavaScript

å¥½äº†ï¼ç°åœ¨ï¼Œæˆ‘ä»¬æ¥è®¾ç½® JavaScriptã€‚é¦–å…ˆï¼Œå°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°`index.jsx`ï¼š

```js
/// <reference lib="dom" />
/* eslint-env browser */
import ReactDom from 'react-dom/client'
import React from 'react'

const main = document.querySelector('#root')
if (!main) throw new Error('No root element found')
const root = ReactDom.createRoot(main)

const sample = 'The initial text.'

root.render(React.createElement(Playground))

function Playground() {
  const [text, setText] = React.useState(sample)

  return (
    <div className="editor">
      <div className="draw">
        {/* Trailing whitespace in a `textarea` is shown, but not in a `div`
        with `white-space: pre-wrap`.
        Add a `br` to make the last newline explicit. */}
        {/\n[ \t]*$/.test(text) ? <br /> : undefined}
      </div>
      <textarea
        className="write"
        onChange={(event) => setText(event.target.value)}
        rows={text.split('\n').length + 1}
        spellCheck="true"
        value={text}
      />
    </div>
  )
}
```

> åˆ«å¿˜äº† `npm install @types/react-dom @types/react react-dom react`

æˆ‘èƒ½æƒ³è±¡ï¼Œè¿™è¿›å±•å¾—æœ‰ç‚¹å¿«ã€‚

åœ¨ `Playground` ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªå…ƒç´ ï¼šä¸€ä¸ª `div` (`.draw`) ç”¨äºç»˜åˆ¶è¯­æ³•é«˜äº®ã€‚ä¸€ä¸ª `textarea` (`.write`) ç”¨äºä¾›ç”¨æˆ·ç¼–è¾‘çš„ã€‚ä¸¤è€…éƒ½è¢«åŒ…è£¹åœ¨ä¸€ä¸ªçˆ¶çº§ `<div>` (`.editor`) å…ƒç´ ä¸­ã€‚å½“ç”¨æˆ·æ›´æ”¹æ–‡æœ¬åŒºåŸŸæ—¶ï¼Œå°†ä½¿ç”¨æ–°å€¼è°ƒç”¨ `setText`ï¼Œè¿™åè¿‡æ¥åˆä¼šå¯¼è‡´ `text` å…ƒç´ å‘ç”Ÿå˜åŒ–ã€‚

æˆ‘ä»¬å°†æ–‡æœ¬åŒºåŸŸå’Œç»˜å›¾åŒºåŸŸçš„æ ·å¼è®¾ç½®å¾—å®Œå…¨ç›¸åŒï¼Œå¹¶å°†æ–‡æœ¬ç½®äºç»˜å›¾åŒºåŸŸä¸Šæ–¹ï¼Œæ ·å¼å¦‚ä¸‹ï¼š

```css
html {
  font-size: 16px;
  line-height: 1.5;
}

.editor {
  position: relative;
  max-width: 37em;
  margin: auto;
  overflow: hidden;
}

textarea,
.draw {
  margin: 0;
  padding: 0;
  width: 100%;
  border: none;
  outline: none;
  resize: none;
  overflow: hidden;
  /* Canâ€™t use a nice font: kerning renders differently in textareas. */
  font-family: monospace;
  line-height: inherit;
  font-size: inherit;
  background: transparent;
  white-space: pre-wrap;
  word-wrap: break-word;
  font-size: inherit;
  line-height: inherit;
}

textarea {
  color: inherit;
  position: absolute;
  top: 0;
}

.draw {
  min-height: 100vh;
}
```

è¿™æ®µä»£ç ç›¸å½“é•¿ï¼šä¸»è¦æ˜¯ä¸ºäº†å¼ºåˆ¶æ–‡æœ¬åŒºåŸŸå’Œç»˜å›¾åŒºåŸŸä½¿ç”¨ç›¸åŒçš„æ ·å¼ã€‚

## è‡ªç„¶è¯­è¨€å¥æ³•æ ‘

ç°åœ¨ï¼Œæˆ‘ä»¬æ¥è®¾ç½®è‡ªç„¶è¯­è¨€è¯­æ³•æ ‘è§£æã€‚æˆ‘ä»¬å°†ä½¿ç”¨retext è§£æå™¨ [`parse-english`](https://github.com/wooorm/parse-english) æ¥å®Œæˆè¿™é¡¹å·¥ä½œã€‚å®ƒæ˜¯ä¸€ä¸ªé€‚ç”¨äº [retext](https://unifiedjs.com/explore/project/retextjs/retext/) ç”Ÿæ€ç³»ç»Ÿçš„è§£æå™¨ï¼Œå¯ä»¥ç”Ÿæˆ [nlcst](https://github.com/syntax-tree/nlcst) æ–‡ä»¶ã€‚æˆ‘ä»¬ä¸éœ€è¦æ’ä»¶ï¼Œè€Œä¸”æˆ‘ä»¬æ˜¯åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ï¼Œæµè§ˆå™¨å¯¹æ–‡ä»¶å¤§å°çš„è¦æ±‚æ›´é«˜ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ç›¸å…³çš„å·¥å…·ã€‚

ä¿®æ”¹ `index.jsx` å¦‚ä¸‹ï¼š

```diff
--- a/index.jsx
+++ b/index.jsx
@@ -1,5 +1,6 @@
 /// <reference lib="dom" />
 /* eslint-env browser */
+import {ParseEnglish} from 'parse-english'
 import ReactDom from 'react-dom/client'
 import React from 'react'

@@ -8,11 +9,13 @@ if (!main) throw new Error('No root element found')
 const root = ReactDom.createRoot(main)

 const sample = 'The initial text.'
+const parser = new ParseEnglish()

 root.render(React.createElement(Playground))

 function Playground() {
   const [text, setText] = React.useState(sample)
+  const tree = parser.parse(text)

   return (
     <div className="editor">
```

> åˆ«å¿˜äº† `npm install parse-english`

å¤ªå¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬æŒæ¡äº†å¾ˆå¤šå…³äºæ–‡æœ¬çš„ä¿¡æ¯ã€‚ä¸è¿‡å®ƒç›®å‰è¿˜æ²¡æœ‰ä»»ä½•å®é™…ä½œç”¨ã€‚è®©æˆ‘ä»¬æ¥å¢åŠ ä¸€äº›å®ç”¨åŠŸèƒ½å§ã€‚

## è™šæ‹ŸDOM

æˆ‘ä»¬çš„ä¸‹ä¸€ä¸ªä»»åŠ¡æ˜¯å°†è‡ªç„¶è¯­è¨€è¯­æ³•æ ‘è½¬æ¢ä¸ºè™šæ‹ŸDOMã€‚ä¿®æ”¹ `index.jsx` å¦‚ä¸‹ï¼š

```diff
--- a/index.jsx
+++ b/index.jsx
@@ -1,5 +1,9 @@
 /// <reference lib="dom" />
 /* eslint-env browser */
+/**
+ * @import {Nodes, Parents} from 'nlcst'
+ */
+
 import {ParseEnglish} from 'parse-english'
 import ReactDom from 'react-dom/client'
 import React from 'react'
@@ -20,6 +24,7 @@ function Playground() {
   return (
     <div className="editor">
       <div className="draw">
+        {one(tree)}
         {/* Trailing whitespace in a `textarea` is shown, but not in a `div`
           with `white-space: pre-wrap`.
           Add a `br` to make the last newline explicit. */}
@@ -35,3 +40,39 @@ function Playground() {
     </div>
   )
 }
+
+/**
+ * @param {Parents} node
+ * @returns {Array<React.JSX.Element | string>}
+ */
+function all(node) {
+  /** @type {Array<React.JSX.Element | string>} */
+  const results = []
+  let index = -1
+
+  while (++index < node.children.length) {
+    const result = one(node.children[index])
+
+    if (Array.isArray(result)) {
+      results.push(...result)
+    } else {
+      results.push(result)
+    }
+  }
+
+  return results
+}
+
+/**
+ * @param {Nodes} node
+ * @returns {Array<React.JSX.Element | string> | React.JSX.Element | string}
+ */
+function one(node) {
+  const result = 'value' in node ? node.value : all(node)
+
+  if (node.type === 'SentenceNode') {
+    return <span>{result}</span>
+  }
+
+  return result
+}
```

> åˆ«å¿˜äº† `npm install @types/nlcst`

`all` åœ¨ç»™å®šçš„èŠ‚ç‚¹ä¸­æœç´¢æ‰€æœ‰å­èŠ‚ç‚¹ `node`ï¼Œå…¶ä¸­ `one` è¿”å›èŠ‚ç‚¹çš„ *â€œæ–‡æœ¬å†…å®¹ (text content)â€*ï¼Œæˆ–è€…å†æ¬¡æœç´¢å…¶ `all` å­èŠ‚ç‚¹çš„ç»“æœã€‚

ç°åœ¨ï¼Œå½“ä½ è¿è¡Œ `npm test` å¹¶åœ¨æµè§ˆå™¨æ‰“å¼€ `index.html` åï¼Œä½ ä¼šçœ‹åˆ°ç»˜å›¾åŒºåŸŸå·²ç»åŒ…å«äº†æˆ‘ä»¬çš„æ–‡æœ¬ã€‚è™½ç„¶è¿˜æ²¡æœ‰ç€è‰²ï¼Œä½†æ ·å¼éšè—çš„ `<span>` å…ƒç´ æ­£åœ¨åŒ…è£…å¥å­ã€‚

## å¼ºè°ƒ

ç°åœ¨ï¼Œæˆ‘ä»¬æ¥æ·»åŠ é¢œè‰²ã€‚æƒ³è¿™æ ·æ›´æ–° `index.jsx` ï¼š

```diff
--- a/index.jsx
+++ b/index.jsx
@@ -7,6 +7,7 @@
 import {ParseEnglish} from 'parse-english'
 import ReactDom from 'react-dom/client'
 import React from 'react'
+import {visit} from 'unist-util-visit'

 const main = document.querySelector('#root')
 if (!main) throw new Error('No root element found')
@@ -14,6 +15,7 @@ const root = ReactDom.createRoot(main)

 const sample = 'The initial text.'
 const parser = new ParseEnglish()
+const hues = [60, 60, 60, 300, 300, 0, 0, 120, 120, 120, 120, 120, 120, 180]

 root.render(React.createElement(Playground))

@@ -71,7 +73,23 @@ function one(node) {
   const result = 'value' in node ? node.value : all(node)

   if (node.type === 'SentenceNode') {
-    return <span>{result}</span>
+    let words = 0
+
+    visit(node, 'WordNode', function () {
+      words++
+    })
+
+    const hue = words < hues.length ? hues[words] : hues.at(-1)
+
+    return (
+      <span
+        style={{
+          backgroundColor: 'hsl(' + [hue, '93%', '70%', 0.5].join(', ') + ')'
+        }}
+      >
+        {result}
+      </span>
+    )
   }

   return result
```

> åˆ«å¿˜äº† `npm install unist-util-visit`

è¿™æ®µä»£ç å¯¼å…¥ [`unist-util-visit`](https://unifiedjs.com/explore/package/unist-util-visit/) å¹¶å®šä¹‰äº†ä¸€äº›è‰²è°ƒã€‚æˆ‘ä»¬è¯•å›¾é€šè¿‡ä»¥ä¸‹æ–¹å¼é‡ç°è¯¥ [è§†è§‰æ•ˆæœ by `@gregoryciotti`](https://www.helpscout.com/blog/damn-hard-writing/)ã€‚æˆ‘ä»é‚£å¼ å›¾ç‰‡ä¸­æå–äº†è¿™äº›è‰²è°ƒã€‚å½“ç„¶ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ä»»ä½•æ‚¨å–œæ¬¢çš„è‰²è°ƒï¼

ç„¶åï¼Œæˆ‘ä»¬ç»Ÿè®¡æ¯ä¸ªå¥å­ä¸­çš„å•è¯æ•°é‡ã€‚æ¥ç€ï¼Œæˆ‘ä»¬æ ¹æ®å•è¯æ•°é‡ï¼Œä½¿ç”¨ä¸€ç§HSLé¢œè‰²ä½œä¸ºæ¯ä¸ªå¥å­çš„èƒŒæ™¯è‰²ã€‚

å†æ¬¡è¿è¡Œ `npm test` å¹¶åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ `index.html`ã€‚å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°æ¯å¥è¯éƒ½ä»¥çº¢è‰²é«˜äº®æ˜¾ç¤ºã€‚

## æ›´å¤šç»ƒä¹ 

ğŸ’ƒ ç°åœ¨ä½ åº”è¯¥èƒ½åœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°ç´«è‰²çš„ `The initial text` éƒ¨åˆ†äº†ï¼å¦‚æœä½ æ·»åŠ æ›´å¤šå¥å­ï¼Œæ¯ä¸ªå¥å­éƒ½ä¼šæ ¹æ®å­—æ•°æ˜¾ç¤ºä¸åŒçš„é¢œè‰²ã€‚

å®ƒçš„æ ·å¼è¿˜å¯ä»¥åšå¾—æ›´å¥½ï¼Œä½†é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜æ˜¯ä¸€ä¸ªç›¸å½“ä¸é”™çš„å°æ¼”ç¤ºã€‚

å¦‚æœä½ è¿˜æ²¡çœ‹è¿‡ï¼Œè¯·æŸ¥çœ‹ [å­¦ä¹ ç‰ˆå—](https://unifiedjs.com/learn/) ä¸­çš„å…¶ä»–æ–‡ç« ï¼


