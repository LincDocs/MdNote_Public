# ç”¨æˆ·ç•Œé¢æ¥å£

## ç”¨æˆ·ç•Œé¢æ¥å£

### æŒ‡ä»¤



### å¿«æ·èœå•

å¤šç§èœå•

- **å³é”®èœå•**ï¼Œé€šè¿‡`registerEvent`æ³¨å†Œäº‹ä»¶è·å–menuï¼Œä½¿ç”¨`menu.addItem`æ–¹æ³•
- `addRibbonIcon`ï¼Œå‘**åŠŸèƒ½åŒº**ä¸­æ·»åŠ ä¸€ä¸ªé¡¹ï¼Œå¹¶ä¸”å¯ä»¥å±•å¼€å­èœå•
- è®¢é˜… `file-menu` workspace äº‹ä»¶çš„æ–¹å¼ï¼Œå‘**æ–‡ä»¶èœå•**ä¸­æ·»åŠ ä¸€ä¸ªèœå•é¡¹
- è®¢é˜… `editor-menu` workspace äº‹ä»¶çš„æ–¹å¼ï¼Œå‘**ç¼–è¾‘èœå•**ä¸­æ·»åŠ ä¸€ä¸ªèœå•é¡¹

#### å³é”®èœå•

è¿™ä¸ªæ–‡æ¡£é‡Œæ²¡æœ‰ï¼Œæˆ‘å­¦ä¹ å‚è€ƒäº†Table Enhanceçš„ä»£ç 

```typescript
async onload() {
    // åˆ›å»ºå³é”®èœå•
    this.registerEvent(
        this.app.workspace.on("editor-menu", (menu: Menu, editor: Editor, view: MarkdownView) =>
            this.handleCreateTableGeneratorInMenu(menu, editor, view)
        )
    );
}

// åˆ›å»ºTGé¡¹ï¼Œåœ¨å³é”®èœå•é‡Œ
handleCreateTableGeneratorInMenu(menu: Menu, editor: Editor, view: MarkdownView) {
    menu.addItem((item) => {
        const itemDom = (item as any).dom as HTMLElement;
        itemDom.addClass("type-enhance-menu");
        item
            .setTitle("Type Enhance")
            .setIcon("table")
        	.onClick(async () => {
                this.createTableGeneratorMenu(editor, this);
                this.showTableGeneratorView(editor, this.tableGeneratorEl);
        	});
    });
}
```

å¦å¤–è¿˜æœ‰æ®µä»£ç ï¼Œä½†å¥½åƒæ²¡ä»€ä¹ˆç”¨

```typescript
async onload() {
    // åœ¨0.15.0ç­‰æ–°ç‰ˆæœ¬ä¸­ä½¿ç”¨æ—¶ï¼Œåœ¨å¤šä¸ªçª—å£ä¸­å¤„ç†ç›¸åŒçš„mouseevent
    if (requireApiVersion("0.15.0")) {
    	this.registerTableGeneratorMenu();
    }
}

// æ³¨å†ŒTGèœå•
registerTableGeneratorMenu() {
    this.app.workspace.on('window-open', (leaf) => {
        this.registerDomEvent(leaf.doc, 'click', (evt: MouseEvent) => {
            const target = evt.target as HTMLElement;

            if (!this.tableGeneratorEl || !target) return;
            if (target.classList.contains("typora-enhance-menu") 
                || target.parentElement?.classList.contains("typora-enhance-menu") 
                || target.tagName == "BUTTON") return;
            if (this.tableGeneratorEl?.contains(target)) return;
            if (!activeDocument.body.contains(this.tableGeneratorEl)) return;

            this.tableGeneratorEl.detach();
        });
    });
}
```

å­èœå•ï¼ˆï¼‰

```typescript
async onload() {
    // é€‰ä¸­å•å‡»å¹¶å–æ¶ˆèœå•ï¼Œå¦‚æœå•å‡»åœ¨èœå•ä¹‹å¤–
	this.registerDomEvent(window, 'click', (evt: MouseEvent) => this.handleHideTableGeneratorMenu(evt));
}

// åˆ›å»ºTGèœå•
createTableGeneratorMenu(editor: Editor, plugin: TyporaPlugin) {
    // æ£€æŸ¥è¿™ä¸ªtableGeneratorElæ˜¯å¦å·²ç»åˆ›å»ºï¼Œå¦‚æœå·²ç»åˆ›å»ºï¼Œåˆ™åˆ é™¤å®ƒ
    // ç”¨äºå¤šå¼¹çª—
    if (this.tableGeneratorEl && !activeDocument.body.contains(this.tableGeneratorEl)) this.tableGeneratorEl.detach();

    this.tableGeneratorEl = (requireApiVersion("0.15.0") ? activeDocument : document)?.body.createEl("div", { cls: "table-generator-view" });

    this.tableGeneratorEl.hide();
	// æ³¨æ„è¿™é‡Œçš„ TableGenerator æ˜¯ `import TableGenerator from "./ui/TableGenerator.svelte";`  å¯¼å…¥çš„
    this.tableGeneratorComponent = new TableGenerator({
        target: this.tableGeneratorEl,
        props: { editor: editor, plugin: plugin }
    });
}

// å±•ç¤ºTGèœå•
showTableGeneratorView(editor: Editor, tableGeneratorBoard: HTMLElement | null) {
    if (!tableGeneratorBoard) return;

    const cursor = editor.getCursor('from');
    let coords: Coords;

    // ä½¿ç”¨é€‚å½“çš„CM5æˆ–CM6æ¥å£è·å–å…‰æ ‡ä½ç½®
    if ((editor as any).cursorCoords) {
        coords = (editor as any).cursorCoords(true, 'window');
    } else if ((editor as any).coordsAtPos) {
        const offset = editor.posToOffset(cursor);
        coords = (editor as any).cm.coordsAtPos?.(offset) ?? (editor as any).coordsAtPos(offset);
    } else {
        return;
    }

    const calculateTop = (requireApiVersion("0.15.0") ?
                          activeDocument : document)?.body.getBoundingClientRect().height - coords.top - coords.height;
    tableGeneratorBoard.style.transform = "translate(" + (coords.left) + "px, " + "-" + (calculateTop) + "px" + ")";
    tableGeneratorBoard.style.display = 'unset';
}

// éšè—TGèœå•
handleHideTableGeneratorMenu(evt: MouseEvent) {
    const target = evt.target as HTMLElement;

    if (!this.tableGeneratorEl || !target) return;
    if (target.classList.contains("typora-enhance-menu") ||
        target.parentElement?.classList.contains("typora-enhance-menu") ||
        target.tagName == "BUTTON") return;
    if (this.tableGeneratorEl?.contains(target)) return;
    if (!document.body.contains(this.tableGeneratorEl)) return;

    this.tableGeneratorEl.detach();
}
```

#### åŠŸèƒ½åŒºèœå•ï¼ˆcontext menuï¼Œå…¶å®åº”è¯¥å«ribbon menuæ‰å¯¹ï¼‰

ç®€æ˜“ç‰ˆ

```typescript
const ribbonIconEl = this.addRibbonIcon('dice', 'TyporaEnhance', (evt: MouseEvent) => {
    new Notice('This is a TyporaEnhance notice!');
});
```

ç¤ºä¾‹ç‰ˆï¼ˆå›¾æ ‡èœå•ï¼‰

```typescript
import { Menu, Notice, Plugin } from "obsidian";

export default class ExamplePlugin extends Plugin {
  async onload() {
    // å¿«æ·èœå•
	this.addRibbonIcon("dice", "Open menu", (event) => {
      const menu = new Menu(this.app);	// ä¼šæŠ¥é”™ï¼šåº”æœ‰ 0 ä¸ªå‚æ•°ï¼Œä½†è·å¾— 1 ä¸ªã€‚å¯ä»¥ä¸ç®¡

      menu.addItem((item) =>
        item
          .setTitle("Copy")
          .setIcon("documents")
          .onClick(() => {
            new Notice("Copied");
          })
      );

      menu.addItem((item) =>
        item
          .setTitle("Paste")
          .setIcon("paste")
          .onClick(() => {
            new Notice("Pasted");
          })
      );

      menu.showAtMouseEvent(event);		// æ‰“å¼€é¼ æ ‡ç‚¹å‡»çš„èœå•
    });
  }
}

```

> [!tip]
>
> å¦‚æœæ‚¨éœ€è¦æ§åˆ¶èœå•å‡ºç°çš„ä½ç½®ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `menu.showAtPosition({ x: 20, y: 20 })` å»æ‰“å¼€ç›¸å¯¹ Obsidian çª—å£å·¦ä¸Šè§’ç›¸åº”ä½ç½®çš„èœå•ã€‚

#### æ–‡ä»¶èœå•ï¼ˆfile-menuï¼‰

```typescript
this.registerEvent(
    this.app.workspace.on("file-menu", (menu, file) => {
        menu.addItem((item) => {
            item
                .setTitle("Print file path ğŸ‘ˆ")
                .setIcon("document")
                .onClick(async () => {
                new Notice(file.path);
            });
        });
    })
);
```

#### ç¼–è¾‘èœå•ï¼ˆeditor-menuï¼‰

```typescript
this.registerEvent(
    this.app.workspace.on("editor-menu", (menu, editor, view) => {
        menu.addItem((item) => {
            item
                .setTitle("Print file path ğŸ‘ˆ")
                .setIcon("document")
                .onClick(async () => {
                new Notice(view.file.path);
            });
        });
    })
);
```

### HTMLå…ƒç´ 

Obsidian API ä¸­çš„å‡ ä¸ªç»„ä»¶ï¼Œä¾‹å¦‚ [è®¾ç½®é€‰é¡¹å¡ ](https://marcus.se.net/obsidian-plugin-docs/user-interface/settings)ï¼Œå…¬å¼€ *äº†å®¹å™¨å…ƒç´ * ï¼š

```tsx
import { App, PluginSettingTab } from "obsidian";

class ExampleSettingTab extends PluginSettingTab {
  plugin: ExamplePlugin;

  constructor(app: App, plugin: ExamplePlugin) {
    super(app, plugin);
    this.plugin = plugin;
  }

  display(): void {
    let { containerEl } = this;

    // ...
  }
}
```

å®¹å™¨å…ƒç´ æ˜¯ `HTMLElement`ä½¿åœ¨ Obsidian ä¸­åˆ›å»ºè‡ªå®šä¹‰ç•Œé¢æˆä¸ºå¯èƒ½çš„å¯¹è±¡

#### ä½¿ç”¨åˆ›å»º HTML å…ƒç´  `createEl()`

æ¯ä¸€ä¸ª `HTMLElement`ï¼ŒåŒ…æ‹¬å®¹å™¨å…ƒç´ ï¼Œå…¬å¼€äº†ä¸€ä¸ª `createEl()`åˆ›å»ºä¸€ä¸ªæ–¹æ³• `HTMLElement`åœ¨åŸå§‹å…ƒç´ ä¸‹ã€‚ 

ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ·»åŠ  `<h1>`å®¹å™¨å…ƒç´ å†…çš„æ ‡é¢˜å…ƒç´ ï¼š 

```ts
containerEl.createEl("h1", { text: "Heading 1" });
```

`createEl()`è¿”å›å¯¹æ–°å…ƒç´ çš„å¼•ç”¨ï¼š 

```ts
const book = containerEl.createEl("div");
book.createEl("div", { text: "How to Take Smart Notes" });
book.createEl("small", { text: "SÃ¶nke Ahrens" });
```

æ³¨æ„è¿™ä¸ªæ˜¯OBæ¥å£æä¾›çš„å¿«æ·æ¥å£ï¼ŒåŸç”Ÿjsçš„ä¸æ˜¯è¿™æ ·çš„ã€‚

```js
// åŸç”Ÿjsæ–¹å¼
const div = document.createElement("div");
div.addClass("abReplace")
div.setAttribute("style", "background-color: #272e3a")
div.innerText = "ğŸ‘‰" + this.text;

// Obsidian.d.tsé‡Œçš„æ–¹æ³•
const div = document.createDiv({	// createEl
    cls: ["abReplace"],
    attr: {style: "background-color: #272e3a"}
})

// ã€åŒºåˆ«ã€‘ä»–ä»¬ä¸åŒçš„
Document.createElement
HTMLElement.createEl		// ç»§æ‰¿æ ‘ï¼šNode-->Element-->HTMLElement/HTML{Div}Element
```

#### å…ƒç´ æ ·å¼

æ‚¨å¯ä»¥é€šè¿‡æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰ CSS æ ·å¼åˆ°æ‚¨çš„æ’ä»¶ `styles.css`æ’ä»¶æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚  ä¸ºä¸Šä¸€æœ¬ä¹¦ç¤ºä¾‹æ·»åŠ ä¸€äº›æ ·å¼

```css
.book {
  border: 1px solid var(--background-modifier-border);
  padding: 10px;
}

.book__title {
  font-weight: 600;
}

.book__author {
  color: var(--text-muted);
}
```

è¦ä½¿ HTML å…ƒç´ ä½¿ç”¨æ ·å¼ï¼Œè¯·è®¾ç½® `cls`HTML å…ƒç´ çš„å±æ€§ï¼š 

```ts
const book = containerEl.createEl("div", { cls: "book" });
book.createEl("div", { text: "How to Take Smart Notes", cls: "book__title" });
book.createEl("small", { text: "SÃ¶nke Ahrens", cls: "book__author" });
```

#### æ¡ä»¶æ ¼å¼

å¦‚æœä½ æƒ³æ ¹æ®ç”¨æˆ·çš„è®¾ç½®æˆ–å…¶ä»–å€¼æ¥æ”¹å˜ä¸€ä¸ªå…ƒç´ çš„é£æ ¼ï¼Œä½¿ç”¨ `toggleClass` æ–¹æ³•:

```ts
element.toggleClass("danger", status === "error");
```

### å›¾æ ‡

Obsidian API ä¸­çš„ä¸€äº› UI ç»„ä»¶å…è®¸æ‚¨é…ç½®ä¸ä¹‹å¯¹åº”çš„iconã€‚æ‚¨å¯ä»¥ä»å†…ç½®çš„ icon ä¸­é€‰æ‹©ä¸€ä¸ªï¼Œæˆ–è€…æ·»åŠ è‡ªå®šä¹‰çš„iconã€‚

#### æµè§ˆå¯ç”¨çš„ icon

æµè§ˆ [lucide.dev](https://lucide.dev/) ç«™ç‚¹ä»¥æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„å›¾æ ‡ä»¥åŠå¯¹åº”çš„åç§°ã€‚

#### ç»˜åˆ¶ icons



#### æ·»åŠ æ‚¨è‡ªå·±çš„ ico



### ç”¨æˆ·ç•Œé¢



### å¯¹è¯æ¡†

#### åˆ›å»ºå¯¹è¯æ¡†

```js
import { App, Modal } from "obsidian";

export class ExampleModal extends Modal {
  constructor(app: App) {
    super(app);
  }

  onOpen() {	// onOpen() æ–¹æ³•åœ¨å¯¹è¯æ¡†æ‰“å¼€æ—¶è¢«è°ƒç”¨ï¼Œå®ƒè´Ÿè´£åˆ›å»ºå¯¹è¯æ¡†ä¸­çš„å†…å®¹ã€‚æƒ³è¦è·å–æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥æŸ¥é˜… HTML elementsã€‚
    let { contentEl } = this;
    contentEl.setText("Look at me, I'm a modal! ğŸ‘€");
  }

  onClose() {	// onClose() æ–¹æ³•åœ¨å¯¹è¯æ¡†è¢«å…³é—­æ—¶è°ƒç”¨ï¼Œå®ƒè´Ÿè´£æ¸…ç†å¯¹è¯æ¡†æ‰€å ç”¨çš„èµ„æºã€‚
    let { contentEl } = this;
    contentEl.empty();
  }
}

```

#### æ‰“å¼€å¯¹è¯æ¡†

è¦æƒ³æ‰“å¼€ä¸€ä¸ªå¯¹è¯æ¡†ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ª `ExampleModal` çš„å®ä¾‹å¹¶è°ƒç”¨å…¶ä¸Šçš„ [`open()`](https://luhaifeng666.github.io/obsidian-plugin-docs-zh/zh2.0/reference/typescript/classes/Modal.html#open) æ–¹æ³•:

```js
import { Plugin } from "obsidian";
import { ExampleModal } from "./modal";

export default class ExamplePlugin extends Plugin {
  async onload() {
    this.addCommand({
      id: "display-modal",
      name: "Display modal",
      callback: () => {
        new ExampleModal(this.app).open();
      },
    });
  }
}

```

#### æ¥å—ç”¨æˆ·è¾“å…¥

```js
import { App, Modal, Setting } from "obsidian";

// å®šä¹‰è¾“å…¥æ¡†
export class ExampleModal extends Modal {
  result: string;
  onSubmit: (result: string) => void;

  constructor(app: App, onSubmit: (result: string) => void) {	// ä¼ å…¥å›è°ƒå‡½æ•°
    super(app);
    this.onSubmit = onSubmit;
  }

  onOpen() {
    const { contentEl } = this;

    contentEl.createEl("h1", { text: "What's your name?" });

    new Setting(contentEl)										// è¾“å…¥æ¡†
      .setName("Name")
      .addText((text) =>
        text.onChange((value) => {
          this.result = value
        }));

    new Setting(contentEl)										// æäº¤æŒ‰é’®
      .addButton((btn) =>
        btn
          .setButtonText("Submit")
          .setCta()
          .onClick(() => {
            this.close();											// å…³é—­çª—å£
            this.onSubmit(this.result);
          }));
  }

  onClose() {
    let { contentEl } = this;
    contentEl.empty();
  }
}

// æ‰“å¼€è¾“å…¥æ¡†å’Œè·å–è¿”å›
new ExampleModal(this.app, (result) => {
  new Notice(`Hello, ${result}!`);
}).open();
```

#### ä»å»ºè®®åˆ—è¡¨ä¸­é€‰æ‹©

[`SuggestModal`](https://luhaifeng666.github.io/obsidian-plugin-docs-zh/zh2.0/reference/typescript/classes/SuggestModal.html) æ˜¯ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„å¯¹è¯æ¡†ï¼Œç”¨äºå±•ç¤ºä¸€ä¸ªåˆ—è¡¨ä¾›ç”¨æˆ·é€‰æ‹©

â€¦â€¦

### åŠŸèƒ½åŒºæ“ä½œ



### è®¾ç½®



### çŠ¶æ€æ 



### è§†å›¾ View

#### åŸºæœ¬ç”¨æ³•

è§†å›¾å†³å®š Obsidian å¦‚ä½•å»å±•ç¤ºå†…å®¹ã€‚æ¯”å¦‚ file explorer, graph view, ä»¥åŠ Markdown view ç­‰éƒ½æ˜¯è§†å›¾ã€‚å½“ç„¶ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä¸ºè‡ªå·±çš„æ’ä»¶åˆ›å»ºä¸€ä¸ªå¯ä»¥æ›´å¥½çš„å±•ç¤ºå…¶å†…å®¹çš„è‡ªå®šä¹‰è§†å›¾ã€‚

è¦æƒ³åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰è§†å›¾ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ª [`ItemView`](https://luhaifeng666.github.io/obsidian-plugin-docs-zh/zh2.0/reference/typescript/classes/ItemView.html) çš„ç±»:

```typescript
import { ItemView, WorkspaceLeaf } from "obsidian";

export const VIEW_TYPE_EXAMPLE = "example-view";

export class ExampleView extends ItemView {
  constructor(leaf: WorkspaceLeaf) {
    super(leaf);
  }

  getViewType() {
    return VIEW_TYPE_EXAMPLE;
  }

  getDisplayText() {
    return "Example view";
  }

  async onOpen() {
    const container = this.containerEl.children[1];
    container.empty();
    container.createEl("h4", { text: "Example view" });
  }

  async onClose() {
    // Nothing to clean up.
  }
}

```

æ¯ä¸ªè§†å›¾éƒ½ç”±ä¸€ä¸ªå”¯ä¸€çš„åç§°æ¥æ ‡è¯†ï¼Œå¹¶ä¸”æœ‰å‡ ä¸ªæ“ä½œéœ€è¦æ‚¨æŒ‡å®šè¦ä½¿ç”¨çš„è§†å›¾ã€‚
æŠŠå®ƒæŠ½æˆä¸€ä¸ªå¸¸é‡ï¼Œ`VIEW_TYPE_EXAMPLE`ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸é”™çš„æ–¹å¼ã€‚ç¨åæ‚¨å°†åœ¨æœ¬æŒ‡å—ä¸­çœ‹åˆ°å®ƒã€‚

- `getViewType()` ç”¨äºè¿”å›å½“å‰è§†å›¾çš„å”¯ä¸€æ ‡è¯†ã€‚å¿…é¡»override
- `getDisplayText()` ç”¨äºè¿”å›ä¸€ä¸ªæ›´åŠ äººæ€§åŒ–çš„è§†å›¾åç§°ã€‚å¿…é¡»override
- `onOpen()` åœ¨è§†å›¾æ‰“å¼€æ—¶è°ƒç”¨ï¼Œå®ƒè´Ÿè´£æ„å»ºè§†å›¾çš„å†…å®¹ã€‚
- `onClose()` åœ¨è§†å›¾éœ€è¦è¢«å…³é—­æ—¶è°ƒç”¨ï¼Œå®ƒè´Ÿè´£é‡Šæ”¾è§†å›¾å ç”¨çš„èµ„æºã€‚

è‡ªå®šä¹‰è§†å›¾éœ€è¦åœ¨æ’ä»¶è¢«å¯ç”¨æ—¶æ³¨å†Œï¼Œå¹¶ä¸”åœ¨æ’ä»¶è¢«ç¦ç”¨æ—¶é‡Šæ”¾ã€‚

```js
import { Plugin } from "obsidian";
import { ExampleView, VIEW_TYPE_EXAMPLE } from "./view";

export default class ExamplePlugin extends Plugin {
  async onload() {
    this.registerView(
      VIEW_TYPE_EXAMPLE,
      (leaf) => new ExampleView(leaf)
    );

    this.addRibbonIcon("dice", "Activate view", () => {
      this.activateView();
    });
  }

  async onunload() {
    this.app.workspace.detachLeavesOfType(VIEW_TYPE_EXAMPLE);
  }

  async activateView() {
    this.app.workspace.detachLeavesOfType(VIEW_TYPE_EXAMPLE);

    await this.app.workspace.getRightLeaf(false).setViewState({
      type: VIEW_TYPE_EXAMPLE,
      active: true,
    });

    this.app.workspace.revealLeaf(
      this.app.workspace.getLeavesOfType(VIEW_TYPE_EXAMPLE)[0]
    );
  }
}

```

[`registerView()`](https://luhaifeng666.github.io/obsidian-plugin-docs-zh/zh2.0/reference/typescript/classes/Plugin_2.html#registerview) çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œç”¨äºè¿”å›æ‚¨æƒ³æ³¨å†Œçš„è§†å›¾å®ä¾‹ã€‚

#### å…¶ä»–è¡¥å……

> [!warning]
>
> æ°¸è¿œä¸è¦åœ¨æ’ä»¶ä¸­ç®¡ç†å¯¹è§†å›¾çš„å¼•ç”¨ï¼Œå› ä¸º Obsidian å¯èƒ½ä¼šè°ƒç”¨è§†å›¾å·¥å‚å‡½æ•°å¤šæ¬¡ã€‚
> ä¸ºäº†é¿å…è§†å›¾ä¸­çš„å‰¯ä½œç”¨ï¼Œåœ¨éœ€è¦è®¿é—®è§†å›¾å®ä¾‹æ—¶ä½¿ç”¨ `getLeavesOfType()`ã€‚ï¼ˆå’Œ`getActiveViewOfType`æœ‰æ‰€ä¸åŒï¼‰
>
> ```typescript
> this.app.workspace.getLeavesOfType(VIEW_TYPE_EXAMPLE).forEach((leaf) => {
>   if (leaf.view instanceof ExampleView) {
>     // Access your view instance.
>   }
> });
> ```

åœ¨ `onunload()` æ–¹æ³•ä¸­ï¼Œç¡®ä¿åœ¨æ’ä»¶è¢«ç¦ç”¨æ—¶æ¸…ç†è§†å›¾ï¼š

- é€šè¿‡è°ƒç”¨ `close()` æ–¹æ³•å…è®¸è§†å›¾è‡ªè¡Œæ¸…ç†ã€‚
- åˆ†ç¦»ä½¿ç”¨è§†å›¾çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚

åœ¨æ‚¨ä¸ºæ’ä»¶æ³¨å†Œäº†ä¸€ä¸ªè‡ªå®šä¹‰è§†å›¾åï¼Œæ‚¨éœ€è¦ä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªæ¿€æ´»å®ƒçš„æ–¹å¼ã€‚`activateView()` æ˜¯ä¸ªå¾ˆå®ç”¨çš„æ–¹æ³•ï¼Œå®ƒåšäº†ä»¥ä¸‹ä¸‰ä»¶äº‹æƒ…ï¼š

- ä½¿ç”¨è‡ªå®šä¹‰è§†å›¾åˆ†ç¦»æ‰€æœ‰èŠ‚ç‚¹ã€‚
- å°†è‡ªå®šä¹‰è§†å›¾æ·»åŠ åˆ°æ­£ç¡®çš„èŠ‚ç‚¹ä¸Šã€‚
- æ˜¾ç¤ºåŒ…å«è‡ªå®šä¹‰è§†å›¾çš„èŠ‚ç‚¹ã€‚

> [!tip]
> 
> `activateView()` æ–¹æ³•é™åˆ¶æ‚¨çš„æ’ä»¶ä¸€æ¬¡æœ€å¤šæ˜¾ç¤ºä¸€ä¸ªè§†å›¾ã€‚å°è¯•æ³¨é‡Šæ‰å¯¹ `detachLeavesOfType()` çš„è°ƒç”¨ï¼Œä»¥å…è®¸ç”¨æˆ·åˆ›å»ºå¤šä¸ªè§†å›¾ã€‚æ¯æ¬¡è°ƒç”¨ `activateView()`ã€‚

ç”¨æˆ·å¦‚ä½•æ¿€æ´»è§†å›¾çš„æ–¹å¼å–å†³äºæ‚¨ã€‚è¿™æ˜¯ä½¿ç”¨ [ribbon action](https://luhaifeng666.github.io/obsidian-plugin-docs-zh/zh2.0/user-interface/ribbon-actions.html) çš„ä¾‹å­ï¼Œå½“ç„¶æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ [æŒ‡ä»¤](https://luhaifeng666.github.io/obsidian-plugin-docs-zh/zh2.0/user-interface/commands.html)ã€‚

### å·¥ä½œåŒº

#### å·¥ä½œåŒº

Obsidian å…è®¸æ‚¨é…ç½®åœ¨ä»»ä½•æŒ‡å®šçš„æ—¶é—´å¯¹æ‚¨å¯è§çš„å†…å®¹ã€‚å½“æ‚¨ä¸éœ€è¦æ–‡ä»¶æœç´¢çš„æ—¶å€™éšè—å®ƒã€å¹¶åˆ—æ˜¾ç¤ºå¤šä¸ªæ–‡æ¡£ã€æˆ–è€…åœ¨æ‚¨ç¼–è¾‘æ–‡æ¡£çš„æ—¶å€™æ˜¾ç¤ºæ–‡æ¡£å¤§çº²ã€‚å…³äºåº”ç”¨å†…çš„å¯è§å†…å®¹é…ç½®çª—å£åœ¨ *workspace* é…ç½®é¡¹ä¸­ã€‚

workspace æ˜¯[æ ‘å½¢ç»“æ„](https://en.wikipedia.org/wiki/Tree_(data_structure))çš„, æ ‘ä¸Šçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ª [å·¥ä½œåŒºé¡¹](https://luhaifeng666.github.io/obsidian-plugin-docs-zh/zh2.0/reference/typescript/classes/WorkspaceItem.html)ã€‚ æœ‰ä¸¤ç§ç±»å‹çš„å·¥ä½œåŒºé¡¹ï¼š [*çˆ¶èŠ‚ç‚¹*](https://luhaifeng666.github.io/obsidian-plugin-docs-zh/zh2.0/reference/typescript/classes/WorkspaceParent.html) and [*å¶å­èŠ‚ç‚¹*](https://luhaifeng666.github.io/obsidian-plugin-docs-zh/zh2.0/reference/typescript/classes/WorkspaceLeaf.html)ã€‚ ä¸¤è€…ä¹‹é—´çš„ä¸»è¦åŒºåˆ«åœ¨äº *parents* å¯ä»¥åŒ…å« *leaves* ä»¥åŠå…¶ä»– *parents* ï¼Œè€Œ *leaves* ä¸å¯ä»¥åŒ…å«ä»»ä½•å…¶ä»–é¡¹ã€‚

*parents* ä¹Ÿå­˜åœ¨ä¸¤ç§ç±»å‹ï¼Œ [*splits*](https://luhaifeng666.github.io/obsidian-plugin-docs-zh/zh2.0/reference/typescript/classes/WorkspaceSplit.html) ä»¥åŠ [*tabs*](https://luhaifeng666.github.io/obsidian-plugin-docs-zh/zh2.0/reference/typescript/classes/WorkspaceTabs.html), ç”¨æ¥å†³å®šå…¶ä¸­çš„å­é¡¹å¦‚ä½•å‘ˆç°ç»™ç”¨æˆ·:

```mermaid
graph TB
Split-->Leaf1
Split-->Leaf2
Split-->Leaf3
Tabs-->Leaf4
Tabs-->Leaf5
Tabs-->Leaf6
```

-   split æ²¿å‚ç›´æˆ–æ°´å¹³æ–¹å‘ä¾æ¬¡æ’åˆ—å…¶å­é¡¹ã€‚
-   tabs æ¯æ¬¡åªæ˜¾ç¤ºä¸€ä¸ªå­é¡¹ã€‚

åœ¨ workspace ä¸‹é¢æœ‰ä¸‰ç§ç‰¹æ®Šçš„ split: *left*, *right*, and *root* ã€‚ä¸‹å›¾æ˜¯å…¸å‹çš„ workspace ç¤ºä¾‹ï¼š

```mermaid
graph TB
Workspace-->Left_split-->Tabs1-->Leaf1
Tabs1-->Leaf2

Workspace-->Root_split-->Split-->Leaf3
Split-->Leaf4
Root_split-->Leaf5

Workspace-->Right_split-->Tabs2-->Leaf6
Tabs2-->Leaf7
Tabs2-->Leaf8
```

leaf æ˜¯ä¸€ä¸ªèƒ½ä»¥ä¸åŒå½¢å¼å±•ç¤ºå†…å®¹çš„çª—å£ã€‚leaf çš„ç±»å‹å†³å®šäº†å†…å®¹è¯¥è¦å¦‚ä½•å±•ç¤ºï¼Œä»¥åŠå¯¹åº”å“ªä¸ªå…·ä½“çš„ *view*ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ª `graph` ç±»å‹çš„ leaf å¯¹åº”æ˜¾ç¤º [graph view](https://help.obsidian.md/Plugins/Graph+view)ã€‚

#### Splits

é»˜è®¤æƒ…å†µä¸‹ï¼Œroot split æŒ‰ç…§å‚ç›´æ–¹å‘æ’åˆ—ã€‚å½“æ‚¨åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ leafï¼ŒObsidian åœ¨ç”¨æˆ·ç•Œé¢ä¸­åˆ›å»ºä¸€ä¸ªæ–°åˆ—ã€‚å½“æ‚¨æ‹†åˆ†ä¸€ä¸ª leafï¼Œè¢«æ‹†åˆ†å‡ºæ¥çš„ leaves ä¼šè¢«æ·»åŠ åˆ°æ–°çš„ split ä¸­å»ã€‚å½“æ²¡æœ‰é™åˆ¶ root split çš„å±‚çº§æ—¶ï¼Œå®é™…ä¸Šæ¯ä¸ªå±‚çº§çš„å®ç”¨æ€§ä¼šé™ä½ã€‚

```mermaid
graph TB
Root_split_beforce-->Leaf1
Root_split_beforce-->Leaf2

Root_split_after-->Split
Split-->Leaf3
Split-->Leaf4
Root_split_after-->Leaf5
```

å·¦å³çš„ splits çš„å·¥ä½œæ–¹å¼ç•¥æœ‰ä¸åŒã€‚å½“æ‚¨æ‹†åˆ†ä¸€ä¸ª leaf åˆ°ä¾§è¾¹æ ï¼ŒObsidian ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ tabsï¼Œå¹¶å°†æ–°çš„ leaf æ’å…¥åˆ°å…¶ä¸­ã€‚äº‹å®ä¸Šï¼Œè¿™æ„å‘³ç€å®ƒä»¬åœ¨ä»»ä½•æ—¶å€™åªèƒ½æ‹¥æœ‰ä¸‰å±‚çš„ workpaceï¼Œå¹¶ä¸”ç›´æ¥å­çº§å¿…é¡»æ˜¯ tabs ã€‚

```mermaid
graph TB
Root_split_beforce-->Tabs1-->Leaf1
Tabs1-->Leaf2

Root_split_after-->Tabs2
Root_split_after-->Tabs3
Tabs2-->Leaf3
Tabs2-->Leaf4
Tabs3-->Leaf5
```

#### æ£€æŸ¥å·¥ä½œåŒº

æ‚¨å¯ä»¥é€šè¿‡ [App](https://luhaifeng666.github.io/obsidian-plugin-docs-zh/zh2.0/reference/typescript/classes/App.html) å¯¹è±¡è®¿é—®å·¥ä½œåŒºã€‚ä¸‹ä¾‹ä¸­æ‰“å°äº†åœ¨å·¥ä½œåŒºä¸­æ¯ä¸ª leaf çš„ç±»å‹:

```js
import { Plugin } from "obsidian";

export default class ExamplePlugin extends Plugin {
  async onload() {
    this.addRibbonIcon("dice", "Print leaf types", () => {
      this.app.workspace.iterateAllLeaves((leaf) => {
        console.log(leaf.getViewState().type);
      });
    });
  }
}
```

#### Leaf lifecycle

æ’ä»¶å¯ä»¥å‘ workspace ä¸­æ·»åŠ ä»»æ„ç±»å‹çš„ leafï¼Œä¹Ÿå¯ä»¥é€šè¿‡ [è‡ªå®šä¹‰è§†å›¾][custom views](https://luhaifeng666.github.io/obsidian-plugin-docs-zh/zh2.0/user-interface/views.html)ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æ·»åŠ  leaf åˆ° workspace çš„æ–¹å¼ã€‚æƒ³è¦äº†è§£æ›´å¤šï¼Œå¯ä»¥æŸ¥é˜… [`Workspace`](https://luhaifeng666.github.io/obsidian-plugin-docs-zh/zh2.0/reference/typescript/classes/Workspace.html) è¿™ç¯‡æ–‡æ¡£ã€‚

- å¦‚æœæ‚¨æƒ³åœ¨æ ¹ split ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„ leafï¼Œ ä½¿ç”¨ [`workspace.getLeaf(true)`](https://luhaifeng666.github.io/obsidian-plugin-docs-zh/zh2.0/reference/typescript/classes/Workspace.html#getleaf) æ–¹æ³•.
- å¦‚æœæ‚¨æƒ³åœ¨ä¾§è¾¹æ ä¸­æ·»åŠ ä»»æ„ä¸€ä¸ªæ–°çš„ leafï¼Œå¯ä»¥ä½¿ç”¨ [`workspace.getLeftLeaf()`](https://luhaifeng666.github.io/obsidian-plugin-docs-zh/zh2.0/reference/typescript/classes/Workspace.html#getleftleaf) ä»¥åŠ [`workspace.getRightLeaf()`](https://luhaifeng666.github.io/obsidian-plugin-docs-zh/zh2.0/reference/typescript/classes/Workspace.html#getrightleaf)æ–¹æ³•ã€‚ä¸¤è€…éƒ½å¯ä»¥è®©æ‚¨å†³å®šæ˜¯å¦éœ€è¦å°† leaf æ·»åŠ åˆ°æ–°çš„ split ä¸Šã€‚

æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ [`createLeafInParent()`](https://luhaifeng666.github.io/obsidian-plugin-docs-zh/zh2.0/reference/typescript/classes/Workspace.html#createleafinparent)æ–¹æ³•åœ¨æ‚¨é€‰æ‹©çš„ split ä¸­æ˜¾å¼çš„æ·»åŠ  leafã€‚

é™¤éæ˜ç¡®åˆ é™¤ï¼Œå¦åˆ™å³ä½¿åœ¨æ’ä»¶è¢«ç¦ç”¨åï¼Œæ’ä»¶æ·»åŠ åˆ°å·¥ä½œåŒºä¸Šçš„ä»»ä½• leaf ä¾æ—§ä¼šè¢«ä¿ç•™ã€‚æ’ä»¶è´Ÿè´£åˆ é™¤å®ƒä»¬æ·»åŠ åˆ° å·¥ä½œåŒºçš„ä»»ä½•å¶å­èŠ‚ç‚¹ã€‚

è¦æƒ³ä» workspace ä¸­åˆ é™¤ä¸€ä¸ª leafï¼Œåœ¨æ‚¨æƒ³è¦åˆ é™¤çš„ leaf ä¸Šè°ƒç”¨ [`detach()`](https://luhaifeng666.github.io/obsidian-plugin-docs-zh/zh2.0/reference/typescript/classes/WorkspaceLeaf.html#detach)æ–¹æ³•ã€‚æ‚¨ä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨ [`detachLeavesOfType()`](https://luhaifeng666.github.io/obsidian-plugin-docs-zh/zh2.0/reference/typescript/classes/Workspace.html#detachleavesoftype).

#### Leaf ç»„

æ‚¨å¯ä»¥ä½¿ç”¨ [linked panes](https://help.obsidian.md/User+interface/Workspace/Panes/Linked+pane) æ–¹æ³•æ¥åˆ†é…å¤šä¸ª leaf åˆ°åŒä¸€ä¸ªç»„ä¸­ä»¥åˆ›å»º [`setGroup()`](https://luhaifeng666.github.io/obsidian-plugin-docs-zh/zh2.0/reference/typescript/classes/WorkspaceLeaf.html#setgroup).

```js
leaves.forEach((leaf) => leaf.setGroup("group1");
```

